<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>nelpy.utils - nelpy</title><link rel=stylesheet href=../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#nelpy.utils class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=nelpy class="md-header__button md-logo" aria-label=nelpy data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> nelpy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> nelpy.utils </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=light data-md-color-primary=custom data-md-color-accent=custom aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=blue aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nelpy/nelpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> nelpy/nelpy </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../core/eventarray/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../../tutorials/GettingStarted/ class=md-tabs__link> Tutorials </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=nelpy class="md-nav__button md-logo" aria-label=nelpy data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> nelpy </label> <div class=md-nav__source> <a href=https://github.com/nelpy/nelpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> nelpy/nelpy </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../core/eventarray/ class=md-nav__link> <span class=md-ellipsis> EventArray </span> </a> </li> <li class=md-nav__item> <a href=../../core/analogsignalarray/ class=md-nav__link> <span class=md-ellipsis> AnalogSignalArray </span> </a> </li> <li class=md-nav__item> <a href=../../core/intervalarray/ class=md-nav__link> <span class=md-ellipsis> IntervalArray </span> </a> </li> <li class=md-nav__item> <a href=../../core/valeventarray/ class=md-nav__link> <span class=md-ellipsis> ValeventArray </span> </a> </li> <li class=md-nav__item> <a href=../../core/coordinates/ class=md-nav__link> <span class=md-ellipsis> Coordinates </span> </a> </li> <li class=md-nav__item> <a href=../../analysis/ class=md-nav__link> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../auxiliary/ class=md-nav__link> <span class=md-ellipsis> Auxiliary </span> </a> </li> <li class=md-nav__item> <a href=../../decoding/ class=md-nav__link> <span class=md-ellipsis> Decoding </span> </a> </li> <li class=md-nav__item> <a href=../../plotting/ class=md-nav__link> <span class=md-ellipsis> Plotting </span> </a> </li> <li class=md-nav__item> <a href=../../utils/ class=md-nav__link> <span class=md-ellipsis> Utilities </span> </a> </li> <li class=md-nav__item> <a href=../../estimators/ class=md-nav__link> <span class=md-ellipsis> Estimators </span> </a> </li> <li class=md-nav__item> <a href=../../filtering/ class=md-nav__link> <span class=md-ellipsis> Filtering </span> </a> </li> <li class=md-nav__item> <a href=../../preprocessing/ class=md-nav__link> <span class=md-ellipsis> Preprocessing </span> </a> </li> <li class=md-nav__item> <a href=../../hmmutils/ class=md-nav__link> <span class=md-ellipsis> HMM Utils </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/GettingStarted/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/AnalogSignalArrayTutorial/ class=md-nav__link> <span class=md-ellipsis> AnalogSignalArray Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/EpochArrayTutorial/ class=md-nav__link> <span class=md-ellipsis> EpochArray Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/LinearTrackDemo/ class=md-nav__link> <span class=md-ellipsis> Linear Track Demo </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/SpikeTrainSmoothing/ class=md-nav__link> <span class=md-ellipsis> SpikeTrain Smoothing </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/plotting/ class=md-nav__link> <span class=md-ellipsis> plotting </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/WMazeDemo/ class=md-nav__link> <span class=md-ellipsis> WMaze Demo </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/BackyardBrainsEEG/ class=md-nav__link> <span class=md-ellipsis> Backyard Brains EEG </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/develop/ class=md-nav__link> <span class=md-ellipsis> develop </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#nelpy.utils class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.PrettyBytes class=md-nav__link> <span class=md-ellipsis> PrettyBytes </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.PrettyDuration class=md-nav__link> <span class=md-ellipsis> PrettyDuration </span> </a> <nav class=md-nav aria-label=PrettyDuration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nelpy.utils.PrettyDuration.time_string class=md-nav__link> <span class=md-ellipsis> time_string </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.PrettyDuration.to_dhms class=md-nav__link> <span class=md-ellipsis> to_dhms </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nelpy.utils.PrettyInt class=md-nav__link> <span class=md-ellipsis> PrettyInt </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.argsort class=md-nav__link> <span class=md-ellipsis> argsort </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.asa_indices_within_epochs class=md-nav__link> <span class=md-ellipsis> asa_indices_within_epochs </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.cartesian class=md-nav__link> <span class=md-ellipsis> cartesian </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.collapse_time class=md-nav__link> <span class=md-ellipsis> collapse_time </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.ddt_asa class=md-nav__link> <span class=md-ellipsis> ddt_asa </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.dxdt_AnalogSignalArray class=md-nav__link> <span class=md-ellipsis> dxdt_AnalogSignalArray </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.find_nearest_idx class=md-nav__link> <span class=md-ellipsis> find_nearest_idx </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.find_nearest_indices class=md-nav__link> <span class=md-ellipsis> find_nearest_indices </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.find_threshold_crossing_events class=md-nav__link> <span class=md-ellipsis> find_threshold_crossing_events </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.frange class=md-nav__link> <span class=md-ellipsis> frange </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.gaussian_filter class=md-nav__link> <span class=md-ellipsis> gaussian_filter </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_PBEs class=md-nav__link> <span class=md-ellipsis> get_PBEs </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_contiguous_segments class=md-nav__link> <span class=md-ellipsis> get_contiguous_segments </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_direction class=md-nav__link> <span class=md-ellipsis> get_direction </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_events_boundaries class=md-nav__link> <span class=md-ellipsis> get_events_boundaries </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_inactive_epochs class=md-nav__link> <span class=md-ellipsis> get_inactive_epochs </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_mua class=md-nav__link> <span class=md-ellipsis> get_mua </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_mua_events class=md-nav__link> <span class=md-ellipsis> get_mua_events </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_run_epochs class=md-nav__link> <span class=md-ellipsis> get_run_epochs </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_sort_idx class=md-nav__link> <span class=md-ellipsis> get_sort_idx </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.get_threshold_crossing_epochs class=md-nav__link> <span class=md-ellipsis> get_threshold_crossing_epochs </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.information_rate class=md-nav__link> <span class=md-ellipsis> information_rate </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.is_odd class=md-nav__link> <span class=md-ellipsis> is_odd </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.is_sorted class=md-nav__link> <span class=md-ellipsis> is_sorted </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.is_sorted_general class=md-nav__link> <span class=md-ellipsis> is_sorted_general </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.linear_merge class=md-nav__link> <span class=md-ellipsis> linear_merge </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.nextfastpower class=md-nav__link> <span class=md-ellipsis> nextfastpower </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.nextpower class=md-nav__link> <span class=md-ellipsis> nextpower </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.pairwise class=md-nav__link> <span class=md-ellipsis> pairwise </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.ragged_array class=md-nav__link> <span class=md-ellipsis> ragged_array </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.shrinkMatColsTo class=md-nav__link> <span class=md-ellipsis> shrinkMatColsTo </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.signal_envelope1D class=md-nav__link> <span class=md-ellipsis> signal_envelope1D </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.signal_envelope_1d class=md-nav__link> <span class=md-ellipsis> signal_envelope_1d </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.spatial_information class=md-nav__link> <span class=md-ellipsis> spatial_information </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.spatial_selectivity class=md-nav__link> <span class=md-ellipsis> spatial_selectivity </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.spatial_sparsity class=md-nav__link> <span class=md-ellipsis> spatial_sparsity </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.spiketrain_union class=md-nav__link> <span class=md-ellipsis> spiketrain_union </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.swap_cols class=md-nav__link> <span class=md-ellipsis> swap_cols </span> </a> </li> <li class=md-nav__item> <a href=#nelpy.utils.swap_rows class=md-nav__link> <span class=md-ellipsis> swap_rows </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/nelpy/nelpy/edit/master/docs/nelpy/utils.py title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/nelpy/nelpy/raw/master/docs/nelpy/utils.py title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1>nelpy.utils</h1> <div class="doc doc-object doc-module"> <a id=nelpy.utils></a> <div class="doc doc-contents first"> <p>This module contains helper functions and utilities for nelpy.</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=nelpy.utils.PrettyBytes class="doc doc-heading"> <code>PrettyBytes</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=int>int</span></code></p> <p>Prints number of bytes in a more readable format</p> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>PrettyBytes</span><span class=p>(</span><span class=nb>int</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Prints number of bytes in a more readable format&quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>val</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>=</span> <span class=n>val</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=p>:</span>
            <span class=k>return</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> bytes&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>)</span>
        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=o>**</span><span class=mi>2</span><span class=p>:</span>
            <span class=k>return</span> <span class=s2>&quot;</span><span class=si>{:.3f}</span><span class=s2> kilobytes&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>/</span> <span class=mi>1024</span><span class=p>)</span>
        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=o>**</span><span class=mi>3</span><span class=p>:</span>
            <span class=k>return</span> <span class=s2>&quot;</span><span class=si>{:.3f}</span><span class=s2> megabytes&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>/</span> <span class=mi>1024</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span>
        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=o>**</span><span class=mi>4</span><span class=p>:</span>
            <span class=k>return</span> <span class=s2>&quot;</span><span class=si>{:.3f}</span><span class=s2> gigabytes&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>/</span> <span class=mi>1024</span><span class=o>**</span><span class=mi>3</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=fm>__str__</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=nelpy.utils.PrettyDuration class="doc doc-heading"> <code>PrettyDuration</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=float>float</span></code></p> <p>Time duration with pretty print.</p> <p>Behaves like a float, and can always be cast to a float.</p> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span>
<span class=normal>1579</span>
<span class=normal>1580</span>
<span class=normal>1581</span>
<span class=normal>1582</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>PrettyDuration</span><span class=p>(</span><span class=nb>float</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Time duration with pretty print.</span>

<span class=sd>    Behaves like a float, and can always be cast to a float.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>seconds</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>duration</span> <span class=o>=</span> <span class=n>seconds</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>time_string</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>duration</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>time_string</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>duration</span><span class=p>)</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>to_dhms</span><span class=p>(</span><span class=n>seconds</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Convert seconds into days, hours, minutes, seconds, and milliseconds.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        seconds : float</span>
<span class=sd>            Time duration in seconds.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        namedtuple</span>
<span class=sd>            Named tuple with fields: pos (bool), dd (days), hh (hours),</span>
<span class=sd>            mm (minutes), ss (seconds), ms (milliseconds).</span>

<span class=sd>        Examples</span>
<span class=sd>        --------</span>
<span class=sd>        &gt;&gt;&gt; PrettyDuration.to_dhms(3661.5)</span>
<span class=sd>        Time(pos=True, dd=0, hh=1, mm=1, ss=1, ms=500.0)</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>pos</span> <span class=o>=</span> <span class=n>seconds</span> <span class=o>&gt;=</span> <span class=mi>0</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>pos</span><span class=p>:</span>
            <span class=n>seconds</span> <span class=o>=</span> <span class=o>-</span><span class=n>seconds</span>
        <span class=n>ms</span> <span class=o>=</span> <span class=n>seconds</span> <span class=o>%</span> <span class=mi>1</span>
        <span class=n>ms</span> <span class=o>=</span> <span class=nb>round</span><span class=p>(</span><span class=n>ms</span> <span class=o>*</span> <span class=mi>10000</span><span class=p>)</span> <span class=o>/</span> <span class=mi>10</span>
        <span class=n>seconds</span> <span class=o>=</span> <span class=n>floor</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span>
        <span class=n>m</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=nb>divmod</span><span class=p>(</span><span class=n>seconds</span><span class=p>,</span> <span class=mi>60</span><span class=p>)</span>
        <span class=n>h</span><span class=p>,</span> <span class=n>m</span> <span class=o>=</span> <span class=nb>divmod</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=mi>60</span><span class=p>)</span>
        <span class=n>d</span><span class=p>,</span> <span class=n>h</span> <span class=o>=</span> <span class=nb>divmod</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=mi>24</span><span class=p>)</span>
        <span class=n>Time</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s2>&quot;Time&quot;</span><span class=p>,</span> <span class=s2>&quot;pos dd hh mm ss ms&quot;</span><span class=p>)</span>
        <span class=n>time</span> <span class=o>=</span> <span class=n>Time</span><span class=p>(</span><span class=n>pos</span><span class=o>=</span><span class=n>pos</span><span class=p>,</span> <span class=n>dd</span><span class=o>=</span><span class=n>d</span><span class=p>,</span> <span class=n>hh</span><span class=o>=</span><span class=n>h</span><span class=p>,</span> <span class=n>mm</span><span class=o>=</span><span class=n>m</span><span class=p>,</span> <span class=n>ss</span><span class=o>=</span><span class=n>s</span><span class=p>,</span> <span class=n>ms</span><span class=o>=</span><span class=n>ms</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>time</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>time_string</span><span class=p>(</span><span class=n>seconds</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Return a formatted time string.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        seconds : float</span>
<span class=sd>            Time duration in seconds.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        str</span>
<span class=sd>            Formatted time string (e.g., &quot;1:01:01.5 hours&quot;, &quot;30.5 seconds&quot;).</span>

<span class=sd>        Examples</span>
<span class=sd>        --------</span>
<span class=sd>        &gt;&gt;&gt; PrettyDuration.time_string(3661.5)</span>
<span class=sd>        &#39;1:01:01.5 hours&#39;</span>
<span class=sd>        &gt;&gt;&gt; PrettyDuration.time_string(30.5)</span>
<span class=sd>        &#39;30.5 seconds&#39;</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>isinf</span><span class=p>(</span><span class=n>seconds</span><span class=p>):</span>
            <span class=k>return</span> <span class=s2>&quot;inf&quot;</span>
        <span class=n>pos</span><span class=p>,</span> <span class=n>dd</span><span class=p>,</span> <span class=n>hh</span><span class=p>,</span> <span class=n>mm</span><span class=p>,</span> <span class=n>ss</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>PrettyDuration</span><span class=o>.</span><span class=n>to_dhms</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>mm</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=c1># in this case, represent milliseconds in terms of</span>
                <span class=c1># seconds (i.e. a decimal)</span>
                <span class=n>sstr</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>s</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>)</span><span class=o>.</span><span class=n>lstrip</span><span class=p>(</span><span class=s2>&quot;0&quot;</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;=</span> <span class=mf>999.5</span><span class=p>:</span>
                    <span class=n>ss</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span>
                    <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
                    <span class=c1># now propagate the carry:</span>
                    <span class=k>if</span> <span class=n>ss</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                        <span class=n>mm</span> <span class=o>+=</span> <span class=mi>1</span>
                        <span class=n>ss</span> <span class=o>=</span> <span class=mi>0</span>
                    <span class=k>if</span> <span class=n>mm</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                        <span class=n>hh</span> <span class=o>+=</span> <span class=mi>1</span>
                        <span class=n>mm</span> <span class=o>=</span> <span class=mi>0</span>
                    <span class=k>if</span> <span class=n>hh</span> <span class=o>==</span> <span class=mi>24</span><span class=p>:</span>
                        <span class=n>dd</span> <span class=o>+=</span> <span class=mi>1</span>
                        <span class=n>hh</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># for all other cases, milliseconds will be represented</span>
                <span class=c1># as an integer</span>
                <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;=</span> <span class=mf>999.5</span><span class=p>:</span>
                    <span class=n>ss</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span>
                    <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
                    <span class=c1># now propagate the carry:</span>
                    <span class=k>if</span> <span class=n>ss</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                        <span class=n>mm</span> <span class=o>+=</span> <span class=mi>1</span>
                        <span class=n>ss</span> <span class=o>=</span> <span class=mi>0</span>
                    <span class=k>if</span> <span class=n>mm</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                        <span class=n>hh</span> <span class=o>+=</span> <span class=mi>1</span>
                        <span class=n>mm</span> <span class=o>=</span> <span class=mi>0</span>
                    <span class=k>if</span> <span class=n>hh</span> <span class=o>==</span> <span class=mi>24</span><span class=p>:</span>
                        <span class=n>dd</span> <span class=o>+=</span> <span class=mi>1</span>
                        <span class=n>hh</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;:</span><span class=si>{:03d}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>s</span><span class=p>))</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
        <span class=k>if</span> <span class=n>dd</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>daystr</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{:01d}</span><span class=s2> days &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>dd</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>daystr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
        <span class=k>if</span> <span class=n>hh</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{:01d}</span><span class=s2>:</span><span class=si>{:02d}</span><span class=s2>:</span><span class=si>{:02d}{}</span><span class=s2> hours&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>hh</span><span class=p>,</span> <span class=n>mm</span><span class=p>,</span> <span class=n>ss</span><span class=p>,</span> <span class=n>sstr</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>mm</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{:01d}</span><span class=s2>:</span><span class=si>{:02d}{}</span><span class=s2> minutes&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>mm</span><span class=p>,</span> <span class=n>ss</span><span class=p>,</span> <span class=n>sstr</span><span class=p>)</span>
        <span class=k>elif</span> <span class=n>ss</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{:01d}{}</span><span class=s2> seconds&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ss</span><span class=p>,</span> <span class=n>sstr</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> milliseconds&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>pos</span><span class=p>:</span>
            <span class=n>timestr</span> <span class=o>=</span> <span class=s2>&quot;-&quot;</span> <span class=o>+</span> <span class=n>timestr</span>
        <span class=k>return</span> <span class=n>timestr</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__add__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Add another value to this duration.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        other : float or PrettyDuration</span>
<span class=sd>            Value to add.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PrettyDuration</span>
<span class=sd>            New duration object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>PrettyDuration</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>duration</span> <span class=o>+</span> <span class=n>other</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__radd__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Add this duration to another value (right addition).</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        other : float or PrettyDuration</span>
<span class=sd>            Value to add to.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PrettyDuration</span>
<span class=sd>            New duration object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=fm>__add__</span><span class=p>(</span><span class=n>other</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__sub__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Subtract another value from this duration.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        other : float or PrettyDuration</span>
<span class=sd>            Value to subtract.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PrettyDuration</span>
<span class=sd>            New duration object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>PrettyDuration</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>duration</span> <span class=o>-</span> <span class=n>other</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__rsub__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Subtract this duration from another value (right subtraction).</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        other : float or PrettyDuration</span>
<span class=sd>            Value to subtract from.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PrettyDuration</span>
<span class=sd>            New duration object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>other</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>duration</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__mul__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Multiply this duration by another value.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        other : float</span>
<span class=sd>            Value to multiply by.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PrettyDuration</span>
<span class=sd>            New duration object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>PrettyDuration</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>duration</span> <span class=o>*</span> <span class=n>other</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__rmul__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Multiply another value by this duration (right multiplication).</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        other : float</span>
<span class=sd>            Value to multiply.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PrettyDuration</span>
<span class=sd>            New duration object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=fm>__mul__</span><span class=p>(</span><span class=n>other</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__truediv__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Divide this duration by another value.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        other : float</span>
<span class=sd>            Value to divide by.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PrettyDuration</span>
<span class=sd>            New duration object.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>PrettyDuration</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>duration</span> <span class=o>/</span> <span class=n>other</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=nelpy.utils.PrettyDuration.time_string class="doc doc-heading"> <code class="highlight language-python"><span class=n>time_string</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Return a formatted time string.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>seconds</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Time duration in seconds.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Formatted time string (e.g., "1:01:01.5 hours", "30.5 seconds").</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>PrettyDuration</span><span class=o>.</span><span class=n>time_string</span><span class=p>(</span><span class=mf>3661.5</span><span class=p>)</span>
<span class=go>&#39;1:01:01.5 hours&#39;</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>PrettyDuration</span><span class=o>.</span><span class=n>time_string</span><span class=p>(</span><span class=mf>30.5</span><span class=p>)</span>
<span class=go>&#39;30.5 seconds&#39;</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>time_string</span><span class=p>(</span><span class=n>seconds</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Return a formatted time string.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    seconds : float</span>
<span class=sd>        Time duration in seconds.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    str</span>
<span class=sd>        Formatted time string (e.g., &quot;1:01:01.5 hours&quot;, &quot;30.5 seconds&quot;).</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; PrettyDuration.time_string(3661.5)</span>
<span class=sd>    &#39;1:01:01.5 hours&#39;</span>
<span class=sd>    &gt;&gt;&gt; PrettyDuration.time_string(30.5)</span>
<span class=sd>    &#39;30.5 seconds&#39;</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>isinf</span><span class=p>(</span><span class=n>seconds</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;inf&quot;</span>
    <span class=n>pos</span><span class=p>,</span> <span class=n>dd</span><span class=p>,</span> <span class=n>hh</span><span class=p>,</span> <span class=n>mm</span><span class=p>,</span> <span class=n>ss</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>PrettyDuration</span><span class=o>.</span><span class=n>to_dhms</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>mm</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=c1># in this case, represent milliseconds in terms of</span>
            <span class=c1># seconds (i.e. a decimal)</span>
            <span class=n>sstr</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>s</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>)</span><span class=o>.</span><span class=n>lstrip</span><span class=p>(</span><span class=s2>&quot;0&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;=</span> <span class=mf>999.5</span><span class=p>:</span>
                <span class=n>ss</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
                <span class=c1># now propagate the carry:</span>
                <span class=k>if</span> <span class=n>ss</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                    <span class=n>mm</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>ss</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=k>if</span> <span class=n>mm</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                    <span class=n>hh</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>mm</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=k>if</span> <span class=n>hh</span> <span class=o>==</span> <span class=mi>24</span><span class=p>:</span>
                    <span class=n>dd</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>hh</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># for all other cases, milliseconds will be represented</span>
            <span class=c1># as an integer</span>
            <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;=</span> <span class=mf>999.5</span><span class=p>:</span>
                <span class=n>ss</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=n>s</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
                <span class=c1># now propagate the carry:</span>
                <span class=k>if</span> <span class=n>ss</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                    <span class=n>mm</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>ss</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=k>if</span> <span class=n>mm</span> <span class=o>==</span> <span class=mi>60</span><span class=p>:</span>
                    <span class=n>hh</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>mm</span> <span class=o>=</span> <span class=mi>0</span>
                <span class=k>if</span> <span class=n>hh</span> <span class=o>==</span> <span class=mi>24</span><span class=p>:</span>
                    <span class=n>dd</span> <span class=o>+=</span> <span class=mi>1</span>
                    <span class=n>hh</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;:</span><span class=si>{:03d}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>s</span><span class=p>))</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>sstr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
    <span class=k>if</span> <span class=n>dd</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>daystr</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{:01d}</span><span class=s2> days &quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>dd</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>daystr</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
    <span class=k>if</span> <span class=n>hh</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{:01d}</span><span class=s2>:</span><span class=si>{:02d}</span><span class=s2>:</span><span class=si>{:02d}{}</span><span class=s2> hours&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>hh</span><span class=p>,</span> <span class=n>mm</span><span class=p>,</span> <span class=n>ss</span><span class=p>,</span> <span class=n>sstr</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>mm</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{:01d}</span><span class=s2>:</span><span class=si>{:02d}{}</span><span class=s2> minutes&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>mm</span><span class=p>,</span> <span class=n>ss</span><span class=p>,</span> <span class=n>sstr</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>ss</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{:01d}{}</span><span class=s2> seconds&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ss</span><span class=p>,</span> <span class=n>sstr</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>timestr</span> <span class=o>=</span> <span class=n>daystr</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> milliseconds&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>pos</span><span class=p>:</span>
        <span class=n>timestr</span> <span class=o>=</span> <span class=s2>&quot;-&quot;</span> <span class=o>+</span> <span class=n>timestr</span>
    <span class=k>return</span> <span class=n>timestr</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=nelpy.utils.PrettyDuration.to_dhms class="doc doc-heading"> <code class="highlight language-python"><span class=n>to_dhms</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Convert seconds into days, hours, minutes, seconds, and milliseconds.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>seconds</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Time duration in seconds.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=collections.namedtuple>namedtuple</span></code> </td> <td> <div class=doc-md-description> <p>Named tuple with fields: pos (bool), dd (days), hh (hours), mm (minutes), ss (seconds), ms (milliseconds).</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>PrettyDuration</span><span class=o>.</span><span class=n>to_dhms</span><span class=p>(</span><span class=mf>3661.5</span><span class=p>)</span>
<span class=go>Time(pos=True, dd=0, hh=1, mm=1, ss=1, ms=500.0)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>to_dhms</span><span class=p>(</span><span class=n>seconds</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Convert seconds into days, hours, minutes, seconds, and milliseconds.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    seconds : float</span>
<span class=sd>        Time duration in seconds.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    namedtuple</span>
<span class=sd>        Named tuple with fields: pos (bool), dd (days), hh (hours),</span>
<span class=sd>        mm (minutes), ss (seconds), ms (milliseconds).</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; PrettyDuration.to_dhms(3661.5)</span>
<span class=sd>    Time(pos=True, dd=0, hh=1, mm=1, ss=1, ms=500.0)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>pos</span> <span class=o>=</span> <span class=n>seconds</span> <span class=o>&gt;=</span> <span class=mi>0</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>pos</span><span class=p>:</span>
        <span class=n>seconds</span> <span class=o>=</span> <span class=o>-</span><span class=n>seconds</span>
    <span class=n>ms</span> <span class=o>=</span> <span class=n>seconds</span> <span class=o>%</span> <span class=mi>1</span>
    <span class=n>ms</span> <span class=o>=</span> <span class=nb>round</span><span class=p>(</span><span class=n>ms</span> <span class=o>*</span> <span class=mi>10000</span><span class=p>)</span> <span class=o>/</span> <span class=mi>10</span>
    <span class=n>seconds</span> <span class=o>=</span> <span class=n>floor</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span>
    <span class=n>m</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=nb>divmod</span><span class=p>(</span><span class=n>seconds</span><span class=p>,</span> <span class=mi>60</span><span class=p>)</span>
    <span class=n>h</span><span class=p>,</span> <span class=n>m</span> <span class=o>=</span> <span class=nb>divmod</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=mi>60</span><span class=p>)</span>
    <span class=n>d</span><span class=p>,</span> <span class=n>h</span> <span class=o>=</span> <span class=nb>divmod</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=mi>24</span><span class=p>)</span>
    <span class=n>Time</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s2>&quot;Time&quot;</span><span class=p>,</span> <span class=s2>&quot;pos dd hh mm ss ms&quot;</span><span class=p>)</span>
    <span class=n>time</span> <span class=o>=</span> <span class=n>Time</span><span class=p>(</span><span class=n>pos</span><span class=o>=</span><span class=n>pos</span><span class=p>,</span> <span class=n>dd</span><span class=o>=</span><span class=n>d</span><span class=p>,</span> <span class=n>hh</span><span class=o>=</span><span class=n>h</span><span class=p>,</span> <span class=n>mm</span><span class=o>=</span><span class=n>m</span><span class=p>,</span> <span class=n>ss</span><span class=o>=</span><span class=n>s</span><span class=p>,</span> <span class=n>ms</span><span class=o>=</span><span class=n>ms</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>time</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=nelpy.utils.PrettyInt class="doc doc-heading"> <code>PrettyInt</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=int>int</span></code></p> <p>Prints integers in a more readable format</p> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>PrettyInt</span><span class=p>(</span><span class=nb>int</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Prints integers in a more readable format&quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>val</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>val</span> <span class=o>=</span> <span class=n>val</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;</span><span class=si>{:,}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;</span><span class=si>{:,}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>val</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.argsort class="doc doc-heading"> <code class="highlight language-python"><span class=n>argsort</span><span class=p>(</span><span class=n>seq</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return indices that would sort a sequence.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>seq</code> </td> <td> <code><span title=sequence>sequence</span></code> </td> <td> <div class=doc-md-description> <p>Sequence to sort (list, tuple, array, etc.).</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>indices</code></td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>List of indices that would sort the sequence.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>argsort</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span>
<span class=go>[1, 3, 0, 2, 4]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>seq</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;c&quot;</span><span class=p>,</span> <span class=s2>&quot;a&quot;</span><span class=p>,</span> <span class=s2>&quot;b&quot;</span><span class=p>]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=p>[</span><span class=n>seq</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>argsort</span><span class=p>(</span><span class=n>seq</span><span class=p>)]</span>
<span class=go>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
</code></pre></div> <details class=note open> <summary>Notes</summary> <p>Based on http://stackoverflow.com/questions/3071415/efficient-method-to-calculate-the-rank-vector-of-a-list-in-python</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span>
<span class=normal>675</span>
<span class=normal>676</span>
<span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>argsort</span><span class=p>(</span><span class=n>seq</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Return indices that would sort a sequence.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    seq : sequence</span>
<span class=sd>        Sequence to sort (list, tuple, array, etc.).</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    indices : list</span>
<span class=sd>        List of indices that would sort the sequence.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; argsort([3, 1, 4, 1, 5])</span>
<span class=sd>    [1, 3, 0, 2, 4]</span>
<span class=sd>    &gt;&gt;&gt; seq = [&quot;c&quot;, &quot;a&quot;, &quot;b&quot;]</span>
<span class=sd>    &gt;&gt;&gt; [seq[i] for i in argsort(seq)]</span>
<span class=sd>    [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    Based on http://stackoverflow.com/questions/3071415/efficient-method-to-calculate-the-rank-vector-of-a-list-in-python</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>seq</span><span class=p>)),</span> <span class=n>key</span><span class=o>=</span><span class=n>seq</span><span class=o>.</span><span class=fm>__getitem__</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.asa_indices_within_epochs class="doc doc-heading"> <code class="highlight language-python"><span class=n>asa_indices_within_epochs</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>intervalarray</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return indices of ASA within epochs.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>asa</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray object.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>intervalarray</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/intervalarray/#nelpy.core._intervalarray.IntervalArray>IntervalArray</a></code> </td> <td> <div class=doc-md-description> <p>IntervalArray containing epochs of interest.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>indices</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of shape (n_epochs, 2) containing [start, stop] indices for each epoch, so that data can be associated with asa._data[:,start:stop] for each epoch.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>epochs</span> <span class=o>=</span> <span class=n>nelpy</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>],</span> <span class=p>[</span><span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>]])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>indices</span> <span class=o>=</span> <span class=n>asa_indices_within_epochs</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>epochs</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>data_in_epochs</span> <span class=o>=</span> <span class=p>[</span><span class=n>asa</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>start</span><span class=p>:</span><span class=n>stop</span><span class=p>]</span> <span class=k>for</span> <span class=n>start</span><span class=p>,</span> <span class=n>stop</span> <span class=ow>in</span> <span class=n>indices</span><span class=p>]</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>asa_indices_within_epochs</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>intervalarray</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Return indices of ASA within epochs.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    asa : AnalogSignalArray</span>
<span class=sd>        AnalogSignalArray object.</span>
<span class=sd>    intervalarray : IntervalArray</span>
<span class=sd>        IntervalArray containing epochs of interest.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    indices : np.ndarray</span>
<span class=sd>        Array of shape (n_epochs, 2) containing [start, stop] indices</span>
<span class=sd>        for each epoch, so that data can be associated with</span>
<span class=sd>        asa._data[:,start:stop] for each epoch.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; epochs = nelpy.EpochArray([[0, 10], [20, 30]])</span>
<span class=sd>    &gt;&gt;&gt; indices = asa_indices_within_epochs(asa, epochs)</span>
<span class=sd>    &gt;&gt;&gt; data_in_epochs = [asa._data[:, start:stop] for start, stop in indices]</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>indices</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>intervalarray</span> <span class=o>=</span> <span class=n>intervalarray</span><span class=p>[</span><span class=n>asa</span><span class=o>.</span><span class=n>support</span><span class=p>]</span>
    <span class=k>for</span> <span class=n>interval</span> <span class=ow>in</span> <span class=n>intervalarray</span><span class=o>.</span><span class=n>merge</span><span class=p>()</span><span class=o>.</span><span class=n>data</span><span class=p>:</span>
        <span class=n>a_start</span> <span class=o>=</span> <span class=n>interval</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>a_stop</span> <span class=o>=</span> <span class=n>interval</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
        <span class=n>frm</span><span class=p>,</span> <span class=n>to</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>_abscissa_vals</span><span class=p>,</span> <span class=p>(</span><span class=n>a_start</span><span class=p>,</span> <span class=n>a_stop</span><span class=p>))</span>
        <span class=n>indices</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>frm</span><span class=p>,</span> <span class=n>to</span><span class=p>))</span>
    <span class=n>indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>indices</span><span class=p>,</span> <span class=n>ndmin</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>indices</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.cartesian class="doc doc-heading"> <code class="highlight language-python"><span class=n>cartesian</span><span class=p>(</span><span class=n>xcenters</span><span class=p>,</span> <span class=n>ycenters</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find every combination of elements in two arrays (Cartesian product).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>xcenters</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>First array of values.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>ycenters</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Second array of values.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>cartesian</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of shape (n_samples, 2) containing all combinations.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>cartesian</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
<span class=go>array([[1, 3],</span>
<span class=go>       [1, 4],</span>
<span class=go>       [1, 5],</span>
<span class=go>       [2, 3],</span>
<span class=go>       [2, 4],</span>
<span class=go>       [2, 5]])</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2792</span>
<span class=normal>2793</span>
<span class=normal>2794</span>
<span class=normal>2795</span>
<span class=normal>2796</span>
<span class=normal>2797</span>
<span class=normal>2798</span>
<span class=normal>2799</span>
<span class=normal>2800</span>
<span class=normal>2801</span>
<span class=normal>2802</span>
<span class=normal>2803</span>
<span class=normal>2804</span>
<span class=normal>2805</span>
<span class=normal>2806</span>
<span class=normal>2807</span>
<span class=normal>2808</span>
<span class=normal>2809</span>
<span class=normal>2810</span>
<span class=normal>2811</span>
<span class=normal>2812</span>
<span class=normal>2813</span>
<span class=normal>2814</span>
<span class=normal>2815</span>
<span class=normal>2816</span>
<span class=normal>2817</span>
<span class=normal>2818</span>
<span class=normal>2819</span>
<span class=normal>2820</span>
<span class=normal>2821</span>
<span class=normal>2822</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>cartesian</span><span class=p>(</span><span class=n>xcenters</span><span class=p>,</span> <span class=n>ycenters</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Find every combination of elements in two arrays (Cartesian product).</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    xcenters : np.ndarray</span>
<span class=sd>        First array of values.</span>
<span class=sd>    ycenters : np.ndarray</span>
<span class=sd>        Second array of values.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    cartesian : np.ndarray</span>
<span class=sd>        Array of shape (n_samples, 2) containing all combinations.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; x = np.array([1, 2])</span>
<span class=sd>    &gt;&gt;&gt; y = np.array([3, 4, 5])</span>
<span class=sd>    &gt;&gt;&gt; cartesian(x, y)</span>
<span class=sd>    array([[1, 3],</span>
<span class=sd>           [1, 4],</span>
<span class=sd>           [1, 5],</span>
<span class=sd>           [2, 3],</span>
<span class=sd>           [2, 4],</span>
<span class=sd>           [2, 5]])</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>transpose</span><span class=p>(</span>
        <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>(</span><span class=n>xcenters</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>ycenters</span><span class=p>)),</span> <span class=n>np</span><span class=o>.</span><span class=n>repeat</span><span class=p>(</span><span class=n>ycenters</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>xcenters</span><span class=p>))]</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.collapse_time class="doc doc-heading"> <code class="highlight language-python"><span class=n>collapse_time</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>gap</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Collapse all epochs in an object into a single, contiguous object.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>obj</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.SpikeTrainArray>SpikeTrainArray</a> or <a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>Object with multiple epochs to collapse.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>gap</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Gap to insert between epochs in the collapsed object. Default is 0.</p> </div> </td> <td> <code>0</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=obj>obj</span></code> </td> <td> <div class=doc-md-description> <p>New object of the same type with all epochs collapsed into a single contiguous epoch.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># Collapse a SpikeTrainArray with multiple epochs</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>collapsed_st</span> <span class=o>=</span> <span class=n>collapse_time</span><span class=p>(</span><span class=n>spiketrain</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=c1># Collapse an AnalogSignalArray with gaps between epochs</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>collapsed_asa</span> <span class=o>=</span> <span class=n>collapse_time</span><span class=p>(</span><span class=n>analogsignal</span><span class=p>,</span> <span class=n>gap</span><span class=o>=</span><span class=mf>0.1</span><span class=p>)</span>
</code></pre></div> <details class=note open> <summary>Notes</summary> <p>For SpikeTrainArrays, gaps are not yet supported. The function adjusts spike times or signal times to create a continuous timeline while preserving the original epoch boundaries information.</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2689</span>
<span class=normal>2690</span>
<span class=normal>2691</span>
<span class=normal>2692</span>
<span class=normal>2693</span>
<span class=normal>2694</span>
<span class=normal>2695</span>
<span class=normal>2696</span>
<span class=normal>2697</span>
<span class=normal>2698</span>
<span class=normal>2699</span>
<span class=normal>2700</span>
<span class=normal>2701</span>
<span class=normal>2702</span>
<span class=normal>2703</span>
<span class=normal>2704</span>
<span class=normal>2705</span>
<span class=normal>2706</span>
<span class=normal>2707</span>
<span class=normal>2708</span>
<span class=normal>2709</span>
<span class=normal>2710</span>
<span class=normal>2711</span>
<span class=normal>2712</span>
<span class=normal>2713</span>
<span class=normal>2714</span>
<span class=normal>2715</span>
<span class=normal>2716</span>
<span class=normal>2717</span>
<span class=normal>2718</span>
<span class=normal>2719</span>
<span class=normal>2720</span>
<span class=normal>2721</span>
<span class=normal>2722</span>
<span class=normal>2723</span>
<span class=normal>2724</span>
<span class=normal>2725</span>
<span class=normal>2726</span>
<span class=normal>2727</span>
<span class=normal>2728</span>
<span class=normal>2729</span>
<span class=normal>2730</span>
<span class=normal>2731</span>
<span class=normal>2732</span>
<span class=normal>2733</span>
<span class=normal>2734</span>
<span class=normal>2735</span>
<span class=normal>2736</span>
<span class=normal>2737</span>
<span class=normal>2738</span>
<span class=normal>2739</span>
<span class=normal>2740</span>
<span class=normal>2741</span>
<span class=normal>2742</span>
<span class=normal>2743</span>
<span class=normal>2744</span>
<span class=normal>2745</span>
<span class=normal>2746</span>
<span class=normal>2747</span>
<span class=normal>2748</span>
<span class=normal>2749</span>
<span class=normal>2750</span>
<span class=normal>2751</span>
<span class=normal>2752</span>
<span class=normal>2753</span>
<span class=normal>2754</span>
<span class=normal>2755</span>
<span class=normal>2756</span>
<span class=normal>2757</span>
<span class=normal>2758</span>
<span class=normal>2759</span>
<span class=normal>2760</span>
<span class=normal>2761</span>
<span class=normal>2762</span>
<span class=normal>2763</span>
<span class=normal>2764</span>
<span class=normal>2765</span>
<span class=normal>2766</span>
<span class=normal>2767</span>
<span class=normal>2768</span>
<span class=normal>2769</span>
<span class=normal>2770</span>
<span class=normal>2771</span>
<span class=normal>2772</span>
<span class=normal>2773</span>
<span class=normal>2774</span>
<span class=normal>2775</span>
<span class=normal>2776</span>
<span class=normal>2777</span>
<span class=normal>2778</span>
<span class=normal>2779</span>
<span class=normal>2780</span>
<span class=normal>2781</span>
<span class=normal>2782</span>
<span class=normal>2783</span>
<span class=normal>2784</span>
<span class=normal>2785</span>
<span class=normal>2786</span>
<span class=normal>2787</span>
<span class=normal>2788</span>
<span class=normal>2789</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>collapse_time</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>gap</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Collapse all epochs in an object into a single, contiguous object.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    obj : SpikeTrainArray or AnalogSignalArray</span>
<span class=sd>        Object with multiple epochs to collapse.</span>
<span class=sd>    gap : float, optional</span>
<span class=sd>        Gap to insert between epochs in the collapsed object. Default is 0.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    obj</span>
<span class=sd>        New object of the same type with all epochs collapsed into a single</span>
<span class=sd>        contiguous epoch.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; # Collapse a SpikeTrainArray with multiple epochs</span>
<span class=sd>    &gt;&gt;&gt; collapsed_st = collapse_time(spiketrain)</span>
<span class=sd>    &gt;&gt;&gt; # Collapse an AnalogSignalArray with gaps between epochs</span>
<span class=sd>    &gt;&gt;&gt; collapsed_asa = collapse_time(analogsignal, gap=0.1)</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    For SpikeTrainArrays, gaps are not yet supported.</span>
<span class=sd>    The function adjusts spike times or signal times to create a continuous</span>
<span class=sd>    timeline while preserving the original epoch boundaries information.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># TODO: redo SpikeTrainArray so as to keep the epochs separate!, and to support gaps!</span>

    <span class=c1># We&#39;ll have to ajust all the spikes per epoch... and we&#39;ll have to compute a new support. Also set a flag!</span>

    <span class=c1># If it&#39;s a SpikeTrainArray, then we left-shift the spike times. If it&#39;s an AnalogSignalArray, then we</span>
    <span class=c1># left-shift the time and tdata.</span>

    <span class=c1># Also set a new attribute, with the boundaries in seconds.</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>):</span>
        <span class=n>new_obj</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>obj</span><span class=p>)(</span><span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>_data</span>

        <span class=n>durations</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>support</span><span class=o>.</span><span class=n>durations</span>
        <span class=n>starts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>durations</span> <span class=o>+</span> <span class=n>gap</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
        <span class=n>stops</span> <span class=o>=</span> <span class=n>starts</span> <span class=o>+</span> <span class=n>durations</span>
        <span class=n>newsupport</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>obj</span><span class=o>.</span><span class=n>_abscissa</span><span class=o>.</span><span class=n>support</span><span class=p>)(</span><span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>((</span><span class=n>starts</span><span class=p>,</span> <span class=n>stops</span><span class=p>))</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>_support</span> <span class=o>=</span> <span class=n>newsupport</span>

        <span class=n>new_time</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>time</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span>  <span class=c1># fast copy</span>
        <span class=n>time_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>obj</span><span class=o>.</span><span class=n>lengths</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

        <span class=n>new_offset</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>epidx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>obj</span><span class=o>.</span><span class=n>n_epochs</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>epidx</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>new_time</span><span class=p>[</span><span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span><span class=p>]</span> <span class=p>:</span> <span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>new_time</span><span class=p>[</span><span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span><span class=p>]</span> <span class=p>:</span> <span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span>
                    <span class=o>-</span> <span class=n>obj</span><span class=o>.</span><span class=n>time</span><span class=p>[</span><span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span><span class=p>]]</span>
                    <span class=o>+</span> <span class=n>new_offset</span>
                    <span class=o>+</span> <span class=n>gap</span>
                <span class=p>)</span>
                <span class=n>new_offset</span> <span class=o>+=</span> <span class=n>durations</span><span class=p>[</span><span class=n>epidx</span><span class=p>]</span> <span class=o>+</span> <span class=n>gap</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>new_time</span><span class=p>[</span><span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span><span class=p>]</span> <span class=p>:</span> <span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>new_time</span><span class=p>[</span><span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span><span class=p>]</span> <span class=p>:</span> <span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span>
                    <span class=o>-</span> <span class=n>obj</span><span class=o>.</span><span class=n>time</span><span class=p>[</span><span class=n>time_idx</span><span class=p>[</span><span class=n>epidx</span><span class=p>]]</span>
                    <span class=o>+</span> <span class=n>new_offset</span>
                <span class=p>)</span>
                <span class=n>new_offset</span> <span class=o>+=</span> <span class=n>durations</span><span class=p>[</span><span class=n>epidx</span><span class=p>]</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>_time</span> <span class=o>=</span> <span class=n>new_time</span>

        <span class=n>new_obj</span><span class=o>.</span><span class=n>_fs</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>_fs</span>

    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>EventArray</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>gap</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;gaps not supported for SpikeTrainArrays yet!&quot;</span><span class=p>)</span>
        <span class=n>new_obj</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>obj</span><span class=p>)(</span><span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>new_time</span> <span class=o>=</span> <span class=p>[[]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>obj</span><span class=o>.</span><span class=n>n_series</span><span class=p>)]</span>
        <span class=n>duration</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>st_</span> <span class=ow>in</span> <span class=n>obj</span><span class=p>:</span>
            <span class=n>le</span> <span class=o>=</span> <span class=n>st_</span><span class=o>.</span><span class=n>support</span><span class=o>.</span><span class=n>start</span>
            <span class=k>for</span> <span class=n>unit_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>obj</span><span class=o>.</span><span class=n>n_series</span><span class=p>):</span>
                <span class=n>new_time</span><span class=p>[</span><span class=n>unit_</span><span class=p>]</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>st_</span><span class=o>.</span><span class=n>_data</span><span class=p>[</span><span class=n>unit_</span><span class=p>]</span> <span class=o>-</span> <span class=n>le</span> <span class=o>+</span> <span class=n>duration</span><span class=p>)</span>
            <span class=n>duration</span> <span class=o>+=</span> <span class=n>st_</span><span class=o>.</span><span class=n>support</span><span class=o>.</span><span class=n>duration</span>
        <span class=n>new_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asanyarray</span><span class=p>(</span>
            <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>asanyarray</span><span class=p>(</span><span class=n>unittime</span><span class=p>)</span> <span class=k>for</span> <span class=n>unittime</span> <span class=ow>in</span> <span class=n>new_time</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>object</span>
        <span class=p>)</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>new_time</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>support</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>obj</span><span class=o>.</span><span class=n>_abscissa</span><span class=o>.</span><span class=n>support</span><span class=p>)([</span><span class=mi>0</span><span class=p>,</span> <span class=n>duration</span><span class=p>])</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>_series_ids</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>_series_ids</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>_series_labels</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>_series_labels</span>
        <span class=n>new_obj</span><span class=o>.</span><span class=n>_series_tags</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>_series_tags</span>
    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>BinnedEventArray</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span>
            <span class=s2>&quot;BinnedEventArrays are not yet supported, but bst.data is essentially already collapsed!&quot;</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;unsupported type for collapse_time&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>new_obj</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.ddt_asa class="doc doc-heading"> <code class="highlight language-python"><span class=n>ddt_asa</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>smooth</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>rectify</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>norm</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Numerical differentiation of a regularly sampled AnalogSignalArray.</p> <p>Optionally also smooths result with a Gaussian kernel.</p> <p>Smoothing is applied in time, and the same smoothing is applied to each signal in the AnalogSignalArray.</p> <p>Differentiation, (and if requested, smoothing) is applied within each epoch.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>asa</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../all/#nelpy.all.RegularlySampledAnalogSignalArray>RegularlySampledAnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>Input object.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fs</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Sampling rate (in Hz) of input RSASA. If not provided, it will be obtained from asa.fs.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>smooth</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If true, result will be smoothed. Default is False</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>rectify</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, absolute value of derivative is computed. Default is True.</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Standard deviation of Gaussian kernel, in seconds. Default is 0.05 (50 ms).</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>truncate</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Bandwidth outside of which the filter value will be zero. Default is 4.0</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>norm</code> </td> <td> </td> <td> <div class=doc-md-description> <p>If True, then apply the L2 norm to the result.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code><a class="autorefs autorefs-internal" href=../all/#nelpy.all.RegularlySampledAnalogSignalArray>RegularlySampledAnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>A RegularlySampledAnalogSignalArray with derivative data (in units per second) is returned.</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>Central differences are used here.</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2261</span>
<span class=normal>2262</span>
<span class=normal>2263</span>
<span class=normal>2264</span>
<span class=normal>2265</span>
<span class=normal>2266</span>
<span class=normal>2267</span>
<span class=normal>2268</span>
<span class=normal>2269</span>
<span class=normal>2270</span>
<span class=normal>2271</span>
<span class=normal>2272</span>
<span class=normal>2273</span>
<span class=normal>2274</span>
<span class=normal>2275</span>
<span class=normal>2276</span>
<span class=normal>2277</span>
<span class=normal>2278</span>
<span class=normal>2279</span>
<span class=normal>2280</span>
<span class=normal>2281</span>
<span class=normal>2282</span>
<span class=normal>2283</span>
<span class=normal>2284</span>
<span class=normal>2285</span>
<span class=normal>2286</span>
<span class=normal>2287</span>
<span class=normal>2288</span>
<span class=normal>2289</span>
<span class=normal>2290</span>
<span class=normal>2291</span>
<span class=normal>2292</span>
<span class=normal>2293</span>
<span class=normal>2294</span>
<span class=normal>2295</span>
<span class=normal>2296</span>
<span class=normal>2297</span>
<span class=normal>2298</span>
<span class=normal>2299</span>
<span class=normal>2300</span>
<span class=normal>2301</span>
<span class=normal>2302</span>
<span class=normal>2303</span>
<span class=normal>2304</span>
<span class=normal>2305</span>
<span class=normal>2306</span>
<span class=normal>2307</span>
<span class=normal>2308</span>
<span class=normal>2309</span>
<span class=normal>2310</span>
<span class=normal>2311</span>
<span class=normal>2312</span>
<span class=normal>2313</span>
<span class=normal>2314</span>
<span class=normal>2315</span>
<span class=normal>2316</span>
<span class=normal>2317</span>
<span class=normal>2318</span>
<span class=normal>2319</span>
<span class=normal>2320</span>
<span class=normal>2321</span>
<span class=normal>2322</span>
<span class=normal>2323</span>
<span class=normal>2324</span>
<span class=normal>2325</span>
<span class=normal>2326</span>
<span class=normal>2327</span>
<span class=normal>2328</span>
<span class=normal>2329</span>
<span class=normal>2330</span>
<span class=normal>2331</span>
<span class=normal>2332</span>
<span class=normal>2333</span>
<span class=normal>2334</span>
<span class=normal>2335</span>
<span class=normal>2336</span>
<span class=normal>2337</span>
<span class=normal>2338</span>
<span class=normal>2339</span>
<span class=normal>2340</span>
<span class=normal>2341</span>
<span class=normal>2342</span>
<span class=normal>2343</span>
<span class=normal>2344</span>
<span class=normal>2345</span>
<span class=normal>2346</span>
<span class=normal>2347</span>
<span class=normal>2348</span>
<span class=normal>2349</span>
<span class=normal>2350</span>
<span class=normal>2351</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@keyword_deprecation</span><span class=p>(</span><span class=n>replace_x_with_y</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;bw&quot;</span><span class=p>:</span> <span class=s2>&quot;truncate&quot;</span><span class=p>})</span>
<span class=k>def</span><span class=w> </span><span class=nf>ddt_asa</span><span class=p>(</span>
    <span class=n>asa</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>smooth</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>rectify</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>norm</span><span class=o>=</span><span class=kc>False</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Numerical differentiation of a regularly sampled AnalogSignalArray.</span>

<span class=sd>    Optionally also smooths result with a Gaussian kernel.</span>

<span class=sd>    Smoothing is applied in time, and the same smoothing is applied to each</span>
<span class=sd>    signal in the AnalogSignalArray.</span>

<span class=sd>    Differentiation, (and if requested, smoothing) is applied within each epoch.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    asa : nelpy.RegularlySampledAnalogSignalArray</span>
<span class=sd>        Input object.</span>
<span class=sd>    fs : float, optional</span>
<span class=sd>        Sampling rate (in Hz) of input RSASA. If not provided, it will be obtained</span>
<span class=sd>        from asa.fs.</span>
<span class=sd>    smooth : bool, optional</span>
<span class=sd>        If true, result will be smoothed. Default is False</span>
<span class=sd>    rectify : bool, optional</span>
<span class=sd>        If True, absolute value of derivative is computed. Default is True.</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Standard deviation of Gaussian kernel, in seconds. Default is 0.05</span>
<span class=sd>        (50 ms).</span>
<span class=sd>    truncate : float, optional</span>
<span class=sd>        Bandwidth outside of which the filter value will be zero. Default is 4.0</span>
<span class=sd>    norm: boolean, optional</span>
<span class=sd>        If True, then apply the L2 norm to the result.</span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : nelpy.RegularlySampledAnalogSignalArray</span>
<span class=sd>        A RegularlySampledAnalogSignalArray with derivative data (in units</span>
<span class=sd>        per second) is returned.</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    Central differences are used here.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span>
        <span class=nb>isinstance</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>)</span>
        <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>_analogsignalarray</span><span class=o>.</span><span class=n>PositionArray</span><span class=p>)</span>
    <span class=p>):</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;Input object must be a RegularlySampledAnalogSignalArray!&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>fs</span> <span class=o>=</span> <span class=n>asa</span><span class=o>.</span><span class=n>fs</span>
    <span class=k>if</span> <span class=n>sigma</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.05</span>  <span class=c1># 50 ms default</span>

    <span class=n>out</span> <span class=o>=</span> <span class=n>asa</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
    <span class=n>cum_lengths</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>lengths</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

    <span class=c1># ensure that datatype is float</span>
    <span class=c1># TODO: this will break complex data</span>
    <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span>

    <span class=c1># now obtain the derivative for each epoch separately</span>
    <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>n_epochs</span><span class=p>):</span>
        <span class=c1># if 1D:</span>
        <span class=k>if</span> <span class=n>asa</span><span class=o>.</span><span class=n>n_signals</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>])</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
                <span class=c1># only single sample</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>gradient</span><span class=p>(</span>
                    <span class=n>asa</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
                <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>])</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
                <span class=c1># only single sample</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>gradient</span><span class=p>(</span>
                    <span class=n>asa</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
                <span class=p>)</span>

    <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>*</span> <span class=n>fs</span>

    <span class=k>if</span> <span class=n>norm</span><span class=p>:</span>
        <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>atleast_2d</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>

    <span class=k>if</span> <span class=n>rectify</span><span class=p>:</span>
        <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>smooth</span><span class=p>:</span>
        <span class=n>out</span> <span class=o>=</span> <span class=n>gaussian_filter</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=n>fs</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.dxdt_AnalogSignalArray class="doc doc-heading"> <code class="highlight language-python"><span class=n>dxdt_AnalogSignalArray</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>smooth</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>rectify</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Numerical differentiation of a regularly sampled AnalogSignalArray.</p> <p>Optionally also smooths result with a Gaussian kernel.</p> <p>Smoothing is applied in time, and the same smoothing is applied to each signal in the AnalogSignalArray.</p> <p>Differentiation, (and if requested, smoothing) is applied within each epoch.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>asa</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fs</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Sampling rate (in Hz) of AnalogSignalArray. If not provided, it will be obtained from asa.fs</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>smooth</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If true, result will be smoothed. Default is False</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>rectify</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, absolute value of derivative is computed. Default is True.</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Standard deviation of Gaussian kernel, in seconds. Default is 0.05 (50 ms).</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>truncate</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Bandwidth outside of which the filter value will be zero. Default is 4.0</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>An AnalogSignalArray with derivative data (in units per second) is returned.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2354</span>
<span class=normal>2355</span>
<span class=normal>2356</span>
<span class=normal>2357</span>
<span class=normal>2358</span>
<span class=normal>2359</span>
<span class=normal>2360</span>
<span class=normal>2361</span>
<span class=normal>2362</span>
<span class=normal>2363</span>
<span class=normal>2364</span>
<span class=normal>2365</span>
<span class=normal>2366</span>
<span class=normal>2367</span>
<span class=normal>2368</span>
<span class=normal>2369</span>
<span class=normal>2370</span>
<span class=normal>2371</span>
<span class=normal>2372</span>
<span class=normal>2373</span>
<span class=normal>2374</span>
<span class=normal>2375</span>
<span class=normal>2376</span>
<span class=normal>2377</span>
<span class=normal>2378</span>
<span class=normal>2379</span>
<span class=normal>2380</span>
<span class=normal>2381</span>
<span class=normal>2382</span>
<span class=normal>2383</span>
<span class=normal>2384</span>
<span class=normal>2385</span>
<span class=normal>2386</span>
<span class=normal>2387</span>
<span class=normal>2388</span>
<span class=normal>2389</span>
<span class=normal>2390</span>
<span class=normal>2391</span>
<span class=normal>2392</span>
<span class=normal>2393</span>
<span class=normal>2394</span>
<span class=normal>2395</span>
<span class=normal>2396</span>
<span class=normal>2397</span>
<span class=normal>2398</span>
<span class=normal>2399</span>
<span class=normal>2400</span>
<span class=normal>2401</span>
<span class=normal>2402</span>
<span class=normal>2403</span>
<span class=normal>2404</span>
<span class=normal>2405</span>
<span class=normal>2406</span>
<span class=normal>2407</span>
<span class=normal>2408</span>
<span class=normal>2409</span>
<span class=normal>2410</span>
<span class=normal>2411</span>
<span class=normal>2412</span>
<span class=normal>2413</span>
<span class=normal>2414</span>
<span class=normal>2415</span>
<span class=normal>2416</span>
<span class=normal>2417</span>
<span class=normal>2418</span>
<span class=normal>2419</span>
<span class=normal>2420</span>
<span class=normal>2421</span>
<span class=normal>2422</span>
<span class=normal>2423</span>
<span class=normal>2424</span>
<span class=normal>2425</span>
<span class=normal>2426</span>
<span class=normal>2427</span>
<span class=normal>2428</span>
<span class=normal>2429</span>
<span class=normal>2430</span>
<span class=normal>2431</span>
<span class=normal>2432</span>
<span class=normal>2433</span>
<span class=normal>2434</span>
<span class=normal>2435</span>
<span class=normal>2436</span>
<span class=normal>2437</span>
<span class=normal>2438</span>
<span class=normal>2439</span>
<span class=normal>2440</span>
<span class=normal>2441</span>
<span class=normal>2442</span>
<span class=normal>2443</span>
<span class=normal>2444</span>
<span class=normal>2445</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@keyword_deprecation</span><span class=p>(</span><span class=n>replace_x_with_y</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;bw&quot;</span><span class=p>:</span> <span class=s2>&quot;truncate&quot;</span><span class=p>})</span>
<span class=k>def</span><span class=w> </span><span class=nf>dxdt_AnalogSignalArray</span><span class=p>(</span>
    <span class=n>asa</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>smooth</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>rectify</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Numerical differentiation of a regularly sampled AnalogSignalArray.</span>

<span class=sd>    Optionally also smooths result with a Gaussian kernel.</span>

<span class=sd>    Smoothing is applied in time, and the same smoothing is applied to each</span>
<span class=sd>    signal in the AnalogSignalArray.</span>

<span class=sd>    Differentiation, (and if requested, smoothing) is applied within each epoch.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    asa : AnalogSignalArray</span>
<span class=sd>    fs : float, optional</span>
<span class=sd>        Sampling rate (in Hz) of AnalogSignalArray. If not provided, it will</span>
<span class=sd>        be obtained from asa.fs</span>
<span class=sd>    smooth : bool, optional</span>
<span class=sd>        If true, result will be smoothed. Default is False</span>
<span class=sd>    rectify : bool, optional</span>
<span class=sd>        If True, absolute value of derivative is computed. Default is True.</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Standard deviation of Gaussian kernel, in seconds. Default is 0.05</span>
<span class=sd>        (50 ms).</span>
<span class=sd>    truncate : float, optional</span>
<span class=sd>        Bandwidth outside of which the filter value will be zero. Default is 4.0</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : AnalogSignalArray</span>
<span class=sd>        An AnalogSignalArray with derivative data (in units per second) is returned.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>raise</span> <span class=ne>DeprecationWarning</span><span class=p>(</span><span class=s2>&quot;use ddt_asa instead!&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>fs</span> <span class=o>=</span> <span class=n>asa</span><span class=o>.</span><span class=n>fs</span>
    <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;fs must either be specified, or must be contained in the AnalogSignalArray!&quot;</span>
        <span class=p>)</span>
    <span class=k>if</span> <span class=n>sigma</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.05</span>  <span class=c1># 50 ms default</span>

    <span class=n>out</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>asa</span><span class=p>)</span>
    <span class=n>cum_lengths</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>lengths</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

    <span class=c1># ensure that datatype is float</span>
    <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>asa</span><span class=o>.</span><span class=n>n_signals</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
        <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=p>:]</span>

    <span class=c1># now obtain the derivative for each epoch separately</span>
    <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>n_epochs</span><span class=p>):</span>
        <span class=c1># if 1D:</span>
        <span class=k>if</span> <span class=n>asa</span><span class=o>.</span><span class=n>n_signals</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>])</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
                <span class=c1># only single sample</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>gradient</span><span class=p>(</span>
                    <span class=n>asa</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
                <span class=p>)</span>
        <span class=k>elif</span> <span class=n>asa</span><span class=o>.</span><span class=n>n_signals</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>])</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
                <span class=c1># only single sample</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[[</span><span class=mi>0</span><span class=p>],</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span>
                        <span class=n>np</span><span class=o>.</span><span class=n>gradient</span><span class=p>(</span>
                            <span class=n>asa</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span>
                            <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
                        <span class=p>),</span>
                        <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
                    <span class=p>)</span>
                <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;more than 2D not currently supported!&quot;</span><span class=p>)</span>

    <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>*</span> <span class=n>fs</span>

    <span class=k>if</span> <span class=n>rectify</span><span class=p>:</span>
        <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>smooth</span><span class=p>:</span>
        <span class=n>out</span> <span class=o>=</span> <span class=n>gaussian_filter</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=n>fs</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.find_nearest_idx class="doc doc-heading"> <code class="highlight language-python"><span class=n>find_nearest_idx</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>val</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find the index of the nearest value in an array.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>array</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Input array to search in.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>val</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Value to find the nearest index for.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Index into array that is closest to val.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>9</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>find_nearest_idx</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=go>1</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>find_nearest_idx</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span>
<span class=go>2</span>
</code></pre></div> <details class=note open> <summary>Notes</summary> <p>TODO: A more efficient version using searchsorted should be incorporated: Based on answer here: http://stackoverflow.com/questions/2566412/find-nearest-value-in-numpy-array</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2593</span>
<span class=normal>2594</span>
<span class=normal>2595</span>
<span class=normal>2596</span>
<span class=normal>2597</span>
<span class=normal>2598</span>
<span class=normal>2599</span>
<span class=normal>2600</span>
<span class=normal>2601</span>
<span class=normal>2602</span>
<span class=normal>2603</span>
<span class=normal>2604</span>
<span class=normal>2605</span>
<span class=normal>2606</span>
<span class=normal>2607</span>
<span class=normal>2608</span>
<span class=normal>2609</span>
<span class=normal>2610</span>
<span class=normal>2611</span>
<span class=normal>2612</span>
<span class=normal>2613</span>
<span class=normal>2614</span>
<span class=normal>2615</span>
<span class=normal>2616</span>
<span class=normal>2617</span>
<span class=normal>2618</span>
<span class=normal>2619</span>
<span class=normal>2620</span>
<span class=normal>2621</span>
<span class=normal>2622</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>find_nearest_idx</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>val</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Find the index of the nearest value in an array.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    array : np.ndarray</span>
<span class=sd>        Input array to search in.</span>
<span class=sd>    val : float</span>
<span class=sd>        Value to find the nearest index for.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    int</span>
<span class=sd>        Index into array that is closest to val.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; array = np.array([1, 3, 5, 7, 9])</span>
<span class=sd>    &gt;&gt;&gt; find_nearest_idx(array, 4)</span>
<span class=sd>    1</span>
<span class=sd>    &gt;&gt;&gt; find_nearest_idx(array, 6)</span>
<span class=sd>    2</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    TODO: A more efficient version using searchsorted should be incorporated:</span>
<span class=sd>    Based on answer here: http://stackoverflow.com/questions/2566412/find-nearest-value-in-numpy-array</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>array</span> <span class=o>-</span> <span class=n>val</span><span class=p>))</span><span class=o>.</span><span class=n>argmin</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.find_nearest_indices class="doc doc-heading"> <code class="highlight language-python"><span class=n>find_nearest_indices</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>vals</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find indices of nearest values in an array for multiple values.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>array</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Input array to search in.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>vals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of values to find nearest indices for.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of indices into array that are closest to vals.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>9</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>vals</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>find_nearest_indices</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>vals</span><span class=p>)</span>
<span class=go>array([0, 1, 2, 3])</span>
</code></pre></div> <details class=note open> <summary>Notes</summary> <p>Wrapper around find_nearest_idx().</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2625</span>
<span class=normal>2626</span>
<span class=normal>2627</span>
<span class=normal>2628</span>
<span class=normal>2629</span>
<span class=normal>2630</span>
<span class=normal>2631</span>
<span class=normal>2632</span>
<span class=normal>2633</span>
<span class=normal>2634</span>
<span class=normal>2635</span>
<span class=normal>2636</span>
<span class=normal>2637</span>
<span class=normal>2638</span>
<span class=normal>2639</span>
<span class=normal>2640</span>
<span class=normal>2641</span>
<span class=normal>2642</span>
<span class=normal>2643</span>
<span class=normal>2644</span>
<span class=normal>2645</span>
<span class=normal>2646</span>
<span class=normal>2647</span>
<span class=normal>2648</span>
<span class=normal>2649</span>
<span class=normal>2650</span>
<span class=normal>2651</span>
<span class=normal>2652</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>find_nearest_indices</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>vals</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Find indices of nearest values in an array for multiple values.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    array : np.ndarray</span>
<span class=sd>        Input array to search in.</span>
<span class=sd>    vals : np.ndarray</span>
<span class=sd>        Array of values to find nearest indices for.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Array of indices into array that are closest to vals.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; array = np.array([1, 3, 5, 7, 9])</span>
<span class=sd>    &gt;&gt;&gt; vals = np.array([2, 4, 6, 8])</span>
<span class=sd>    &gt;&gt;&gt; find_nearest_indices(array, vals)</span>
<span class=sd>    array([0, 1, 2, 3])</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    Wrapper around find_nearest_idx().</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>find_nearest_idx</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>val</span><span class=p>)</span> <span class=k>for</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>vals</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.find_threshold_crossing_events class="doc doc-heading"> <code class="highlight language-python"><span class=n>find_threshold_crossing_events</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>threshold</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;above&#39;</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find threshold crossing events. INCLUSIVE</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>x</code> </td> <td> <code>numpy array</code> </td> <td> <div class=doc-md-description> <p>Input data</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>threshold</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>The value whose crossing triggers an event</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>mode</code> </td> <td> <code>string, optional in [&#39;above&#39;, &#39;below&#39;]; default &#39;above&#39;</code> </td> <td> <div class=doc-md-description> <p>event triggering above, or below threshold</p> </div> </td> <td> <code>&#39;above&#39;</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>eventlist</code></td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>List containing the indices corresponding to threshold crossings</p> </div> </td> </tr> <tr class=doc-section-item> <td><code>eventmax</code></td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>List containing the maximum value of each event</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1623</span>
<span class=normal>1624</span>
<span class=normal>1625</span>
<span class=normal>1626</span>
<span class=normal>1627</span>
<span class=normal>1628</span>
<span class=normal>1629</span>
<span class=normal>1630</span>
<span class=normal>1631</span>
<span class=normal>1632</span>
<span class=normal>1633</span>
<span class=normal>1634</span>
<span class=normal>1635</span>
<span class=normal>1636</span>
<span class=normal>1637</span>
<span class=normal>1638</span>
<span class=normal>1639</span>
<span class=normal>1640</span>
<span class=normal>1641</span>
<span class=normal>1642</span>
<span class=normal>1643</span>
<span class=normal>1644</span>
<span class=normal>1645</span>
<span class=normal>1646</span>
<span class=normal>1647</span>
<span class=normal>1648</span>
<span class=normal>1649</span>
<span class=normal>1650</span>
<span class=normal>1651</span>
<span class=normal>1652</span>
<span class=normal>1653</span>
<span class=normal>1654</span>
<span class=normal>1655</span>
<span class=normal>1656</span>
<span class=normal>1657</span>
<span class=normal>1658</span>
<span class=normal>1659</span>
<span class=normal>1660</span>
<span class=normal>1661</span>
<span class=normal>1662</span>
<span class=normal>1663</span>
<span class=normal>1664</span>
<span class=normal>1665</span>
<span class=normal>1666</span>
<span class=normal>1667</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>find_threshold_crossing_events</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>threshold</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;above&quot;</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Find threshold crossing events. INCLUSIVE</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    x : numpy array</span>
<span class=sd>        Input data</span>
<span class=sd>    threshold : float</span>
<span class=sd>        The value whose crossing triggers an event</span>
<span class=sd>    mode : string, optional in [&#39;above&#39;, &#39;below&#39;]; default &#39;above&#39;</span>
<span class=sd>        event triggering above, or below threshold</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    eventlist : list</span>
<span class=sd>        List containing the indices corresponding to threshold crossings</span>
<span class=sd>    eventmax : list</span>
<span class=sd>        List containing the maximum value of each event</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>itertools</span><span class=w> </span><span class=kn>import</span> <span class=n>groupby</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>operator</span><span class=w> </span><span class=kn>import</span> <span class=n>itemgetter</span>

    <span class=k>if</span> <span class=n>mode</span> <span class=o>==</span> <span class=s2>&quot;below&quot;</span><span class=p>:</span>
        <span class=n>cross_threshold</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>x</span> <span class=o>&lt;=</span> <span class=n>threshold</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>mode</span> <span class=o>==</span> <span class=s2>&quot;above&quot;</span><span class=p>:</span>
        <span class=n>cross_threshold</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>x</span> <span class=o>&gt;=</span> <span class=n>threshold</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span>
            <span class=s2>&quot;mode </span><span class=si>{}</span><span class=s2> not understood for find_threshold_crossing_events&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=nb>str</span><span class=p>(</span><span class=n>mode</span><span class=p>)</span>
            <span class=p>)</span>
        <span class=p>)</span>
    <span class=n>eventlist</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>eventmax</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>groupby</span><span class=p>(</span><span class=nb>enumerate</span><span class=p>(</span><span class=n>cross_threshold</span><span class=p>),</span> <span class=n>key</span><span class=o>=</span><span class=n>itemgetter</span><span class=p>(</span><span class=mi>1</span><span class=p>)):</span>
        <span class=k>if</span> <span class=n>k</span><span class=p>:</span>
            <span class=n>v</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
            <span class=n>eventlist</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span> <span class=n>v</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]])</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>eventmax</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=p>:</span> <span class=p>(</span><span class=n>v</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span><span class=o>.</span><span class=n>max</span><span class=p>())</span>
            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                <span class=nb>print</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>x</span><span class=p>[</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=p>:</span> <span class=n>v</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]])</span>
    <span class=n>eventmax</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>eventmax</span><span class=p>)</span>
    <span class=n>eventlist</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>eventlist</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>eventlist</span><span class=p>,</span> <span class=n>eventmax</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.frange class="doc doc-heading"> <code class="highlight language-python"><span class=n>frange</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>stop</span><span class=p>,</span> <span class=n>step</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Generate a range of floating point values with a given step size.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>start</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Start value.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>stop</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Stop value (exclusive).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>step</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Step size.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of values from start to stop (exclusive) with given step.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>frange</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>)</span>
<span class=go>array([0. , 0.2, 0.4, 0.6, 0.8])</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>frange</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>stop</span><span class=p>,</span> <span class=n>step</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Generate a range of floating point values with a given step size.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    start : float</span>
<span class=sd>        Start value.</span>
<span class=sd>    stop : float</span>
<span class=sd>        Stop value (exclusive).</span>
<span class=sd>    step : float</span>
<span class=sd>        Step size.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : np.ndarray</span>
<span class=sd>        Array of values from start to stop (exclusive) with given step.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; frange(0, 1, 0.2)</span>
<span class=sd>    array([0. , 0.2, 0.4, 0.6, 0.8])</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>num_steps</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>floor</span><span class=p>((</span><span class=n>stop</span> <span class=o>-</span> <span class=n>start</span><span class=p>)</span> <span class=o>/</span> <span class=n>step</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>stop</span><span class=p>,</span> <span class=n>num</span><span class=o>=</span><span class=n>num_steps</span><span class=p>,</span> <span class=n>endpoint</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.gaussian_filter class="doc doc-heading"> <code class="highlight language-python"><span class=n>gaussian_filter</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>cval</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>within_intervals</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Smooths with a Gaussian kernel.</p> <p>Smoothing is applied along the abscissa, and the same smoothing is applied to each signal in the RegularlySampledAnalogSignalArray, or to each unit in a BinnedSpikeTrainArray.</p> <p>Smoothing is applied ACROSS intervals, but smoothing WITHIN intervals is also supported.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>obj</code> </td> <td> <code>RegularlySampledAnalogSignalArray or BinnedSpikeTrainArray.</code> </td> <td> <div class=doc-md-description> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fs</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Sampling rate (in obj.base_unit^-1) of obj. If not provided, it will be inferred.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Standard deviation of Gaussian kernel, in obj.base_units. Default is 0.05 (50 ms if base_unit=seconds).</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>truncate</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Bandwidth outside of which the filter value will be zero. Default is 4.0.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>inplace</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True the data will be replaced with the smoothed data. Default is False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>mode</code> </td> <td> <code>(<span title=reflect>reflect</span>, <span title=constant>constant</span>, <span title=nearest>nearest</span>, <span title=mirror>mirror</span>, <span title=wrap>wrap</span>)</code> </td> <td> <div class=doc-md-description> <p>The mode parameter determines how the array borders are handled, where cval is the value when mode is equal to 'constant'. Default is 'reflect'.</p> </div> </td> <td> <code>&#39;reflect&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>cval</code> </td> <td> <code><span title=scalar>scalar</span></code> </td> <td> <div class=doc-md-description> <p>Value to fill past edges of input if mode is 'constant'. Default is 0.0.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>within_intervals</code> </td> <td> <code><span title=boolean>boolean</span></code> </td> <td> <div class=doc-md-description> <p>If True, then smooth within each epoch. Otherwise smooth across epochs. Default is False. Note that when mode = 'wrap', then smoothing within epochs aren't affected by wrapping.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code>same type as obj</code> </td> <td> <div class=doc-md-description> <p>An object with smoothed data is returned.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1981</span>
<span class=normal>1982</span>
<span class=normal>1983</span>
<span class=normal>1984</span>
<span class=normal>1985</span>
<span class=normal>1986</span>
<span class=normal>1987</span>
<span class=normal>1988</span>
<span class=normal>1989</span>
<span class=normal>1990</span>
<span class=normal>1991</span>
<span class=normal>1992</span>
<span class=normal>1993</span>
<span class=normal>1994</span>
<span class=normal>1995</span>
<span class=normal>1996</span>
<span class=normal>1997</span>
<span class=normal>1998</span>
<span class=normal>1999</span>
<span class=normal>2000</span>
<span class=normal>2001</span>
<span class=normal>2002</span>
<span class=normal>2003</span>
<span class=normal>2004</span>
<span class=normal>2005</span>
<span class=normal>2006</span>
<span class=normal>2007</span>
<span class=normal>2008</span>
<span class=normal>2009</span>
<span class=normal>2010</span>
<span class=normal>2011</span>
<span class=normal>2012</span>
<span class=normal>2013</span>
<span class=normal>2014</span>
<span class=normal>2015</span>
<span class=normal>2016</span>
<span class=normal>2017</span>
<span class=normal>2018</span>
<span class=normal>2019</span>
<span class=normal>2020</span>
<span class=normal>2021</span>
<span class=normal>2022</span>
<span class=normal>2023</span>
<span class=normal>2024</span>
<span class=normal>2025</span>
<span class=normal>2026</span>
<span class=normal>2027</span>
<span class=normal>2028</span>
<span class=normal>2029</span>
<span class=normal>2030</span>
<span class=normal>2031</span>
<span class=normal>2032</span>
<span class=normal>2033</span>
<span class=normal>2034</span>
<span class=normal>2035</span>
<span class=normal>2036</span>
<span class=normal>2037</span>
<span class=normal>2038</span>
<span class=normal>2039</span>
<span class=normal>2040</span>
<span class=normal>2041</span>
<span class=normal>2042</span>
<span class=normal>2043</span>
<span class=normal>2044</span>
<span class=normal>2045</span>
<span class=normal>2046</span>
<span class=normal>2047</span>
<span class=normal>2048</span>
<span class=normal>2049</span>
<span class=normal>2050</span>
<span class=normal>2051</span>
<span class=normal>2052</span>
<span class=normal>2053</span>
<span class=normal>2054</span>
<span class=normal>2055</span>
<span class=normal>2056</span>
<span class=normal>2057</span>
<span class=normal>2058</span>
<span class=normal>2059</span>
<span class=normal>2060</span>
<span class=normal>2061</span>
<span class=normal>2062</span>
<span class=normal>2063</span>
<span class=normal>2064</span>
<span class=normal>2065</span>
<span class=normal>2066</span>
<span class=normal>2067</span>
<span class=normal>2068</span>
<span class=normal>2069</span>
<span class=normal>2070</span>
<span class=normal>2071</span>
<span class=normal>2072</span>
<span class=normal>2073</span>
<span class=normal>2074</span>
<span class=normal>2075</span>
<span class=normal>2076</span>
<span class=normal>2077</span>
<span class=normal>2078</span>
<span class=normal>2079</span>
<span class=normal>2080</span>
<span class=normal>2081</span>
<span class=normal>2082</span>
<span class=normal>2083</span>
<span class=normal>2084</span>
<span class=normal>2085</span>
<span class=normal>2086</span>
<span class=normal>2087</span>
<span class=normal>2088</span>
<span class=normal>2089</span>
<span class=normal>2090</span>
<span class=normal>2091</span>
<span class=normal>2092</span>
<span class=normal>2093</span>
<span class=normal>2094</span>
<span class=normal>2095</span>
<span class=normal>2096</span>
<span class=normal>2097</span>
<span class=normal>2098</span>
<span class=normal>2099</span>
<span class=normal>2100</span>
<span class=normal>2101</span>
<span class=normal>2102</span>
<span class=normal>2103</span>
<span class=normal>2104</span>
<span class=normal>2105</span>
<span class=normal>2106</span>
<span class=normal>2107</span>
<span class=normal>2108</span>
<span class=normal>2109</span>
<span class=normal>2110</span>
<span class=normal>2111</span>
<span class=normal>2112</span>
<span class=normal>2113</span>
<span class=normal>2114</span>
<span class=normal>2115</span>
<span class=normal>2116</span>
<span class=normal>2117</span>
<span class=normal>2118</span>
<span class=normal>2119</span>
<span class=normal>2120</span>
<span class=normal>2121</span>
<span class=normal>2122</span>
<span class=normal>2123</span>
<span class=normal>2124</span>
<span class=normal>2125</span>
<span class=normal>2126</span>
<span class=normal>2127</span>
<span class=normal>2128</span>
<span class=normal>2129</span>
<span class=normal>2130</span>
<span class=normal>2131</span>
<span class=normal>2132</span>
<span class=normal>2133</span>
<span class=normal>2134</span>
<span class=normal>2135</span>
<span class=normal>2136</span>
<span class=normal>2137</span>
<span class=normal>2138</span>
<span class=normal>2139</span>
<span class=normal>2140</span>
<span class=normal>2141</span>
<span class=normal>2142</span>
<span class=normal>2143</span>
<span class=normal>2144</span>
<span class=normal>2145</span>
<span class=normal>2146</span>
<span class=normal>2147</span>
<span class=normal>2148</span>
<span class=normal>2149</span>
<span class=normal>2150</span>
<span class=normal>2151</span>
<span class=normal>2152</span>
<span class=normal>2153</span>
<span class=normal>2154</span>
<span class=normal>2155</span>
<span class=normal>2156</span>
<span class=normal>2157</span>
<span class=normal>2158</span>
<span class=normal>2159</span>
<span class=normal>2160</span>
<span class=normal>2161</span>
<span class=normal>2162</span>
<span class=normal>2163</span>
<span class=normal>2164</span>
<span class=normal>2165</span>
<span class=normal>2166</span>
<span class=normal>2167</span>
<span class=normal>2168</span>
<span class=normal>2169</span>
<span class=normal>2170</span>
<span class=normal>2171</span>
<span class=normal>2172</span>
<span class=normal>2173</span>
<span class=normal>2174</span>
<span class=normal>2175</span>
<span class=normal>2176</span>
<span class=normal>2177</span>
<span class=normal>2178</span>
<span class=normal>2179</span>
<span class=normal>2180</span>
<span class=normal>2181</span>
<span class=normal>2182</span>
<span class=normal>2183</span>
<span class=normal>2184</span>
<span class=normal>2185</span>
<span class=normal>2186</span>
<span class=normal>2187</span>
<span class=normal>2188</span>
<span class=normal>2189</span>
<span class=normal>2190</span>
<span class=normal>2191</span>
<span class=normal>2192</span>
<span class=normal>2193</span>
<span class=normal>2194</span>
<span class=normal>2195</span>
<span class=normal>2196</span>
<span class=normal>2197</span>
<span class=normal>2198</span>
<span class=normal>2199</span>
<span class=normal>2200</span>
<span class=normal>2201</span>
<span class=normal>2202</span>
<span class=normal>2203</span>
<span class=normal>2204</span>
<span class=normal>2205</span>
<span class=normal>2206</span>
<span class=normal>2207</span>
<span class=normal>2208</span>
<span class=normal>2209</span>
<span class=normal>2210</span>
<span class=normal>2211</span>
<span class=normal>2212</span>
<span class=normal>2213</span>
<span class=normal>2214</span>
<span class=normal>2215</span>
<span class=normal>2216</span>
<span class=normal>2217</span>
<span class=normal>2218</span>
<span class=normal>2219</span>
<span class=normal>2220</span>
<span class=normal>2221</span>
<span class=normal>2222</span>
<span class=normal>2223</span>
<span class=normal>2224</span>
<span class=normal>2225</span>
<span class=normal>2226</span>
<span class=normal>2227</span>
<span class=normal>2228</span>
<span class=normal>2229</span>
<span class=normal>2230</span>
<span class=normal>2231</span>
<span class=normal>2232</span>
<span class=normal>2233</span>
<span class=normal>2234</span>
<span class=normal>2235</span>
<span class=normal>2236</span>
<span class=normal>2237</span>
<span class=normal>2238</span>
<span class=normal>2239</span>
<span class=normal>2240</span>
<span class=normal>2241</span>
<span class=normal>2242</span>
<span class=normal>2243</span>
<span class=normal>2244</span>
<span class=normal>2245</span>
<span class=normal>2246</span>
<span class=normal>2247</span>
<span class=normal>2248</span>
<span class=normal>2249</span>
<span class=normal>2250</span>
<span class=normal>2251</span>
<span class=normal>2252</span>
<span class=normal>2253</span>
<span class=normal>2254</span>
<span class=normal>2255</span>
<span class=normal>2256</span>
<span class=normal>2257</span>
<span class=normal>2258</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@keyword_deprecation</span><span class=p>(</span><span class=n>replace_x_with_y</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;bw&quot;</span><span class=p>:</span> <span class=s2>&quot;truncate&quot;</span><span class=p>})</span>
<span class=k>def</span><span class=w> </span><span class=nf>gaussian_filter</span><span class=p>(</span>
    <span class=n>obj</span><span class=p>,</span>
    <span class=o>*</span><span class=p>,</span>
    <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>inplace</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>mode</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>cval</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>within_intervals</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Smooths with a Gaussian kernel.</span>

<span class=sd>    Smoothing is applied along the abscissa, and the same smoothing is applied to each</span>
<span class=sd>    signal in the RegularlySampledAnalogSignalArray, or to each unit in a BinnedSpikeTrainArray.</span>

<span class=sd>    Smoothing is applied ACROSS intervals, but smoothing WITHIN intervals is also supported.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    obj : RegularlySampledAnalogSignalArray or BinnedSpikeTrainArray.</span>
<span class=sd>    fs : float, optional</span>
<span class=sd>        Sampling rate (in obj.base_unit^-1) of obj. If not provided, it will</span>
<span class=sd>        be inferred.</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Standard deviation of Gaussian kernel, in obj.base_units. Default is 0.05</span>
<span class=sd>        (50 ms if base_unit=seconds).</span>
<span class=sd>    truncate : float, optional</span>
<span class=sd>        Bandwidth outside of which the filter value will be zero. Default is 4.0.</span>
<span class=sd>    inplace : bool</span>
<span class=sd>        If True the data will be replaced with the smoothed data.</span>
<span class=sd>        Default is False.</span>
<span class=sd>    mode : {&#39;reflect&#39;, &#39;constant&#39;, &#39;nearest&#39;, &#39;mirror&#39;, &#39;wrap&#39;}, optional</span>
<span class=sd>        The mode parameter determines how the array borders are handled,</span>
<span class=sd>        where cval is the value when mode is equal to &#39;constant&#39;. Default is</span>
<span class=sd>        &#39;reflect&#39;.</span>
<span class=sd>    cval : scalar, optional</span>
<span class=sd>        Value to fill past edges of input if mode is &#39;constant&#39;. Default is 0.0.</span>
<span class=sd>    within_intervals : boolean, optional</span>
<span class=sd>        If True, then smooth within each epoch. Otherwise smooth across epochs.</span>
<span class=sd>        Default is False.</span>
<span class=sd>        Note that when mode = &#39;wrap&#39;, then smoothing within epochs aren&#39;t affected</span>
<span class=sd>        by wrapping.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : same type as obj</span>
<span class=sd>        An object with smoothed data is returned.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>sigma</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.05</span>
    <span class=k>if</span> <span class=n>truncate</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>truncate</span> <span class=o>=</span> <span class=mi>4</span>
    <span class=k>if</span> <span class=n>mode</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>mode</span> <span class=o>=</span> <span class=s2>&quot;reflect&quot;</span>
    <span class=k>if</span> <span class=n>cval</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>cval</span> <span class=o>=</span> <span class=mf>0.0</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>inplace</span><span class=p>:</span>
        <span class=n>out</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>out</span> <span class=o>=</span> <span class=n>obj</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span>
        <span class=n>out</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>_analogsignalarray</span><span class=o>.</span><span class=n>PositionArray</span>
    <span class=p>):</span>
        <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>fs</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>fs</span>
        <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;fs must either be specified, or must be contained in the </span><span class=si>{}</span><span class=s2>!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>out</span><span class=o>.</span><span class=n>type_name</span>
                <span class=p>)</span>
            <span class=p>)</span>
    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>BinnedEventArray</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span>
        <span class=n>out</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>_valeventarray</span><span class=o>.</span><span class=n>BinnedValueEventArray</span>
    <span class=p>):</span>
        <span class=n>bst</span> <span class=o>=</span> <span class=n>out</span>
        <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>fs</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>bst</span><span class=o>.</span><span class=n>ds</span>
        <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;fs must either be specified, or must be contained in the </span><span class=si>{}</span><span class=s2>!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=n>out</span><span class=o>.</span><span class=n>type_name</span>
                <span class=p>)</span>
            <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span>
            <span class=s2>&quot;gaussian_filter for </span><span class=si>{}</span><span class=s2> is not yet supported!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>out</span><span class=p>)))</span>
        <span class=p>)</span>

    <span class=n>sigma</span> <span class=o>=</span> <span class=n>sigma</span> <span class=o>*</span> <span class=n>fs</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>within_intervals</span><span class=p>:</span>
        <span class=c1># see https://stackoverflow.com/questions/18697532/gaussian-filtering-a-image-with-nan-in-python</span>
        <span class=c1># (1) if smoothing across intervals, we work on a merged support</span>
        <span class=c1># (2) build abscissa_vals, including existing ones, and out-of-support ones</span>
        <span class=c1># (3) to smooth U, build auxiliary arrays V and W, with (V=U).nan=0, and (W=1).nan=0</span>
        <span class=c1># (4) Z = smooth(V)/smooth(W)</span>
        <span class=c1># (5) only keep original support, and original abscissa_vals</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span>
            <span class=n>out</span><span class=p>,</span>
            <span class=p>(</span>
                <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>,</span>
                <span class=n>core</span><span class=o>.</span><span class=n>BinnedEventArray</span><span class=p>,</span>
                <span class=n>core</span><span class=o>.</span><span class=n>_analogsignalarray</span><span class=o>.</span><span class=n>PositionArray</span><span class=p>,</span>
                <span class=n>core</span><span class=o>.</span><span class=n>_valeventarray</span><span class=o>.</span><span class=n>BinnedValueEventArray</span><span class=p>,</span>
            <span class=p>),</span>
        <span class=p>):</span>
            <span class=n>support</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>_abscissa</span><span class=o>.</span><span class=n>support</span><span class=o>.</span><span class=n>merge</span><span class=p>()</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>support</span><span class=o>.</span><span class=n>domain</span><span class=o>.</span><span class=n>is_finite</span><span class=p>:</span>
                <span class=n>support</span><span class=o>.</span><span class=n>domain</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>support</span><span class=o>.</span><span class=n>start</span><span class=p>,</span>
                    <span class=n>support</span><span class=o>.</span><span class=n>stop</span><span class=p>,</span>
                <span class=p>)</span>  <span class=c1># TODO: #FIXME might come from abscissa definition, and not from support</span>

            <span class=n>missing_abscissa_vals</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=k>for</span> <span class=n>interval</span> <span class=ow>in</span> <span class=o>~</span><span class=n>support</span><span class=p>:</span>
                <span class=n>missing_vals</span> <span class=o>=</span> <span class=n>frange</span><span class=p>(</span><span class=n>interval</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>interval</span><span class=o>.</span><span class=n>stop</span><span class=p>,</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>fs</span><span class=p>)</span>
                <span class=n>missing_abscissa_vals</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>missing_vals</span><span class=p>)</span>

            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span>
                <span class=n>out</span><span class=p>,</span>
                <span class=p>(</span>
                    <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>,</span>
                    <span class=n>core</span><span class=o>.</span><span class=n>_analogsignalarray</span><span class=o>.</span><span class=n>PositionArray</span><span class=p>,</span>
                <span class=p>),</span>
            <span class=p>):</span>
                <span class=n>n_signals</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>n_signals</span>
                <span class=n>n_samples</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>n_samples</span>
                <span class=n>V</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_signals</span><span class=p>,</span> <span class=n>n_samples</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>missing_abscissa_vals</span><span class=p>)))</span>
                <span class=n>W</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>V</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
                <span class=n>all_abscissa_vals</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span>
                    <span class=n>np</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>_abscissa_vals</span><span class=p>,</span> <span class=n>missing_abscissa_vals</span><span class=p>)</span>
                <span class=p>)</span>
                <span class=n>data_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>all_abscissa_vals</span><span class=p>,</span> <span class=n>out</span><span class=o>.</span><span class=n>_abscissa_vals</span><span class=p>)</span>
                <span class=n>missing_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>all_abscissa_vals</span><span class=p>,</span> <span class=n>missing_abscissa_vals</span><span class=p>)</span>
                <span class=n>V</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>]</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span>
                <span class=n>W</span><span class=p>[:,</span> <span class=n>missing_idx</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>

                <span class=n>VV</span> <span class=o>=</span> <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                    <span class=n>V</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=n>mode</span><span class=p>,</span> <span class=n>cval</span><span class=o>=</span><span class=n>cval</span>
                <span class=p>)</span>
                <span class=n>WW</span> <span class=o>=</span> <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                    <span class=n>W</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=n>mode</span><span class=p>,</span> <span class=n>cval</span><span class=o>=</span><span class=n>cval</span>
                <span class=p>)</span>

                <span class=n>Z</span> <span class=o>=</span> <span class=n>VV</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>]</span> <span class=o>/</span> <span class=n>WW</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>]</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>Z</span>
            <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span>
                <span class=n>out</span><span class=p>,</span> <span class=p>(</span><span class=n>core</span><span class=o>.</span><span class=n>BinnedEventArray</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>_valeventarray</span><span class=o>.</span><span class=n>BinnedValueEventArray</span><span class=p>)</span>
            <span class=p>):</span>
                <span class=n>n_signals</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>n_series</span>
                <span class=n>n_samples</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>n_bins</span>
                <span class=k>if</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
                    <span class=c1># (n_series, n_bins) - legacy BinnedEventArray</span>
                    <span class=n>V</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_signals</span><span class=p>,</span> <span class=n>n_samples</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>missing_abscissa_vals</span><span class=p>)))</span>
                    <span class=n>W</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>V</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
                    <span class=n>all_abscissa_vals</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span>
                        <span class=n>np</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>_abscissa_vals</span><span class=p>,</span> <span class=n>missing_abscissa_vals</span><span class=p>)</span>
                    <span class=p>)</span>
                    <span class=n>data_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>all_abscissa_vals</span><span class=p>,</span> <span class=n>out</span><span class=o>.</span><span class=n>_abscissa_vals</span><span class=p>)</span>
                    <span class=n>missing_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span>
                        <span class=n>all_abscissa_vals</span><span class=p>,</span> <span class=n>missing_abscissa_vals</span>
                    <span class=p>)</span>
                    <span class=n>V</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>]</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span>
                    <span class=n>W</span><span class=p>[:,</span> <span class=n>missing_idx</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>

                    <span class=n>VV</span> <span class=o>=</span> <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                        <span class=n>V</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=n>mode</span><span class=p>,</span> <span class=n>cval</span><span class=o>=</span><span class=n>cval</span>
                    <span class=p>)</span>
                    <span class=n>WW</span> <span class=o>=</span> <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                        <span class=n>W</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=n>mode</span><span class=p>,</span> <span class=n>cval</span><span class=o>=</span><span class=n>cval</span>
                    <span class=p>)</span>

                    <span class=n>Z</span> <span class=o>=</span> <span class=n>VV</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>]</span> <span class=o>/</span> <span class=n>WW</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>]</span>
                    <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>Z</span>
                <span class=k>elif</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
                    <span class=c1># (n_series, n_bins, n_values) - BinnedValueEventArray</span>
                    <span class=n>n_values</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
                    <span class=n>V</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span>
                        <span class=p>(</span><span class=n>n_signals</span><span class=p>,</span> <span class=n>n_samples</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>missing_abscissa_vals</span><span class=p>),</span> <span class=n>n_values</span><span class=p>)</span>
                    <span class=p>)</span>
                    <span class=n>W</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>V</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
                    <span class=n>all_abscissa_vals</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span>
                        <span class=n>np</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>_abscissa_vals</span><span class=p>,</span> <span class=n>missing_abscissa_vals</span><span class=p>)</span>
                    <span class=p>)</span>
                    <span class=n>data_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>all_abscissa_vals</span><span class=p>,</span> <span class=n>out</span><span class=o>.</span><span class=n>_abscissa_vals</span><span class=p>)</span>
                    <span class=n>missing_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span>
                        <span class=n>all_abscissa_vals</span><span class=p>,</span> <span class=n>missing_abscissa_vals</span>
                    <span class=p>)</span>
                    <span class=n>V</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span>
                    <span class=n>W</span><span class=p>[:,</span> <span class=n>missing_idx</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=mi>0</span>
                    <span class=n>VV</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty_like</span><span class=p>(</span><span class=n>V</span><span class=p>)</span>
                    <span class=n>WW</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty_like</span><span class=p>(</span><span class=n>W</span><span class=p>)</span>
                    <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_values</span><span class=p>):</span>
                        <span class=n>VV</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>v</span><span class=p>]</span> <span class=o>=</span> <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                            <span class=n>V</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>v</span><span class=p>],</span>
                            <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span>
                            <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span>
                            <span class=n>mode</span><span class=o>=</span><span class=n>mode</span><span class=p>,</span>
                            <span class=n>cval</span><span class=o>=</span><span class=n>cval</span><span class=p>,</span>
                        <span class=p>)</span>
                        <span class=n>WW</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>v</span><span class=p>]</span> <span class=o>=</span> <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                            <span class=n>W</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=n>v</span><span class=p>],</span>
                            <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span>
                            <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span>
                            <span class=n>mode</span><span class=o>=</span><span class=n>mode</span><span class=p>,</span>
                            <span class=n>cval</span><span class=o>=</span><span class=n>cval</span><span class=p>,</span>
                        <span class=p>)</span>
                    <span class=n>Z</span> <span class=o>=</span> <span class=n>VV</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>,</span> <span class=p>:]</span> <span class=o>/</span> <span class=n>WW</span><span class=p>[:,</span> <span class=n>data_idx</span><span class=p>,</span> <span class=p>:]</span>
                    <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>Z</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                        <span class=s2>&quot;Unsupported data shape for BinnedValueEventArray: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                            <span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>shape</span>
                        <span class=p>)</span>
                    <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span>
                <span class=s2>&quot;gaussian_filter across intervals for </span><span class=si>{}</span><span class=s2> is not yet supported!&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=nb>str</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>out</span><span class=p>))</span>
                <span class=p>)</span>
            <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>  <span class=c1># within intervals:</span>
        <span class=n>cum_lengths</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>lengths</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
        <span class=n>out</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>):</span>
            <span class=c1># now smooth each interval separately</span>
            <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>n_intervals</span><span class=p>):</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                        <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span>
                        <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span>
                        <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span>
                    <span class=p>)</span>
                <span class=p>)</span>
        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>BinnedSpikeTrainArray</span><span class=p>):</span>
            <span class=c1># now smooth each interval separately</span>
            <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>n_epochs</span><span class=p>):</span>
                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                        <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span>
                        <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span>
                        <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span>
                    <span class=p>)</span>
                <span class=p>)</span>
                <span class=c1># out._data[:,cum_lengths[idx]:cum_lengths[idx+1]] = self._smooth_array(out._data[:,cum_lengths[idx]:cum_lengths[idx+1]], w=w)</span>
        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>_valeventarray</span><span class=o>.</span><span class=n>BinnedValueEventArray</span><span class=p>):</span>
            <span class=c1># now smooth each interval separately for each value type</span>
            <span class=k>if</span> <span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>n_intervals</span><span class=p>):</span>
                    <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>2</span><span class=p>]):</span>
                        <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=n>v</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
                            <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                                <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[</span>
                                    <span class=p>:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=n>v</span>
                                <span class=p>],</span>
                                <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span>
                                <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span>
                            <span class=p>)</span>
                        <span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># fallback to 2D smoothing (shouldn&#39;t happen for BinnedValueEventArray, but for safety)</span>
                <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>n_intervals</span><span class=p>):</span>
                    <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span>
                        <span class=n>scipy_gaussian_filter</span><span class=p>(</span>
                            <span class=n>out</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span>
                            <span class=n>sigma</span><span class=o>=</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>sigma</span><span class=p>),</span>
                            <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span>
                        <span class=p>)</span>
                    <span class=p>)</span>

    <span class=k>return</span> <span class=n>out</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_PBEs class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_PBEs</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>unsorted_id</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>min_active</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>minLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>maxLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>minThresholdLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Determine PBEs from multiunit activity or spike trains.</p> <details class=definitions open> <summary>Definitions</summary> <p>MUA : multiunit activity PBE : population burst event</p> </details> <details class=summary open> <summary>Summary</summary> <p>This function can be used to identify PBE epochs from spike trains, binned spike trains, or multiunit activity (in the form of an AnalogSignalArray).</p> <p>It is recommended to either pass in a SpikeTrainArray or a BinnedSpikeTrainArray, so that a <code>min_active</code> number of sorted units can be set.</p> <p>It is also recommended that the unsorted units (but not noise artifacts!) should be included in the spike train that is used to estimate the PBEs. By default, unit_id=0 is assumed to be unsorted, but this can be changed, or if no unsorted units are present, you can set unsorted_id=None. Equivalently, if min_active=0, then no restriction will apply, and the unsorted_id will have no effect on the final PBE epochs.</p> </details> <p><span class=doc-section-title>Examples:</span></p> <p>PBE_epochs = get_PBEs(mua_asa) PBE_epochs = get_PBEs(spiketrain, min_active=5) PBE_epochs = get_PBEs(binnedspiketrain, min_active=5)</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray with one signal, namely the multiunit firing rate [in Hz]. -- OR --</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.SpikeTrainArray>SpikeTrainArray</a></code> </td> <td> <div class=doc-md-description> <p>SpikeTrainArray with multiple units, including unsorted unit(s), but excluding any noise artifects. -- OR --</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.BinnedSpikeTrainArray>BinnedSpikeTrainArray</a></code> </td> <td> <div class=doc-md-description> <p>BinnedSpikeTrainArray containing multiunit activity.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fs</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Sampling frequency of mua, in Hz. If not specified, it will be inferred from data.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>ds</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Time step in which to bin spikes. Default is 1 ms.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Standard deviation (in seconds) of Gaussian smoothing kernel. Default is 10 ms. If sigma==0 then no smoothing is applied.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>truncate</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Bandwidth of the Gaussian filter. Default is 6.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>unsorted_id</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>unit_id of the unsorted unit. Default is 0. If no unsorted unit is present, then set unsorted_id = None</p> </div> </td> <td> <code>0</code> </td> </tr> <tr class=doc-section-item> <td> <code>min_active</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Minimum number of active units per event, excluding unsorted unit. Default is 5.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>minLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Minimum event duration in seconds. Default is 50 ms.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>maxLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Maximum event duration in seconds. Default is 750 ms.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>PrimaryThreshold</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Primary threshold to exceed. Default is mean() + 3*std()</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>SecondaryThreshold</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Secondary threshold to fall back to. Default is mean().</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>minThresholdLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Minimum duration to stay above PrimaryThreshold. Default is 0 ms.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>PBE_epochs</code></td> <td> <code><a class="autorefs autorefs-internal" href=../../core/intervalarray/#nelpy.core._intervalarray.EpochArray>EpochArray</a></code> </td> <td> <div class=doc-md-description> <p>EpochArray containing all the PBEs.</p> </div> </td> </tr> </tbody> </table> <details class=future-improvements open> <summary>Future improvements</summary> <p>As of now, it is possible, but not easy to specify the Primary and Secondary thresholds for event detection. A slight change in API might be needed to make this specification more flexible.</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@keyword_deprecation</span><span class=p>(</span><span class=n>replace_x_with_y</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;bw&quot;</span><span class=p>:</span> <span class=s2>&quot;truncate&quot;</span><span class=p>})</span>
<span class=k>def</span><span class=w> </span><span class=nf>get_PBEs</span><span class=p>(</span>
    <span class=n>data</span><span class=p>,</span>
    <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>ds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>unsorted_id</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>min_active</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>minLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>maxLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>minThresholdLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Determine PBEs from multiunit activity or spike trains.</span>

<span class=sd>    Definitions</span>
<span class=sd>    -----------</span>
<span class=sd>    MUA : multiunit activity</span>
<span class=sd>    PBE : population burst event</span>

<span class=sd>    Summary</span>
<span class=sd>    -------</span>
<span class=sd>    This function can be used to identify PBE epochs from spike trains, binned</span>
<span class=sd>    spike trains, or multiunit activity (in the form of an AnalogSignalArray).</span>

<span class=sd>    It is recommended to either pass in a SpikeTrainArray or a</span>
<span class=sd>    BinnedSpikeTrainArray, so that a `min_active` number of sorted units can be</span>
<span class=sd>    set.</span>

<span class=sd>    It is also recommended that the unsorted units (but not noise artifacts!)</span>
<span class=sd>    should be included in the spike train that is used to estimate the PBEs. By</span>
<span class=sd>    default, unit_id=0 is assumed to be unsorted, but this can be changed, or if</span>
<span class=sd>    no unsorted units are present, you can set unsorted_id=None. Equivalently,</span>
<span class=sd>    if min_active=0, then no restriction will apply, and the unsorted_id will</span>
<span class=sd>    have no effect on the final PBE epochs.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    PBE_epochs = get_PBEs(mua_asa)</span>
<span class=sd>    PBE_epochs = get_PBEs(spiketrain, min_active=5)</span>
<span class=sd>    PBE_epochs = get_PBEs(binnedspiketrain, min_active=5)</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    data : AnalogSignalArray</span>
<span class=sd>        AnalogSignalArray with one signal, namely the multiunit firing rate [in Hz].</span>
<span class=sd>     -- OR --</span>
<span class=sd>    data : SpikeTrainArray</span>
<span class=sd>        SpikeTrainArray with multiple units, including unsorted unit(s), but</span>
<span class=sd>        excluding any noise artifects.</span>
<span class=sd>     -- OR --</span>
<span class=sd>    data : BinnedSpikeTrainArray</span>
<span class=sd>        BinnedSpikeTrainArray containing multiunit activity.</span>
<span class=sd>    fs : float, optional</span>
<span class=sd>        Sampling frequency of mua, in Hz. If not specified, it will be inferred</span>
<span class=sd>        from data.</span>
<span class=sd>    ds : float, optional</span>
<span class=sd>        Time step in which to bin spikes. Default is 1 ms.</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Standard deviation (in seconds) of Gaussian smoothing kernel.</span>
<span class=sd>        Default is 10 ms. If sigma==0 then no smoothing is applied.</span>
<span class=sd>    truncate : float, optional</span>
<span class=sd>        Bandwidth of the Gaussian filter. Default is 6.</span>
<span class=sd>    unsorted_id : int, optional</span>
<span class=sd>        unit_id of the unsorted unit. Default is 0. If no unsorted unit is</span>
<span class=sd>        present, then set unsorted_id = None</span>
<span class=sd>    min_active : int, optional</span>
<span class=sd>        Minimum number of active units per event, excluding unsorted unit.</span>
<span class=sd>        Default is 5.</span>
<span class=sd>    minLength : float, optional</span>
<span class=sd>        Minimum event duration in seconds. Default is 50 ms.</span>
<span class=sd>    maxLength : float, optional</span>
<span class=sd>        Maximum event duration in seconds. Default is 750 ms.</span>
<span class=sd>    PrimaryThreshold : float, optional</span>
<span class=sd>        Primary threshold to exceed. Default is mean() + 3*std()</span>
<span class=sd>    SecondaryThreshold : float, optional</span>
<span class=sd>        Secondary threshold to fall back to. Default is mean().</span>
<span class=sd>    minThresholdLength : float, optional</span>
<span class=sd>        Minimum duration to stay above PrimaryThreshold. Default is 0 ms.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    PBE_epochs : EpochArray</span>
<span class=sd>        EpochArray containing all the PBEs.</span>

<span class=sd>    Future improvements</span>
<span class=sd>    -------------------</span>
<span class=sd>    As of now, it is possible, but not easy to specify the Primary and Secondary</span>
<span class=sd>    thresholds for event detection. A slight change in API might be needed to</span>
<span class=sd>    make this specification more flexible.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>sigma</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.01</span>  <span class=c1># 10 ms standard deviation</span>
    <span class=k>if</span> <span class=n>truncate</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>truncate</span> <span class=o>=</span> <span class=mi>6</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>):</span>
        <span class=c1># if we have only mua, then we cannot set (ds, unsorted_id, min_active)</span>
        <span class=k>if</span> <span class=n>ds</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;if data is an AnalogSignalArray then ds cannot be specified!&quot;</span>
            <span class=p>)</span>
        <span class=k>if</span> <span class=n>unsorted_id</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;if data is an AnalogSignalArray then unsorted_id cannot be specified!&quot;</span>
            <span class=p>)</span>
        <span class=k>if</span> <span class=n>min_active</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;if data is an AnalogSignalArray then min_active cannot be specified!&quot;</span>
            <span class=p>)</span>
        <span class=n>mua</span> <span class=o>=</span> <span class=n>data</span>
        <span class=n>mua</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>mua</span><span class=o>.</span><span class=n>_data</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>sigma</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>truncate</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>):</span>
            <span class=n>mua</span> <span class=o>=</span> <span class=n>gaussian_filter</span><span class=p>(</span><span class=n>mua</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>)</span>

    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>(</span><span class=n>core</span><span class=o>.</span><span class=n>EventArray</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>BinnedEventArray</span><span class=p>)):</span>
        <span class=c1># set default parameter values:</span>
        <span class=k>if</span> <span class=n>ds</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>ds</span> <span class=o>=</span> <span class=mf>0.001</span>  <span class=c1># default 1 ms</span>
        <span class=k>if</span> <span class=n>min_active</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>min_active</span> <span class=o>=</span> <span class=mi>5</span>
        <span class=n>mua</span> <span class=o>=</span> <span class=n>get_mua</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>ds</span><span class=o>=</span><span class=n>ds</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>,</span> <span class=n>_fast</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
            <span class=s2>&quot;data has to be one of (AnalogSignalArray, SpikeTrainArray, BinnedSpikeTrainArray)&quot;</span>
        <span class=p>)</span>

    <span class=c1># set default parameter values:</span>
    <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>fs</span> <span class=o>=</span> <span class=n>mua</span><span class=o>.</span><span class=n>fs</span>
    <span class=k>if</span> <span class=n>minLength</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>minLength</span> <span class=o>=</span> <span class=mf>0.050</span>  <span class=c1># 50 ms minimum event duration</span>
    <span class=k>if</span> <span class=n>maxLength</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>maxLength</span> <span class=o>=</span> <span class=mf>0.750</span>  <span class=c1># 750 ms maximum event duration</span>
    <span class=k>if</span> <span class=n>minThresholdLength</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>minThresholdLength</span> <span class=o>=</span> <span class=mf>0.0</span>
    <span class=c1># if PrimaryThreshold is None:</span>
    <span class=c1>#         PrimaryThreshold =</span>
    <span class=c1># if SecondaryThreshold is None:</span>
    <span class=c1>#     SecondaryThreshold =</span>
    <span class=n>PBE_epochs</span> <span class=o>=</span> <span class=n>get_mua_events</span><span class=p>(</span>
        <span class=n>mua</span><span class=o>=</span><span class=n>mua</span><span class=p>,</span>
        <span class=n>fs</span><span class=o>=</span><span class=n>fs</span><span class=p>,</span>
        <span class=n>minLength</span><span class=o>=</span><span class=n>minLength</span><span class=p>,</span>
        <span class=n>maxLength</span><span class=o>=</span><span class=n>maxLength</span><span class=p>,</span>
        <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=n>PrimaryThreshold</span><span class=p>,</span>
        <span class=n>minThresholdLength</span><span class=o>=</span><span class=n>minThresholdLength</span><span class=p>,</span>
        <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=n>SecondaryThreshold</span><span class=p>,</span>
    <span class=p>)</span>

    <span class=c1># now require min_active number of sorted cells</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>(</span><span class=n>core</span><span class=o>.</span><span class=n>EventArray</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>BinnedEventArray</span><span class=p>)):</span>
        <span class=k>if</span> <span class=n>min_active</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>unsorted_id</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
                <span class=c1># remove unsorted unit, if present:</span>
                <span class=n>unit_ids</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>unit_ids</span><span class=p>)</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=n>unit_ids</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>unsorted_id</span><span class=p>)</span>
                <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
                    <span class=k>pass</span>
                <span class=c1># data_ = data._unit_subset(unit_ids)</span>
                <span class=n>data_</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[:,</span> <span class=n>unit_ids</span><span class=p>]</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>data_</span> <span class=o>=</span> <span class=n>data</span>
            <span class=c1># determine number of active units per epoch:</span>
            <span class=n>n_active</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>snippet</span><span class=o>.</span><span class=n>n_active</span> <span class=k>for</span> <span class=n>snippet</span> <span class=ow>in</span> <span class=n>data_</span><span class=p>[</span><span class=n>PBE_epochs</span><span class=p>]])</span>
            <span class=n>active_epochs_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argwhere</span><span class=p>(</span><span class=n>n_active</span> <span class=o>&gt;</span> <span class=n>min_active</span><span class=p>)</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span>
            <span class=c1># only keep those epochs where sufficiently many units are active:</span>
            <span class=n>PBE_epochs</span> <span class=o>=</span> <span class=n>PBE_epochs</span><span class=p>[</span><span class=n>active_epochs_idx</span><span class=p>]</span>
    <span class=k>return</span> <span class=n>PBE_epochs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_contiguous_segments class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_contiguous_segments</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>step</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>assume_sorted</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>in_core</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>inclusive</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>in_memory</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute contiguous segments (seperated by step) in a list.</p> <p>Note! This function requires that a sorted list is passed. It first checks if the list is sorted O(n), and only sorts O(n log(n)) if necessary. But if you know that the list is already sorted, you can pass assume_sorted=True, in which case it will skip the O(n) check.</p> <p>Returns an array of size (n_segments, 2), with each row being of the form ([start, stop]) [inclusive, exclusive].</p> <p>NOTE: when possible, use assume_sorted=True, and step=1 as explicit arguments to function call.</p> <p>WARNING! Step is robustly computed in-core (i.e., when in_core is True), but is assumed to be 1 when out-of-core.</p> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>get_contiguous_segments</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=go>([1,5], [10,13])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>get_contiguous_segments</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=go>([0,4], [4,7])</span>
</code></pre></div> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code><span title=array>array</span> - <span title=like>like</span></code> </td> <td> <div class=doc-md-description> <p>1D array of sequential data, typically assumed to be integral (sample numbers).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>step</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Expected step size for neighboring samples. Default uses numpy to find the median, but it is much faster and memory efficient to explicitly pass in step=1.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>assume_sorted</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If assume_sorted == True, then data is not inspected or re-ordered. This can be significantly faster, especially for out-of-core computation, but it should only be used when you are confident that the data is indeed sorted, otherwise the results from get_contiguous_segments will not be reliable.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>in_core</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, then we use np.diff which requires all the data to fit into memory simultaneously, otherwise we use groupby, which uses a generator to process potentially much larger chunks of data, but also much slower.</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class=doc-section-item> <td> <code>index</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, the indices of segment boundaries will be returned. Otherwise, the segment boundaries will be returned in terms of the data itself. Default is False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>inclusive</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, the boundaries are returned as [(inclusive idx, inclusive idx)] Default is False, and can only be used when index==True.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span>
<span class=normal>1230</span>
<span class=normal>1231</span>
<span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_contiguous_segments</span><span class=p>(</span>
    <span class=n>data</span><span class=p>,</span>
    <span class=o>*</span><span class=p>,</span>
    <span class=n>step</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>assume_sorted</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>in_core</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>inclusive</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>sort</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>in_memory</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Compute contiguous segments (seperated by step) in a list.</span>

<span class=sd>    Note! This function requires that a sorted list is passed.</span>
<span class=sd>    It first checks if the list is sorted O(n), and only sorts O(n log(n))</span>
<span class=sd>    if necessary. But if you know that the list is already sorted,</span>
<span class=sd>    you can pass assume_sorted=True, in which case it will skip</span>
<span class=sd>    the O(n) check.</span>

<span class=sd>    Returns an array of size (n_segments, 2), with each row</span>
<span class=sd>    being of the form ([start, stop]) [inclusive, exclusive].</span>

<span class=sd>    NOTE: when possible, use assume_sorted=True, and step=1 as explicit</span>
<span class=sd>          arguments to function call.</span>

<span class=sd>    WARNING! Step is robustly computed in-core (i.e., when in_core is</span>
<span class=sd>        True), but is assumed to be 1 when out-of-core.</span>

<span class=sd>    Examples</span>
<span class=sd>    -------</span>
<span class=sd>    &gt;&gt;&gt; data = [1, 2, 3, 4, 10, 11, 12]</span>
<span class=sd>    &gt;&gt;&gt; get_contiguous_segments(data)</span>
<span class=sd>    ([1,5], [10,13])</span>
<span class=sd>    &gt;&gt;&gt; get_contiguous_segments(data, index=True)</span>
<span class=sd>    ([0,4], [4,7])</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    data : array-like</span>
<span class=sd>        1D array of sequential data, typically assumed to be integral (sample</span>
<span class=sd>        numbers).</span>
<span class=sd>    step : float, optional</span>
<span class=sd>        Expected step size for neighboring samples. Default uses numpy to find</span>
<span class=sd>        the median, but it is much faster and memory efficient to explicitly</span>
<span class=sd>        pass in step=1.</span>
<span class=sd>    assume_sorted : bool, optional</span>
<span class=sd>        If assume_sorted == True, then data is not inspected or re-ordered. This</span>
<span class=sd>        can be significantly faster, especially for out-of-core computation, but</span>
<span class=sd>        it should only be used when you are confident that the data is indeed</span>
<span class=sd>        sorted, otherwise the results from get_contiguous_segments will not be</span>
<span class=sd>        reliable.</span>
<span class=sd>    in_core : bool, optional</span>
<span class=sd>        If True, then we use np.diff which requires all the data to fit</span>
<span class=sd>        into memory simultaneously, otherwise we use groupby, which uses</span>
<span class=sd>        a generator to process potentially much larger chunks of data,</span>
<span class=sd>        but also much slower.</span>
<span class=sd>    index : bool, optional</span>
<span class=sd>        If True, the indices of segment boundaries will be returned. Otherwise,</span>
<span class=sd>        the segment boundaries will be returned in terms of the data itself.</span>
<span class=sd>        Default is False.</span>
<span class=sd>    inclusive : bool, optional</span>
<span class=sd>        If True, the boundaries are returned as [(inclusive idx, inclusive idx)]</span>
<span class=sd>        Default is False, and can only be used when index==True.</span>

<span class=sd>    Deprecated</span>
<span class=sd>    ----------</span>
<span class=sd>    in_memory : bool, optional</span>
<span class=sd>        This is equivalent to the new &#39;in-core&#39;.</span>
<span class=sd>    sort : bool, optional</span>
<span class=sd>        This is equivalent to the new &#39;assume_sorted&#39;</span>
<span class=sd>    fs : sampling rate (Hz) used to extend half-open interval support by 1/fs</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># handle deprecated API calls:</span>
    <span class=k>if</span> <span class=n>in_memory</span><span class=p>:</span>
        <span class=n>in_core</span> <span class=o>=</span> <span class=n>in_memory</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;&#39;in_memory&#39; has been deprecated; use &#39;in_core&#39; instead&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>sort</span><span class=p>:</span>
        <span class=n>assume_sorted</span> <span class=o>=</span> <span class=n>sort</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;&#39;sort&#39; has been deprecated; use &#39;assume_sorted&#39; instead&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>fs</span><span class=p>:</span>
        <span class=n>step</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>fs</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;&#39;fs&#39; has been deprecated; use &#39;step&#39; instead&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>inclusive</span><span class=p>:</span>
        <span class=k>assert</span> <span class=n>index</span><span class=p>,</span> <span class=s2>&quot;option &#39;inclusive&#39; can only be used with &#39;index=True&#39;&quot;</span>
    <span class=k>if</span> <span class=n>in_core</span><span class=p>:</span>
        <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>assume_sorted</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>is_sorted</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
                <span class=n>data</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>  <span class=c1># algorithm assumes sorted list</span>

        <span class=k>if</span> <span class=n>step</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>step</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>median</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>

        <span class=c1># assuming that data(t1) is sampled somewhere on [t, t+1/fs) we have a &#39;continuous&#39; signal as long as</span>
        <span class=c1># data(t2 = t1+1/fs) is sampled somewhere on [t+1/fs, t+2/fs). In the most extreme case, it could happen</span>
        <span class=c1># that t1 = t and t2 = t + 2/fs, i.e. a difference of 2 steps.</span>

        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>step</span><span class=p>):</span>
            <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span>
                <span class=s2>&quot;some steps in the data are smaller than the requested step size.&quot;</span>
            <span class=p>)</span>

        <span class=n>breaks</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argwhere</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>step</span><span class=p>)</span>
        <span class=n>starts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>breaks</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
        <span class=n>stops</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>breaks</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
        <span class=n>bdries</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>((</span><span class=n>data</span><span class=p>[</span><span class=n>starts</span><span class=p>],</span> <span class=n>data</span><span class=p>[</span><span class=n>stops</span><span class=p>]</span> <span class=o>+</span> <span class=n>step</span><span class=p>))</span><span class=o>.</span><span class=n>T</span>
        <span class=k>if</span> <span class=n>index</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>inclusive</span><span class=p>:</span>
                <span class=n>indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>((</span><span class=n>starts</span><span class=p>,</span> <span class=n>stops</span><span class=p>))</span><span class=o>.</span><span class=n>T</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>((</span><span class=n>starts</span><span class=p>,</span> <span class=n>stops</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span><span class=o>.</span><span class=n>T</span>
            <span class=k>return</span> <span class=n>indices</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>itertools</span><span class=w> </span><span class=kn>import</span> <span class=n>groupby</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>operator</span><span class=w> </span><span class=kn>import</span> <span class=n>itemgetter</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>assume_sorted</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>is_sorted</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
                <span class=c1># data = np.sort(data)  # algorithm assumes sorted list</span>
                <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span>
                    <span class=s2>&quot;out-of-core sorting has not been implemented yet...&quot;</span>
                <span class=p>)</span>

        <span class=k>if</span> <span class=n>step</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>step</span> <span class=o>=</span> <span class=mi>1</span>

        <span class=n>bdries</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>index</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>groupby</span><span class=p>(</span><span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=k>lambda</span> <span class=n>ix</span><span class=p>:</span> <span class=p>(</span><span class=n>ix</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>ix</span><span class=p>[</span><span class=mi>1</span><span class=p>])):</span>
                <span class=n>f</span> <span class=o>=</span> <span class=n>itemgetter</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
                <span class=n>gen</span> <span class=o>=</span> <span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>g</span><span class=p>)</span>
                <span class=n>start</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>gen</span><span class=p>)</span>
                <span class=n>stop</span> <span class=o>=</span> <span class=n>start</span>
                <span class=k>for</span> <span class=n>stop</span> <span class=ow>in</span> <span class=n>gen</span><span class=p>:</span>
                    <span class=k>pass</span>
                <span class=n>bdries</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>start</span><span class=p>,</span> <span class=n>stop</span> <span class=o>+</span> <span class=n>step</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span>
            <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>groupby</span><span class=p>(</span><span class=nb>enumerate</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=k>lambda</span> <span class=n>ix</span><span class=p>:</span> <span class=p>(</span><span class=n>ix</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>ix</span><span class=p>[</span><span class=mi>1</span><span class=p>])):</span>
                <span class=n>f</span> <span class=o>=</span> <span class=n>itemgetter</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
                <span class=n>gen</span> <span class=o>=</span> <span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>g</span><span class=p>)</span>
                <span class=n>_</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>gen</span><span class=p>)</span>
                <span class=n>start</span> <span class=o>=</span> <span class=n>counter</span>
                <span class=n>stop</span> <span class=o>=</span> <span class=n>start</span>
                <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>gen</span><span class=p>:</span>
                    <span class=n>stop</span> <span class=o>+=</span> <span class=mi>1</span>
                <span class=k>if</span> <span class=n>inclusive</span><span class=p>:</span>
                    <span class=n>bdries</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>start</span><span class=p>,</span> <span class=n>stop</span><span class=p>])</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>bdries</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>start</span><span class=p>,</span> <span class=n>stop</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span>
                <span class=n>counter</span> <span class=o>=</span> <span class=n>stop</span> <span class=o>+</span> <span class=mi>1</span>

    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>bdries</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_direction class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_direction</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return epochs during which an animal was running left to right, or right to left.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>asa</code> </td> <td> <code>AnalogSignalArray 1D</code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray containing the 1D position data.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Smoothing to apply to position (x) before computing gradient estimate. Default is 0.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>l2r, r2l : EpochArrays</code> </td> <td> <div class=doc-md-description> <p>EpochArrays corresponding to left-to-right and right-to-left movement.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_direction</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return epochs during which an animal was running left to right, or right</span>
<span class=sd>    to left.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    asa : AnalogSignalArray 1D</span>
<span class=sd>        AnalogSignalArray containing the 1D position data.</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Smoothing to apply to position (x) before computing gradient estimate.</span>
<span class=sd>        Default is 0.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    l2r, r2l : EpochArrays</span>
<span class=sd>        EpochArrays corresponding to left-to-right and right-to-left movement.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>sigma</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>):</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;AnalogSignalArray expected!&quot;</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>asa</span><span class=o>.</span><span class=n>n_signals</span> <span class=o>==</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;1D AnalogSignalArray expected!&quot;</span>

    <span class=n>direction</span> <span class=o>=</span> <span class=n>dxdt_AnalogSignalArray</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>smooth</span><span class=p>(</span><span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>),</span> <span class=n>rectify</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>
    <span class=n>direction</span><span class=p>[</span><span class=n>direction</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=n>direction</span><span class=p>[</span><span class=n>direction</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
    <span class=n>direction</span> <span class=o>=</span> <span class=n>direction</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span>

    <span class=n>l2r</span> <span class=o>=</span> <span class=n>get_contiguous_segments</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>argwhere</span><span class=p>(</span><span class=n>direction</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>squeeze</span><span class=p>(),</span> <span class=n>step</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>l2r</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-=</span> <span class=p>(</span>
        <span class=mi>1</span>  <span class=c1># change bounds from [inclusive, exclusive] to [inclusive, inclusive]</span>
    <span class=p>)</span>
    <span class=n>l2r</span> <span class=o>=</span> <span class=n>core</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>abscissa_vals</span><span class=p>[</span><span class=n>l2r</span><span class=p>])</span>

    <span class=n>r2l</span> <span class=o>=</span> <span class=n>get_contiguous_segments</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>argwhere</span><span class=p>(</span><span class=n>direction</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>squeeze</span><span class=p>(),</span> <span class=n>step</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>r2l</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-=</span> <span class=p>(</span>
        <span class=mi>1</span>  <span class=c1># change bounds from [inclusive, exclusive] to [inclusive, inclusive]</span>
    <span class=p>)</span>
    <span class=n>r2l</span> <span class=o>=</span> <span class=n>core</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>abscissa_vals</span><span class=p>[</span><span class=n>r2l</span><span class=p>])</span>

    <span class=k>return</span> <span class=n>l2r</span><span class=p>,</span> <span class=n>r2l</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_events_boundaries class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_events_boundaries</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>minThresholdLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>minLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>maxLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>ds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;above&#39;</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>get event boundaries such that event.max &gt;= PrimaryThreshold and the event extent is defined by SecondaryThreshold.</p> <p>Note that when PrimaryThreshold==SecondaryThreshold, then this is a simple threshold crossing algorithm.</p> <p>NB. minLength and maxLength are applied to the SecondaryThreshold events, whereas minThresholdLength is applied to the PrimaryThreshold events.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>x</code> </td> <td> <code>numpy array</code> </td> <td> <div class=doc-md-description> <p>Input data</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>mode</code> </td> <td> <code>string, optional in [&#39;above&#39;, &#39;below&#39;]; default &#39;above&#39;</code> </td> <td> <div class=doc-md-description> <p>event triggering above, or below threshold</p> </div> </td> <td> <code>&#39;above&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>PrimaryThreshold</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>If mode=='above', requires that event.max &gt;= PrimaryThreshold If mode=='below', requires that event.min &lt;= PrimaryThreshold</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>SecondaryThreshold</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>The value that defines the event extent</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>minThresholdLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Minimum duration for which the PrimaryThreshold is crossed</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>minLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Minimum duration for which the SecondaryThreshold is crossed</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>maxLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Maximum duration for which the SecondaryThreshold is crossed</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>ds</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Time step of the input data x</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>returns bounds, maxes, events</code> </td> <td> <div class=doc-md-description> <p>where bounds &lt;==&gt; SecondaryThreshold to SecondaryThreshold, inclusive maxes &lt;==&gt; maximum value during each event events &lt;==&gt; PrimaryThreshold to PrimaryThreshold, inclusive</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1670</span>
<span class=normal>1671</span>
<span class=normal>1672</span>
<span class=normal>1673</span>
<span class=normal>1674</span>
<span class=normal>1675</span>
<span class=normal>1676</span>
<span class=normal>1677</span>
<span class=normal>1678</span>
<span class=normal>1679</span>
<span class=normal>1680</span>
<span class=normal>1681</span>
<span class=normal>1682</span>
<span class=normal>1683</span>
<span class=normal>1684</span>
<span class=normal>1685</span>
<span class=normal>1686</span>
<span class=normal>1687</span>
<span class=normal>1688</span>
<span class=normal>1689</span>
<span class=normal>1690</span>
<span class=normal>1691</span>
<span class=normal>1692</span>
<span class=normal>1693</span>
<span class=normal>1694</span>
<span class=normal>1695</span>
<span class=normal>1696</span>
<span class=normal>1697</span>
<span class=normal>1698</span>
<span class=normal>1699</span>
<span class=normal>1700</span>
<span class=normal>1701</span>
<span class=normal>1702</span>
<span class=normal>1703</span>
<span class=normal>1704</span>
<span class=normal>1705</span>
<span class=normal>1706</span>
<span class=normal>1707</span>
<span class=normal>1708</span>
<span class=normal>1709</span>
<span class=normal>1710</span>
<span class=normal>1711</span>
<span class=normal>1712</span>
<span class=normal>1713</span>
<span class=normal>1714</span>
<span class=normal>1715</span>
<span class=normal>1716</span>
<span class=normal>1717</span>
<span class=normal>1718</span>
<span class=normal>1719</span>
<span class=normal>1720</span>
<span class=normal>1721</span>
<span class=normal>1722</span>
<span class=normal>1723</span>
<span class=normal>1724</span>
<span class=normal>1725</span>
<span class=normal>1726</span>
<span class=normal>1727</span>
<span class=normal>1728</span>
<span class=normal>1729</span>
<span class=normal>1730</span>
<span class=normal>1731</span>
<span class=normal>1732</span>
<span class=normal>1733</span>
<span class=normal>1734</span>
<span class=normal>1735</span>
<span class=normal>1736</span>
<span class=normal>1737</span>
<span class=normal>1738</span>
<span class=normal>1739</span>
<span class=normal>1740</span>
<span class=normal>1741</span>
<span class=normal>1742</span>
<span class=normal>1743</span>
<span class=normal>1744</span>
<span class=normal>1745</span>
<span class=normal>1746</span>
<span class=normal>1747</span>
<span class=normal>1748</span>
<span class=normal>1749</span>
<span class=normal>1750</span>
<span class=normal>1751</span>
<span class=normal>1752</span>
<span class=normal>1753</span>
<span class=normal>1754</span>
<span class=normal>1755</span>
<span class=normal>1756</span>
<span class=normal>1757</span>
<span class=normal>1758</span>
<span class=normal>1759</span>
<span class=normal>1760</span>
<span class=normal>1761</span>
<span class=normal>1762</span>
<span class=normal>1763</span>
<span class=normal>1764</span>
<span class=normal>1765</span>
<span class=normal>1766</span>
<span class=normal>1767</span>
<span class=normal>1768</span>
<span class=normal>1769</span>
<span class=normal>1770</span>
<span class=normal>1771</span>
<span class=normal>1772</span>
<span class=normal>1773</span>
<span class=normal>1774</span>
<span class=normal>1775</span>
<span class=normal>1776</span>
<span class=normal>1777</span>
<span class=normal>1778</span>
<span class=normal>1779</span>
<span class=normal>1780</span>
<span class=normal>1781</span>
<span class=normal>1782</span>
<span class=normal>1783</span>
<span class=normal>1784</span>
<span class=normal>1785</span>
<span class=normal>1786</span>
<span class=normal>1787</span>
<span class=normal>1788</span>
<span class=normal>1789</span>
<span class=normal>1790</span>
<span class=normal>1791</span>
<span class=normal>1792</span>
<span class=normal>1793</span>
<span class=normal>1794</span>
<span class=normal>1795</span>
<span class=normal>1796</span>
<span class=normal>1797</span>
<span class=normal>1798</span>
<span class=normal>1799</span>
<span class=normal>1800</span>
<span class=normal>1801</span>
<span class=normal>1802</span>
<span class=normal>1803</span>
<span class=normal>1804</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_events_boundaries</span><span class=p>(</span>
    <span class=n>x</span><span class=p>,</span>
    <span class=o>*</span><span class=p>,</span>
    <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>minThresholdLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>minLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>maxLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>ds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;above&quot;</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;get event boundaries such that event.max &gt;= PrimaryThreshold</span>
<span class=sd>    and the event extent is defined by SecondaryThreshold.</span>

<span class=sd>    Note that when PrimaryThreshold==SecondaryThreshold, then this is a</span>
<span class=sd>    simple threshold crossing algorithm.</span>

<span class=sd>    NB. minLength and maxLength are applied to the SecondaryThreshold</span>
<span class=sd>        events, whereas minThresholdLength is applied to the</span>
<span class=sd>        PrimaryThreshold events.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    x : numpy array</span>
<span class=sd>        Input data</span>
<span class=sd>    mode : string, optional in [&#39;above&#39;, &#39;below&#39;]; default &#39;above&#39;</span>
<span class=sd>        event triggering above, or below threshold</span>
<span class=sd>    PrimaryThreshold : float, optional</span>
<span class=sd>        If mode==&#39;above&#39;, requires that event.max &gt;= PrimaryThreshold</span>
<span class=sd>        If mode==&#39;below&#39;, requires that event.min &lt;= PrimaryThreshold</span>
<span class=sd>    SecondaryThreshold : float, optional</span>
<span class=sd>        The value that defines the event extent</span>
<span class=sd>    minThresholdLength : float, optional</span>
<span class=sd>        Minimum duration for which the PrimaryThreshold is crossed</span>
<span class=sd>    minLength : float, optional</span>
<span class=sd>        Minimum duration for which the SecondaryThreshold is crossed</span>
<span class=sd>    maxLength : float, optional</span>
<span class=sd>        Maximum duration for which the SecondaryThreshold is crossed</span>
<span class=sd>    ds : float, optional</span>
<span class=sd>        Time step of the input data x</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    returns bounds, maxes, events</span>
<span class=sd>        where bounds &lt;==&gt; SecondaryThreshold to SecondaryThreshold, inclusive</span>
<span class=sd>              maxes  &lt;==&gt; maximum value during each event</span>
<span class=sd>              events &lt;==&gt; PrimaryThreshold to PrimaryThreshold, inclusive</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># TODO: x must be a numpy array</span>
    <span class=c1># TODO: ds is often used, but we have no default, and no check for when</span>
    <span class=c1>#       it is left as None.</span>
    <span class=c1># TODO: the Docstring should equally be improved.</span>

    <span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>x</span><span class=o>.</span><span class=n>ndim</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;multidimensional arrays not supported!&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>PrimaryThreshold</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># by default, threshold is 3 SDs above mean of x</span>
        <span class=n>PrimaryThreshold</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>SecondaryThreshold</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># by default, revert back to mean of x</span>
        <span class=n>SecondaryThreshold</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>  <span class=c1># + 0*np.std(x)</span>

    <span class=n>events</span><span class=p>,</span> <span class=n>primary_maxes</span> <span class=o>=</span> <span class=n>find_threshold_crossing_events</span><span class=p>(</span>
        <span class=n>x</span><span class=o>=</span><span class=n>x</span><span class=p>,</span> <span class=n>threshold</span><span class=o>=</span><span class=n>PrimaryThreshold</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=n>mode</span>
    <span class=p>)</span>

    <span class=c1># apply minThresholdLength criterion:</span>
    <span class=k>if</span> <span class=n>minThresholdLength</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>durations</span> <span class=o>=</span> <span class=p>(</span><span class=n>events</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>events</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>ds</span>
        <span class=n>events</span> <span class=o>=</span> <span class=n>events</span><span class=p>[</span><span class=n>durations</span> <span class=o>&gt;=</span> <span class=n>minThresholdLength</span><span class=p>]</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>bounds</span><span class=p>,</span> <span class=n>maxes</span><span class=p>,</span> <span class=n>events</span> <span class=o>=</span> <span class=p>[],</span> <span class=p>[],</span> <span class=p>[]</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;no events satisfied criteria&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>maxes</span><span class=p>,</span> <span class=n>events</span>

    <span class=c1># Find periods where value is &gt; SecondaryThreshold; note that the previous periods should be within these!</span>
    <span class=k>if</span> <span class=n>mode</span> <span class=o>==</span> <span class=s2>&quot;above&quot;</span><span class=p>:</span>
        <span class=k>assert</span> <span class=n>SecondaryThreshold</span> <span class=o>&lt;=</span> <span class=n>PrimaryThreshold</span><span class=p>,</span> <span class=p>(</span>
            <span class=s2>&quot;Secondary Threshold by definition should include more data than Primary Threshold&quot;</span>
        <span class=p>)</span>
    <span class=k>elif</span> <span class=n>mode</span> <span class=o>==</span> <span class=s2>&quot;below&quot;</span><span class=p>:</span>
        <span class=k>assert</span> <span class=n>SecondaryThreshold</span> <span class=o>&gt;=</span> <span class=n>PrimaryThreshold</span><span class=p>,</span> <span class=p>(</span>
            <span class=s2>&quot;Secondary Threshold by definition should include more data than Primary Threshold&quot;</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span>
            <span class=s2>&quot;mode </span><span class=si>{}</span><span class=s2> not understood for find_threshold_crossing_events&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=nb>str</span><span class=p>(</span><span class=n>mode</span><span class=p>)</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=n>bounds</span><span class=p>,</span> <span class=n>broader_maxes</span> <span class=o>=</span> <span class=n>find_threshold_crossing_events</span><span class=p>(</span>
        <span class=n>x</span><span class=o>=</span><span class=n>x</span><span class=p>,</span> <span class=n>threshold</span><span class=o>=</span><span class=n>SecondaryThreshold</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=n>mode</span>
    <span class=p>)</span>

    <span class=c1># Find corresponding big windows for potential events</span>
    <span class=c1>#  Specifically, look for closest left edge that is just smaller</span>
    <span class=n>outer_boundary_indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>bounds</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>events</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;right&quot;</span><span class=p>)</span>
    <span class=c1>#  searchsorted finds the index after, so subtract one to get index before</span>
    <span class=n>outer_boundary_indices</span> <span class=o>=</span> <span class=n>outer_boundary_indices</span> <span class=o>-</span> <span class=mi>1</span>

    <span class=c1># Find extended boundaries for events by pairing to larger windows</span>
    <span class=c1>#   (Note that there may be repeats if the larger window contains multiple &gt; 3SD sections)</span>
    <span class=n>bounds</span> <span class=o>=</span> <span class=n>bounds</span><span class=p>[</span><span class=n>outer_boundary_indices</span><span class=p>,</span> <span class=p>:]</span>
    <span class=n>maxes</span> <span class=o>=</span> <span class=n>broader_maxes</span><span class=p>[</span><span class=n>outer_boundary_indices</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>minLength</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>durations</span> <span class=o>=</span> <span class=p>(</span><span class=n>bounds</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>bounds</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>ds</span>
        <span class=c1># TODO: refactor [durations &lt;= maxLength] but be careful about edge cases</span>
        <span class=n>bounds</span> <span class=o>=</span> <span class=n>bounds</span><span class=p>[</span><span class=n>durations</span> <span class=o>&gt;=</span> <span class=n>minLength</span><span class=p>]</span>
        <span class=n>maxes</span> <span class=o>=</span> <span class=n>maxes</span><span class=p>[</span><span class=n>durations</span> <span class=o>&gt;=</span> <span class=n>minLength</span><span class=p>]</span>
        <span class=n>events</span> <span class=o>=</span> <span class=n>events</span><span class=p>[</span><span class=n>durations</span> <span class=o>&gt;=</span> <span class=n>minLength</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>maxLength</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>durations</span> <span class=o>=</span> <span class=p>(</span><span class=n>bounds</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>bounds</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>ds</span>
        <span class=c1># TODO: refactor [durations &lt;= maxLength] but be careful about edge cases</span>
        <span class=n>bounds</span> <span class=o>=</span> <span class=n>bounds</span><span class=p>[</span><span class=n>durations</span> <span class=o>&lt;=</span> <span class=n>maxLength</span><span class=p>]</span>
        <span class=n>maxes</span> <span class=o>=</span> <span class=n>maxes</span><span class=p>[</span><span class=n>durations</span> <span class=o>&lt;=</span> <span class=n>maxLength</span><span class=p>]</span>
        <span class=n>events</span> <span class=o>=</span> <span class=n>events</span><span class=p>[</span><span class=n>durations</span> <span class=o>&lt;=</span> <span class=n>maxLength</span><span class=p>]</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>events</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>bounds</span><span class=p>,</span> <span class=n>maxes</span><span class=p>,</span> <span class=n>events</span> <span class=o>=</span> <span class=p>[],</span> <span class=p>[],</span> <span class=p>[]</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;no events satisfied criteria&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>maxes</span><span class=p>,</span> <span class=n>events</span>

    <span class=c1># Now, since all that we care about are the larger windows, so we should get rid of repeats</span>
    <span class=n>_</span><span class=p>,</span> <span class=n>unique_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>bounds</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>return_index</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>bounds</span> <span class=o>=</span> <span class=n>bounds</span><span class=p>[</span><span class=n>unique_idx</span><span class=p>,</span> <span class=p>:]</span>  <span class=c1># SecondaryThreshold to SecondaryThreshold</span>
    <span class=n>maxes</span> <span class=o>=</span> <span class=n>maxes</span><span class=p>[</span><span class=n>unique_idx</span><span class=p>]</span>  <span class=c1># maximum value during event</span>
    <span class=n>events</span> <span class=o>=</span> <span class=n>events</span><span class=p>[</span><span class=n>unique_idx</span><span class=p>,</span> <span class=p>:]</span>  <span class=c1># PrimaryThreshold to PrimaryThreshold</span>

    <span class=k>return</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>maxes</span><span class=p>,</span> <span class=n>events</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_inactive_epochs class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_inactive_epochs</span><span class=p>(</span><span class=n>speed</span><span class=p>,</span> <span class=n>v1</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>v2</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return epochs where animal is running no faster than specified by v1 and v2.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>speed</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray containing single channel speed, in units/sec</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>v1</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Minimum speed (in same units as speed) that has to be reached / exceeded during an event. Default is 10 [units/sec]</p> </div> </td> <td> <code>5</code> </td> </tr> <tr class=doc-section-item> <td> <code>v2</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Speed that defines the event boundaries. Default is 8 [units/sec]</p> </div> </td> <td> <code>7</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>inactive_epochs</code></td> <td> <code><a class="autorefs autorefs-internal" href=../../core/intervalarray/#nelpy.core._intervalarray.EpochArray>EpochArray</a></code> </td> <td> <div class=doc-md-description> <p>EpochArray with all the epochs where speed satisfied the criteria.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2525</span>
<span class=normal>2526</span>
<span class=normal>2527</span>
<span class=normal>2528</span>
<span class=normal>2529</span>
<span class=normal>2530</span>
<span class=normal>2531</span>
<span class=normal>2532</span>
<span class=normal>2533</span>
<span class=normal>2534</span>
<span class=normal>2535</span>
<span class=normal>2536</span>
<span class=normal>2537</span>
<span class=normal>2538</span>
<span class=normal>2539</span>
<span class=normal>2540</span>
<span class=normal>2541</span>
<span class=normal>2542</span>
<span class=normal>2543</span>
<span class=normal>2544</span>
<span class=normal>2545</span>
<span class=normal>2546</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_inactive_epochs</span><span class=p>(</span><span class=n>speed</span><span class=p>,</span> <span class=n>v1</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>v2</span><span class=o>=</span><span class=mi>7</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return epochs where animal is running no faster than specified by</span>
<span class=sd>    v1 and v2.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    speed : AnalogSignalArray</span>
<span class=sd>        AnalogSignalArray containing single channel speed, in units/sec</span>
<span class=sd>    v1 : float, optional</span>
<span class=sd>        Minimum speed (in same units as speed) that has to be reached /</span>
<span class=sd>        exceeded during an event. Default is 10 [units/sec]</span>
<span class=sd>    v2 : float, optional</span>
<span class=sd>        Speed that defines the event boundaries. Default is 8 [units/sec]</span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    inactive_epochs : EpochArray</span>
<span class=sd>        EpochArray with all the epochs where speed satisfied the criteria.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>inactive_epochs</span> <span class=o>=</span> <span class=n>get_threshold_crossing_epochs</span><span class=p>(</span>
        <span class=n>asa</span><span class=o>=</span><span class=n>speed</span><span class=p>,</span> <span class=n>t1</span><span class=o>=</span><span class=n>v1</span><span class=p>,</span> <span class=n>t2</span><span class=o>=</span><span class=n>v2</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;below&quot;</span>
    <span class=p>)</span>
    <span class=k>return</span> <span class=n>inactive_epochs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_mua class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_mua</span><span class=p>(</span><span class=n>st</span><span class=p>,</span> <span class=n>ds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>_fast</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute the multiunit activity (MUA) from a spike train.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>st</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.SpikeTrainArray>SpikeTrainArray</a></code> </td> <td> <div class=doc-md-description> <p>SpikeTrainArray containing one or more units. -- OR --</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>st</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.BinnedSpikeTrainArray>BinnedSpikeTrainArray</a></code> </td> <td> <div class=doc-md-description> <p>BinnedSpikeTrainArray containing multiunit activity.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>ds</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Time step in which to bin spikes. Default is 1 ms.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Standard deviation (in seconds) of Gaussian smoothing kernel. Default is 10 ms. If sigma==0 then no smoothing is applied.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>truncate</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Bandwidth of the Gaussian filter. Default is 6.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>mua</code></td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray with MUA.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@keyword_deprecation</span><span class=p>(</span><span class=n>replace_x_with_y</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;bw&quot;</span><span class=p>:</span> <span class=s2>&quot;truncate&quot;</span><span class=p>})</span>
<span class=k>def</span><span class=w> </span><span class=nf>get_mua</span><span class=p>(</span><span class=n>st</span><span class=p>,</span> <span class=n>ds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>_fast</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Compute the multiunit activity (MUA) from a spike train.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    st : SpikeTrainArray</span>
<span class=sd>        SpikeTrainArray containing one or more units.</span>
<span class=sd>     -- OR --</span>
<span class=sd>    st : BinnedSpikeTrainArray</span>
<span class=sd>        BinnedSpikeTrainArray containing multiunit activity.</span>
<span class=sd>    ds : float, optional</span>
<span class=sd>        Time step in which to bin spikes. Default is 1 ms.</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Standard deviation (in seconds) of Gaussian smoothing kernel.</span>
<span class=sd>        Default is 10 ms. If sigma==0 then no smoothing is applied.</span>
<span class=sd>    truncate : float, optional</span>
<span class=sd>        Bandwidth of the Gaussian filter. Default is 6.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    mua : AnalogSignalArray</span>
<span class=sd>        AnalogSignalArray with MUA.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>ds</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>ds</span> <span class=o>=</span> <span class=mf>0.001</span>  <span class=c1># 1 ms bin size</span>
    <span class=k>if</span> <span class=n>sigma</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.01</span>  <span class=c1># 10 ms standard deviation</span>
    <span class=k>if</span> <span class=n>truncate</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>truncate</span> <span class=o>=</span> <span class=mi>6</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>st</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>EventArray</span><span class=p>):</span>
        <span class=c1># bin spikes, so that we can count the spikes</span>
        <span class=n>mua_binned</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=n>ds</span><span class=p>)</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>st</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>BinnedEventArray</span><span class=p>):</span>
        <span class=n>mua_binned</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
        <span class=n>ds</span> <span class=o>=</span> <span class=n>mua_binned</span><span class=o>.</span><span class=n>ds</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;st has to be one of (SpikeTrainArray, BinnedSpikeTrainArray)&quot;</span><span class=p>)</span>

    <span class=c1># make sure data type is float, so that smoothing works, and convert to rate</span>
    <span class=n>mua_binned</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>mua_binned</span><span class=o>.</span><span class=n>_data</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span> <span class=o>/</span> <span class=n>ds</span>

    <span class=c1># TODO: now that we can simply cast from BST to ASA and back, the following logic could be simplified:</span>
    <span class=c1># put mua rate inside an AnalogSignalArray</span>
    <span class=k>if</span> <span class=n>_fast</span><span class=p>:</span>
        <span class=n>mua</span> <span class=o>=</span> <span class=n>core</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>([],</span> <span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=n>mua</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>mua_binned</span><span class=o>.</span><span class=n>data</span>
        <span class=n>mua</span><span class=o>.</span><span class=n>_abscissa_vals</span> <span class=o>=</span> <span class=n>mua_binned</span><span class=o>.</span><span class=n>bin_centers</span>
        <span class=n>mua</span><span class=o>.</span><span class=n>_abscissa</span><span class=o>.</span><span class=n>support</span> <span class=o>=</span> <span class=n>mua_binned</span><span class=o>.</span><span class=n>support</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>mua</span> <span class=o>=</span> <span class=n>core</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>(</span>
            <span class=n>mua_binned</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>timestamps</span><span class=o>=</span><span class=n>mua_binned</span><span class=o>.</span><span class=n>bin_centers</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=n>ds</span>
        <span class=p>)</span>

    <span class=n>mua</span><span class=o>.</span><span class=n>_fs</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>ds</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>sigma</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>truncate</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>):</span>
        <span class=n>mua</span> <span class=o>=</span> <span class=n>gaussian_filter</span><span class=p>(</span><span class=n>mua</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>truncate</span><span class=o>=</span><span class=n>truncate</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>mua</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_mua_events class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_mua_events</span><span class=p>(</span><span class=n>mua</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>minLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>maxLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>minThresholdLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Determine MUA/PBEs from multiunit activity.</p> <p>MUA : multiunit activity PBE : population burst event</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>mua</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray with one signal, namely the multiunit firing rate [in Hz].</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fs</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Sampling frequency of mua, in Hz. If not specified, it will be inferred from mua.fs</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>minLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>maxLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>PrimaryThreshold</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>SecondaryThreshold</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>minThresholdLength</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>mua_epochs</code></td> <td> <code><a class="autorefs autorefs-internal" href=../../core/intervalarray/#nelpy.core._intervalarray.EpochArray>EpochArray</a></code> </td> <td> <div class=doc-md-description> <p>EpochArray containing all the MUA events / PBEs.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <p>mua = get_mua(spiketrain) mua_epochs = get_mua_events(mua) PBEs = get_PBEs(spiketrain, min_active=5) = get_PBEs(get_mua_events(get_mua(*)), spiketrain, min_active=5)</p> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>854</span>
<span class=normal>855</span>
<span class=normal>856</span>
<span class=normal>857</span>
<span class=normal>858</span>
<span class=normal>859</span>
<span class=normal>860</span>
<span class=normal>861</span>
<span class=normal>862</span>
<span class=normal>863</span>
<span class=normal>864</span>
<span class=normal>865</span>
<span class=normal>866</span>
<span class=normal>867</span>
<span class=normal>868</span>
<span class=normal>869</span>
<span class=normal>870</span>
<span class=normal>871</span>
<span class=normal>872</span>
<span class=normal>873</span>
<span class=normal>874</span>
<span class=normal>875</span>
<span class=normal>876</span>
<span class=normal>877</span>
<span class=normal>878</span>
<span class=normal>879</span>
<span class=normal>880</span>
<span class=normal>881</span>
<span class=normal>882</span>
<span class=normal>883</span>
<span class=normal>884</span>
<span class=normal>885</span>
<span class=normal>886</span>
<span class=normal>887</span>
<span class=normal>888</span>
<span class=normal>889</span>
<span class=normal>890</span>
<span class=normal>891</span>
<span class=normal>892</span>
<span class=normal>893</span>
<span class=normal>894</span>
<span class=normal>895</span>
<span class=normal>896</span>
<span class=normal>897</span>
<span class=normal>898</span>
<span class=normal>899</span>
<span class=normal>900</span>
<span class=normal>901</span>
<span class=normal>902</span>
<span class=normal>903</span>
<span class=normal>904</span>
<span class=normal>905</span>
<span class=normal>906</span>
<span class=normal>907</span>
<span class=normal>908</span>
<span class=normal>909</span>
<span class=normal>910</span>
<span class=normal>911</span>
<span class=normal>912</span>
<span class=normal>913</span>
<span class=normal>914</span>
<span class=normal>915</span>
<span class=normal>916</span>
<span class=normal>917</span>
<span class=normal>918</span>
<span class=normal>919</span>
<span class=normal>920</span>
<span class=normal>921</span>
<span class=normal>922</span>
<span class=normal>923</span>
<span class=normal>924</span>
<span class=normal>925</span>
<span class=normal>926</span>
<span class=normal>927</span>
<span class=normal>928</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_mua_events</span><span class=p>(</span>
    <span class=n>mua</span><span class=p>,</span>
    <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>minLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>maxLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>minThresholdLength</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Determine MUA/PBEs from multiunit activity.</span>

<span class=sd>    MUA : multiunit activity</span>
<span class=sd>    PBE : population burst event</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    mua : AnalogSignalArray</span>
<span class=sd>        AnalogSignalArray with one signal, namely the multiunit firing rate [in Hz].</span>
<span class=sd>    fs : float, optional</span>
<span class=sd>        Sampling frequency of mua, in Hz. If not specified, it will be inferred from</span>
<span class=sd>        mua.fs</span>
<span class=sd>    minLength : float, optional</span>
<span class=sd>    maxLength : float, optional</span>
<span class=sd>    PrimaryThreshold : float, optional</span>
<span class=sd>    SecondaryThreshold : float, optional</span>
<span class=sd>    minThresholdLength : float, optional</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    mua_epochs : EpochArray</span>
<span class=sd>        EpochArray containing all the MUA events / PBEs.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    mua = get_mua(spiketrain)</span>
<span class=sd>    mua_epochs = get_mua_events(mua)</span>
<span class=sd>    PBEs = get_PBEs(spiketrain, min_active=5)</span>
<span class=sd>         = get_PBEs(get_mua_events(get_mua(*)), spiketrain, min_active=5)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>fs</span> <span class=o>=</span> <span class=n>mua</span><span class=o>.</span><span class=n>fs</span>
    <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;fs must either be specified, or must be contained in mua!&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>PrimaryThreshold</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>PrimaryThreshold</span> <span class=o>=</span> <span class=n>mua</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span> <span class=o>+</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>mua</span><span class=o>.</span><span class=n>std</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>SecondaryThreshold</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>SecondaryThreshold</span> <span class=o>=</span> <span class=n>mua</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
    <span class=k>if</span> <span class=n>minLength</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>minLength</span> <span class=o>=</span> <span class=mf>0.050</span>  <span class=c1># 50 ms minimum event duration</span>
    <span class=k>if</span> <span class=n>maxLength</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>maxLength</span> <span class=o>=</span> <span class=mf>0.750</span>  <span class=c1># 750 ms maximum event duration</span>
    <span class=k>if</span> <span class=n>minThresholdLength</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>minThresholdLength</span> <span class=o>=</span> <span class=mf>0.0</span>

    <span class=c1># determine MUA event bounds:</span>
    <span class=n>mua_bounds_idx</span><span class=p>,</span> <span class=n>maxes</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>get_events_boundaries</span><span class=p>(</span>
        <span class=n>x</span><span class=o>=</span><span class=n>mua</span><span class=o>.</span><span class=n>data</span><span class=p>,</span>
        <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=n>PrimaryThreshold</span><span class=p>,</span>
        <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=n>SecondaryThreshold</span><span class=p>,</span>
        <span class=n>minThresholdLength</span><span class=o>=</span><span class=n>minThresholdLength</span><span class=p>,</span>
        <span class=n>minLength</span><span class=o>=</span><span class=n>minLength</span><span class=p>,</span>
        <span class=n>maxLength</span><span class=o>=</span><span class=n>maxLength</span><span class=p>,</span>
        <span class=n>ds</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=n>fs</span><span class=p>,</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>mua_bounds_idx</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>logging</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;no mua events detected&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>core</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span><span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=c1># store MUA bounds in an EpochArray</span>
    <span class=n>mua_epochs</span> <span class=o>=</span> <span class=n>core</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span><span class=n>mua</span><span class=o>.</span><span class=n>time</span><span class=p>[</span><span class=n>mua_bounds_idx</span><span class=p>])</span>

    <span class=k>return</span> <span class=n>mua_epochs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_run_epochs class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_run_epochs</span><span class=p>(</span><span class=n>speed</span><span class=p>,</span> <span class=n>v1</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>v2</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return epochs where animal is running at least as fast as specified by v1 and v2.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>speed</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray containing single channel speed, in units/sec</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>v1</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Minimum speed (in same units as speed) that has to be reached / exceeded during an event. Default is 10 [units/sec]</p> </div> </td> <td> <code>10</code> </td> </tr> <tr class=doc-section-item> <td> <code>v2</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Speed that defines the event boundaries. Default is 8 [units/sec]</p> </div> </td> <td> <code>8</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>run_epochs</code></td> <td> <code><a class="autorefs autorefs-internal" href=../../core/intervalarray/#nelpy.core._intervalarray.EpochArray>EpochArray</a></code> </td> <td> <div class=doc-md-description> <p>EpochArray with all the epochs where speed satisfied the criteria.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2500</span>
<span class=normal>2501</span>
<span class=normal>2502</span>
<span class=normal>2503</span>
<span class=normal>2504</span>
<span class=normal>2505</span>
<span class=normal>2506</span>
<span class=normal>2507</span>
<span class=normal>2508</span>
<span class=normal>2509</span>
<span class=normal>2510</span>
<span class=normal>2511</span>
<span class=normal>2512</span>
<span class=normal>2513</span>
<span class=normal>2514</span>
<span class=normal>2515</span>
<span class=normal>2516</span>
<span class=normal>2517</span>
<span class=normal>2518</span>
<span class=normal>2519</span>
<span class=normal>2520</span>
<span class=normal>2521</span>
<span class=normal>2522</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_run_epochs</span><span class=p>(</span><span class=n>speed</span><span class=p>,</span> <span class=n>v1</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>v2</span><span class=o>=</span><span class=mi>8</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return epochs where animal is running at least as fast as</span>
<span class=sd>    specified by v1 and v2.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    speed : AnalogSignalArray</span>
<span class=sd>        AnalogSignalArray containing single channel speed, in units/sec</span>
<span class=sd>    v1 : float, optional</span>
<span class=sd>        Minimum speed (in same units as speed) that has to be reached /</span>
<span class=sd>        exceeded during an event. Default is 10 [units/sec]</span>
<span class=sd>    v2 : float, optional</span>
<span class=sd>        Speed that defines the event boundaries. Default is 8 [units/sec]</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    run_epochs : EpochArray</span>
<span class=sd>        EpochArray with all the epochs where speed satisfied the criteria.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>run_epochs</span> <span class=o>=</span> <span class=n>get_threshold_crossing_epochs</span><span class=p>(</span><span class=n>asa</span><span class=o>=</span><span class=n>speed</span><span class=p>,</span> <span class=n>t1</span><span class=o>=</span><span class=n>v1</span><span class=p>,</span> <span class=n>t2</span><span class=o>=</span><span class=n>v2</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;above&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>run_epochs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_sort_idx class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_sort_idx</span><span class=p>(</span><span class=n>tuning_curves</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find indices to sort neurons by maximum firing rate location in tuning curve.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>tuning_curves</code> </td> <td> <code>list of lists</code> </td> <td> <div class=doc-md-description> <p>List where each inner list contains the tuning curve for an individual neuron.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>sorted_idx</code></td> <td> <code><span title=list>list</span></code> </td> <td> <div class=doc-md-description> <p>List of integers that correspond to neurons sorted by the location of their maximum firing rate in the tuning curve.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>tuning_curves</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>6</span><span class=p>]]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>get_sort_idx</span><span class=p>(</span><span class=n>tuning_curves</span><span class=p>)</span>
<span class=go>[1, 0, 2]  # sorted by position of max firing rate</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2655</span>
<span class=normal>2656</span>
<span class=normal>2657</span>
<span class=normal>2658</span>
<span class=normal>2659</span>
<span class=normal>2660</span>
<span class=normal>2661</span>
<span class=normal>2662</span>
<span class=normal>2663</span>
<span class=normal>2664</span>
<span class=normal>2665</span>
<span class=normal>2666</span>
<span class=normal>2667</span>
<span class=normal>2668</span>
<span class=normal>2669</span>
<span class=normal>2670</span>
<span class=normal>2671</span>
<span class=normal>2672</span>
<span class=normal>2673</span>
<span class=normal>2674</span>
<span class=normal>2675</span>
<span class=normal>2676</span>
<span class=normal>2677</span>
<span class=normal>2678</span>
<span class=normal>2679</span>
<span class=normal>2680</span>
<span class=normal>2681</span>
<span class=normal>2682</span>
<span class=normal>2683</span>
<span class=normal>2684</span>
<span class=normal>2685</span>
<span class=normal>2686</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_sort_idx</span><span class=p>(</span><span class=n>tuning_curves</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Find indices to sort neurons by maximum firing rate location in tuning curve.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    tuning_curves : list of lists</span>
<span class=sd>        List where each inner list contains the tuning curve for an individual</span>
<span class=sd>        neuron.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    sorted_idx : list</span>
<span class=sd>        List of integers that correspond to neurons sorted by the location</span>
<span class=sd>        of their maximum firing rate in the tuning curve.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; tuning_curves = [[1, 5, 2], [3, 1, 4], [2, 3, 6]]</span>
<span class=sd>    &gt;&gt;&gt; get_sort_idx(tuning_curves)</span>
<span class=sd>    [1, 0, 2]  # sorted by position of max firing rate</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>tc_max_loc</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>neuron_tc</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>tuning_curves</span><span class=p>):</span>
        <span class=n>tc_max_loc</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>i</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>neuron_tc</span> <span class=o>==</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>neuron_tc</span><span class=p>))[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]))</span>
    <span class=n>sorted_by_tc</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>tc_max_loc</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>

    <span class=n>sorted_idx</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=n>sorted_by_tc</span><span class=p>:</span>
        <span class=n>sorted_idx</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>idx</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>

    <span class=k>return</span> <span class=n>sorted_idx</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.get_threshold_crossing_epochs class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_threshold_crossing_epochs</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>t1</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>t2</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;above&#39;</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return epochs where a signal crosses a compound threshold specified by t1 and t2.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>asa</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/analogsignalarray/#nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</a></code> </td> <td> <div class=doc-md-description> <p>AnalogSignalArray containing a single channel</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>t1</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Primary threshold. Minimum signal value that has to be reached / exceeded during an event. Default is 3 standard deviations above signal mean.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>t2</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Secondary threshold. Signal value that defines the event boundaries. Default is signal mean.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>mode</code> </td> <td> <code><span title=string>string</span></code> </td> <td> <div class=doc-md-description> <p>Mode of operation. One of ['above', 'below']. If 'above', then return epochs where the signal exceeds the compound threshold, and if 'below', then return epochs where the signal falls below the compound threshold. Default is 'above'.</p> </div> </td> <td> <code>&#39;above&#39;</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>epochs</code></td> <td> <code><a class="autorefs autorefs-internal" href=../../core/intervalarray/#nelpy.core._intervalarray.EpochArray>EpochArray</a></code> </td> <td> <div class=doc-md-description> <p>EpochArray with all the epochs where the signal satisfied the criteria.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2448</span>
<span class=normal>2449</span>
<span class=normal>2450</span>
<span class=normal>2451</span>
<span class=normal>2452</span>
<span class=normal>2453</span>
<span class=normal>2454</span>
<span class=normal>2455</span>
<span class=normal>2456</span>
<span class=normal>2457</span>
<span class=normal>2458</span>
<span class=normal>2459</span>
<span class=normal>2460</span>
<span class=normal>2461</span>
<span class=normal>2462</span>
<span class=normal>2463</span>
<span class=normal>2464</span>
<span class=normal>2465</span>
<span class=normal>2466</span>
<span class=normal>2467</span>
<span class=normal>2468</span>
<span class=normal>2469</span>
<span class=normal>2470</span>
<span class=normal>2471</span>
<span class=normal>2472</span>
<span class=normal>2473</span>
<span class=normal>2474</span>
<span class=normal>2475</span>
<span class=normal>2476</span>
<span class=normal>2477</span>
<span class=normal>2478</span>
<span class=normal>2479</span>
<span class=normal>2480</span>
<span class=normal>2481</span>
<span class=normal>2482</span>
<span class=normal>2483</span>
<span class=normal>2484</span>
<span class=normal>2485</span>
<span class=normal>2486</span>
<span class=normal>2487</span>
<span class=normal>2488</span>
<span class=normal>2489</span>
<span class=normal>2490</span>
<span class=normal>2491</span>
<span class=normal>2492</span>
<span class=normal>2493</span>
<span class=normal>2494</span>
<span class=normal>2495</span>
<span class=normal>2496</span>
<span class=normal>2497</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_threshold_crossing_epochs</span><span class=p>(</span><span class=n>asa</span><span class=p>,</span> <span class=n>t1</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>t2</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;above&quot;</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return epochs where a signal crosses a compound threshold specified by t1</span>
<span class=sd>    and t2.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    asa : AnalogSignalArray</span>
<span class=sd>        AnalogSignalArray containing a single channel</span>
<span class=sd>    t1 : float, optional</span>
<span class=sd>        Primary threshold. Minimum signal value that has to be reached /</span>
<span class=sd>        exceeded during an event. Default is 3 standard deviations above signal</span>
<span class=sd>        mean.</span>
<span class=sd>    t2 : float, optional</span>
<span class=sd>        Secondary threshold. Signal value that defines the event boundaries.</span>
<span class=sd>        Default is signal mean.</span>
<span class=sd>    mode : string, optional</span>
<span class=sd>        Mode of operation. One of [&#39;above&#39;, &#39;below&#39;]. If &#39;above&#39;, then return</span>
<span class=sd>        epochs where the signal exceeds the compound threshold, and if &#39;below&#39;,</span>
<span class=sd>        then return epochs where the signal falls below the compound threshold.</span>
<span class=sd>        Default is &#39;above&#39;.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    epochs : EpochArray</span>
<span class=sd>        EpochArray with all the epochs where the signal satisfied the criteria.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>asa</span><span class=o>.</span><span class=n>n_signals</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;multidimensional AnalogSignalArrays not supported!&quot;</span><span class=p>)</span>
    <span class=n>x</span> <span class=o>=</span> <span class=n>asa</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>t1</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># by default, threshold is 3 SDs above mean of x</span>
        <span class=n>t1</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=mi>3</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>t2</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># by default, revert back to mean of x</span>
        <span class=n>t2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>

    <span class=c1># compute periods where signal exceeds compound threshold</span>
    <span class=n>epoch_bounds</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>get_events_boundaries</span><span class=p>(</span>
        <span class=n>x</span><span class=o>=</span><span class=n>x</span><span class=p>,</span> <span class=n>PrimaryThreshold</span><span class=o>=</span><span class=n>t1</span><span class=p>,</span> <span class=n>SecondaryThreshold</span><span class=o>=</span><span class=n>t2</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=n>mode</span>
    <span class=p>)</span>
    <span class=c1># convert bounds to time in seconds</span>
    <span class=n>epoch_bounds</span> <span class=o>=</span> <span class=n>asa</span><span class=o>.</span><span class=n>time</span><span class=p>[</span><span class=n>epoch_bounds</span><span class=p>]</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>epoch_bounds</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>return</span> <span class=nb>type</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>_abscissa</span><span class=o>.</span><span class=n>support</span><span class=p>)(</span><span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=c1># add 1/fs to stops for open interval</span>
    <span class=n>epoch_bounds</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>asa</span><span class=o>.</span><span class=n>fs</span>
    <span class=c1># create EpochArray with threshould exceeding bounds</span>
    <span class=n>epochs</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=n>asa</span><span class=o>.</span><span class=n>_abscissa</span><span class=o>.</span><span class=n>support</span><span class=p>)(</span><span class=n>epoch_bounds</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>epochs</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.information_rate class="doc doc-heading"> <code class="highlight language-python"><span class=n>information_rate</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>This computes the spatial information rate of cell spikes given variable x in bits/second.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>ratemap</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A firing rate map, any number of dimensions.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>Pi</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A probability distribution over the bins of the rate map. If not provided, it is assumed to be uniform.</p> </div> </td> <td> <code>1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>ir</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>The information rate of the cell, in bits/second.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>information_rate</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    This computes the spatial information rate of cell spikes given variable x in</span>
<span class=sd>    bits/second.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    ratemap : numpy.ndarray</span>
<span class=sd>        A firing rate map, any number of dimensions.</span>
<span class=sd>    Pi : numpy.ndarray</span>
<span class=sd>        A probability distribution over the bins of the rate map. If not</span>
<span class=sd>        provided, it is assumed to be uniform.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    ir : numpy.ndarray</span>
<span class=sd>        The information rate of the cell, in bits/second.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># convert Pi to probability distribution</span>
    <span class=n>Pi</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>Pi</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span>
    <span class=n>Pi</span> <span class=o>=</span> <span class=n>Pi</span> <span class=o>/</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span><span class=p>)</span>

    <span class=c1># Handle N-dimensional ratemaps (n_units, *spatial_dims)</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
            <span class=s2>&quot;rate map must have at least 2 dimensions (n_units, *spatial_dims)!&quot;</span>
        <span class=p>)</span>

    <span class=c1># Sum over all spatial dimensions to get mean firing rate for each unit</span>
    <span class=n>spatial_axes</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)))</span>
    <span class=n>R</span> <span class=o>=</span> <span class=p>(</span><span class=n>ratemap</span> <span class=o>*</span> <span class=n>Pi</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=n>spatial_axes</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>spatial_information</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=p>)</span> <span class=o>*</span> <span class=n>R</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.is_odd class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_odd</span><span class=p>(</span><span class=n>n</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Check if a number is odd.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>n</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Integer to check.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if n is odd, False if n is even.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>is_odd</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
<span class=go>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>is_odd</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
<span class=go>False</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>is_odd</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<span class=go>True</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_odd</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Check if a number is odd.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    n : int</span>
<span class=sd>        Integer to check.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    bool</span>
<span class=sd>        True if n is odd, False if n is even.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; is_odd(3)</span>
<span class=sd>    True</span>
<span class=sd>    &gt;&gt;&gt; is_odd(4)</span>
<span class=sd>    False</span>
<span class=sd>    &gt;&gt;&gt; is_odd(-1)</span>
<span class=sd>    True</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>n</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.is_sorted class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_sorted</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>chunk_size</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Check if a 1D array, list, or tuple is monotonically increasing (sorted).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>x</code> </td> <td> <code><span title=array>array</span> - <span title=like>like</span></code> </td> <td> <div class=doc-md-description> <p>1D array, list, or tuple to check.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>chunk_size</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Size of chunks to check at a time (for large arrays).</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>sorted</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if x is sorted, False otherwise.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>is_sorted</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
<span class=go>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>is_sorted</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span>
<span class=go>False</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>717</span>
<span class=normal>718</span>
<span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_sorted</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>chunk_size</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Check if a 1D array, list, or tuple is monotonically increasing (sorted).</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    x : array-like</span>
<span class=sd>        1D array, list, or tuple to check.</span>
<span class=sd>    chunk_size : int, optional</span>
<span class=sd>        Size of chunks to check at a time (for large arrays).</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    sorted : bool</span>
<span class=sd>        True if x is sorted, False otherwise.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; is_sorted([1, 2, 3])</span>
<span class=sd>    True</span>
<span class=sd>    &gt;&gt;&gt; is_sorted([1, 3, 2])</span>
<span class=sd>    False</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=p>(</span><span class=nb>tuple</span><span class=p>,</span> <span class=nb>list</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)):</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;Unsupported type </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span>

    <span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>atleast_1d</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>.</span><span class=n>squeeze</span><span class=p>())</span>
    <span class=k>if</span> <span class=n>x</span><span class=o>.</span><span class=n>ndim</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Input x must be 1-dimensional&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>chunk_size</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>chunk_size</span> <span class=o>=</span> <span class=mi>500000</span>
    <span class=n>stop</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>size</span>
    <span class=k>for</span> <span class=n>chunk_start</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>stop</span><span class=p>,</span> <span class=n>chunk_size</span><span class=p>):</span>
        <span class=n>chunk_stop</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>stop</span><span class=p>,</span> <span class=n>chunk_start</span> <span class=o>+</span> <span class=n>chunk_size</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span>
        <span class=n>chunk</span> <span class=o>=</span> <span class=n>x</span><span class=p>[</span><span class=n>chunk_start</span><span class=p>:</span><span class=n>chunk_stop</span><span class=p>]</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>np</span><span class=o>.</span><span class=n>all</span><span class=p>(</span><span class=n>chunk</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>chunk</span><span class=p>[</span><span class=mi>1</span><span class=p>:]):</span>
            <span class=k>return</span> <span class=kc>False</span>
    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.is_sorted_general class="doc doc-heading"> <code class="highlight language-python"><span class=n>is_sorted_general</span><span class=p>(</span><span class=n>iterable</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>a</span> <span class=o>&lt;=</span> <span class=n>b</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Check if an iterable is sorted according to a custom key function.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>iterable</code> </td> <td> <code><span title=iterable>iterable</span></code> </td> <td> <div class=doc-md-description> <p>Sequence to check.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>key</code> </td> <td> <code><span title=callable>callable</span></code> </td> <td> <div class=doc-md-description> <p>Function that takes two elements and returns True if they are in order. Default is lambda a, b: a &lt;= b (monotonic increasing).</p> </div> </td> <td> <code>lambda a, b: <span title=a>a</span> &lt;= <span title=b>b</span></code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if iterable is sorted according to key function.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>is_sorted_general</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>])</span>
<span class=go>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>is_sorted_general</span><span class=p>([</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>
<span class=go>False</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>is_sorted_general</span><span class=p>([</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>a</span> <span class=o>&gt;=</span> <span class=n>b</span><span class=p>)</span>  <span class=c1># decreasing</span>
<span class=go>True</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>688</span>
<span class=normal>689</span>
<span class=normal>690</span>
<span class=normal>691</span>
<span class=normal>692</span>
<span class=normal>693</span>
<span class=normal>694</span>
<span class=normal>695</span>
<span class=normal>696</span>
<span class=normal>697</span>
<span class=normal>698</span>
<span class=normal>699</span>
<span class=normal>700</span>
<span class=normal>701</span>
<span class=normal>702</span>
<span class=normal>703</span>
<span class=normal>704</span>
<span class=normal>705</span>
<span class=normal>706</span>
<span class=normal>707</span>
<span class=normal>708</span>
<span class=normal>709</span>
<span class=normal>710</span>
<span class=normal>711</span>
<span class=normal>712</span>
<span class=normal>713</span>
<span class=normal>714</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>is_sorted_general</span><span class=p>(</span><span class=n>iterable</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>a</span> <span class=o>&lt;=</span> <span class=n>b</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Check if an iterable is sorted according to a custom key function.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    iterable : iterable</span>
<span class=sd>        Sequence to check.</span>
<span class=sd>    key : callable, optional</span>
<span class=sd>        Function that takes two elements and returns True if they are in order.</span>
<span class=sd>        Default is lambda a, b: a &lt;= b (monotonic increasing).</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    bool</span>
<span class=sd>        True if iterable is sorted according to key function.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; is_sorted_general([1, 2, 3, 4])</span>
<span class=sd>    True</span>
<span class=sd>    &gt;&gt;&gt; is_sorted_general([4, 3, 2, 1])</span>
<span class=sd>    False</span>
<span class=sd>    &gt;&gt;&gt; is_sorted_general([4, 3, 2, 1], key=lambda a, b: a &gt;= b)  # decreasing</span>
<span class=sd>    True</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=nb>all</span><span class=p>(</span><span class=n>key</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>pairwise</span><span class=p>(</span><span class=n>iterable</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.linear_merge class="doc doc-heading"> <code class="highlight language-python"><span class=n>linear_merge</span><span class=p>(</span><span class=n>list1</span><span class=p>,</span> <span class=n>list2</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Merge two sorted lists in linear time.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>list1</code> </td> <td> <code><span title=list>list</span> or <span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>First sorted list.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>list2</code> </td> <td> <code><span title=list>list</span> or <span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Second sorted list.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>merged</code></td> <td> <code><span title=generator>generator</span></code> </td> <td> <div class=doc-md-description> <p>Generator yielding merged, sorted elements.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=nb>list</span><span class=p>(</span><span class=n>linear_merge</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>]))</span>
<span class=go>[1, 2, 3, 4, 5, 6]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=nb>list</span><span class=p>(</span><span class=n>linear_merge</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>]))</span>
<span class=go>[1, 2, 2, 2, 2, 3, 4, 4]</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span>
<span class=normal>812</span>
<span class=normal>813</span>
<span class=normal>814</span>
<span class=normal>815</span>
<span class=normal>816</span>
<span class=normal>817</span>
<span class=normal>818</span>
<span class=normal>819</span>
<span class=normal>820</span>
<span class=normal>821</span>
<span class=normal>822</span>
<span class=normal>823</span>
<span class=normal>824</span>
<span class=normal>825</span>
<span class=normal>826</span>
<span class=normal>827</span>
<span class=normal>828</span>
<span class=normal>829</span>
<span class=normal>830</span>
<span class=normal>831</span>
<span class=normal>832</span>
<span class=normal>833</span>
<span class=normal>834</span>
<span class=normal>835</span>
<span class=normal>836</span>
<span class=normal>837</span>
<span class=normal>838</span>
<span class=normal>839</span>
<span class=normal>840</span>
<span class=normal>841</span>
<span class=normal>842</span>
<span class=normal>843</span>
<span class=normal>844</span>
<span class=normal>845</span>
<span class=normal>846</span>
<span class=normal>847</span>
<span class=normal>848</span>
<span class=normal>849</span>
<span class=normal>850</span>
<span class=normal>851</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>linear_merge</span><span class=p>(</span><span class=n>list1</span><span class=p>,</span> <span class=n>list2</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Merge two sorted lists in linear time.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    list1 : list or np.ndarray</span>
<span class=sd>        First sorted list.</span>
<span class=sd>    list2 : list or np.ndarray</span>
<span class=sd>        Second sorted list.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    merged : generator</span>
<span class=sd>        Generator yielding merged, sorted elements.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; list(linear_merge([1, 3, 5], [2, 4, 6]))</span>
<span class=sd>    [1, 2, 3, 4, 5, 6]</span>
<span class=sd>    &gt;&gt;&gt; list(linear_merge([1, 2, 2, 3], [2, 2, 4, 4]))</span>
<span class=sd>    [1, 2, 2, 2, 2, 3, 4, 4]</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># if any of the lists are empty, return the other (possibly also</span>
    <span class=c1># empty) list: (this is necessary because having either list1 or</span>
    <span class=c1># list2 be empty makes this quite a bit more complicated...)</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>list1</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)):</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>list1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>list2</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=n>list2</span><span class=p>)</span>
            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=k>yield</span> <span class=nb>next</span><span class=p>(</span><span class=n>list2</span><span class=p>)</span>
                <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                    <span class=k>return</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>list2</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)):</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>list2</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>list1</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=n>list1</span><span class=p>)</span>
            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=k>yield</span> <span class=nb>next</span><span class=p>(</span><span class=n>list1</span><span class=p>)</span>
                <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                    <span class=k>return</span>

    <span class=n>list1</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=n>list1</span><span class=p>)</span>
    <span class=n>list2</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=n>list2</span><span class=p>)</span>

    <span class=n>value1</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>list1</span><span class=p>)</span>
    <span class=n>value2</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>list2</span><span class=p>)</span>

    <span class=c1># We&#39;ll normally exit this loop from a next() call raising</span>
    <span class=c1># StopIteration, which is how a generator function exits anyway.</span>
    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>value1</span> <span class=o>&lt;=</span> <span class=n>value2</span><span class=p>:</span>
            <span class=c1># Yield the lower value.</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>yield</span> <span class=n>value1</span>
            <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                <span class=k>return</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=c1># Grab the next value from list1.</span>
                <span class=n>value1</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>list1</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                <span class=c1># list1 is empty.  Yield the last value we received from list2, then</span>
                <span class=c1># yield the rest of list2.</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=k>yield</span> <span class=n>value2</span>
                <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                    <span class=k>return</span>
                <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
                    <span class=k>try</span><span class=p>:</span>
                        <span class=k>yield</span> <span class=nb>next</span><span class=p>(</span><span class=n>list2</span><span class=p>)</span>
                    <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                        <span class=k>return</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>yield</span> <span class=n>value2</span>
            <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                <span class=k>return</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>value2</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>list2</span><span class=p>)</span>

            <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                <span class=c1># list2 is empty.</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=k>yield</span> <span class=n>value1</span>
                <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                    <span class=k>return</span>
                <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
                    <span class=k>try</span><span class=p>:</span>
                        <span class=k>yield</span> <span class=nb>next</span><span class=p>(</span><span class=n>list1</span><span class=p>)</span>
                    <span class=k>except</span> <span class=ne>StopIteration</span><span class=p>:</span>
                        <span class=k>return</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.nextfastpower class="doc doc-heading"> <code class="highlight language-python"><span class=n>nextfastpower</span><span class=p>(</span><span class=n>n</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return the next integral power of small factors greater than the given number. Specifically, return m such that m &gt;= n m == 2<strong>x * 3</strong>y * 5**z where x, y, and z are integers. This is useful for ensuring fast FFT sizes.</p> <p>From https://gist.github.com/bhawkins/4479607 (Brian Hawkins)</p> <p>See also http://scipy.github.io/devdocs/generated/scipy.fftpack.next_fast_len.html</p> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1952</span>
<span class=normal>1953</span>
<span class=normal>1954</span>
<span class=normal>1955</span>
<span class=normal>1956</span>
<span class=normal>1957</span>
<span class=normal>1958</span>
<span class=normal>1959</span>
<span class=normal>1960</span>
<span class=normal>1961</span>
<span class=normal>1962</span>
<span class=normal>1963</span>
<span class=normal>1964</span>
<span class=normal>1965</span>
<span class=normal>1966</span>
<span class=normal>1967</span>
<span class=normal>1968</span>
<span class=normal>1969</span>
<span class=normal>1970</span>
<span class=normal>1971</span>
<span class=normal>1972</span>
<span class=normal>1973</span>
<span class=normal>1974</span>
<span class=normal>1975</span>
<span class=normal>1976</span>
<span class=normal>1977</span>
<span class=normal>1978</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>nextfastpower</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return the next integral power of small factors greater than the given</span>
<span class=sd>    number.  Specifically, return m such that</span>
<span class=sd>        m &gt;= n</span>
<span class=sd>        m == 2**x * 3**y * 5**z</span>
<span class=sd>    where x, y, and z are integers.</span>
<span class=sd>    This is useful for ensuring fast FFT sizes.</span>

<span class=sd>    From https://gist.github.com/bhawkins/4479607 (Brian Hawkins)</span>

<span class=sd>    See also http://scipy.github.io/devdocs/generated/scipy.fftpack.next_fast_len.html</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=mi>7</span><span class=p>:</span>
        <span class=k>return</span> <span class=nb>max</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=c1># x, y, and z are all bounded from above by the formula of nextpower.</span>
    <span class=c1># Compute all possible combinations for powers of 3 and 5.</span>
    <span class=c1># (Not too many for reasonable FFT sizes.)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>power_series</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>base</span><span class=p>):</span>
        <span class=n>nmax</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ceil</span><span class=p>(</span><span class=n>log</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>/</span> <span class=n>log</span><span class=p>(</span><span class=n>base</span><span class=p>)))</span>
        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>logspace</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>nmax</span><span class=p>,</span> <span class=n>num</span><span class=o>=</span><span class=n>nmax</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>base</span><span class=o>=</span><span class=n>base</span><span class=p>)</span>

    <span class=n>n35</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>outer</span><span class=p>(</span><span class=n>power_series</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=mf>3.0</span><span class=p>),</span> <span class=n>power_series</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=mf>5.0</span><span class=p>))</span>
    <span class=n>n35</span> <span class=o>=</span> <span class=n>n35</span><span class=p>[</span><span class=n>n35</span> <span class=o>&lt;=</span> <span class=n>n</span><span class=p>]</span>
    <span class=c1># Lump the powers of 3 and 5 together and solve for the powers of 2.</span>
    <span class=n>n2</span> <span class=o>=</span> <span class=n>nextpower</span><span class=p>(</span><span class=n>n</span> <span class=o>/</span> <span class=n>n35</span><span class=p>)</span>
    <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=n>n2</span> <span class=o>*</span> <span class=n>n35</span><span class=p>))</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.nextpower class="doc doc-heading"> <code class="highlight language-python"><span class=n>nextpower</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>base</span><span class=o>=</span><span class=mf>2.0</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return the next integral power of two greater than the given number. Specifically, return m such that m &gt;= n m == 2**x where x is an integer. Use base argument to specify a base other than 2. This is useful for ensuring fast FFT sizes.</p> <p>From https://gist.github.com/bhawkins/4479607 (Brian Hawkins)</p> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1935</span>
<span class=normal>1936</span>
<span class=normal>1937</span>
<span class=normal>1938</span>
<span class=normal>1939</span>
<span class=normal>1940</span>
<span class=normal>1941</span>
<span class=normal>1942</span>
<span class=normal>1943</span>
<span class=normal>1944</span>
<span class=normal>1945</span>
<span class=normal>1946</span>
<span class=normal>1947</span>
<span class=normal>1948</span>
<span class=normal>1949</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>nextpower</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>base</span><span class=o>=</span><span class=mf>2.0</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Return the next integral power of two greater than the given number.</span>
<span class=sd>    Specifically, return m such that</span>
<span class=sd>        m &gt;= n</span>
<span class=sd>        m == 2**x</span>
<span class=sd>    where x is an integer. Use base argument to specify a base other than 2.</span>
<span class=sd>    This is useful for ensuring fast FFT sizes.</span>

<span class=sd>    From https://gist.github.com/bhawkins/4479607 (Brian Hawkins)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>x</span> <span class=o>=</span> <span class=n>base</span> <span class=o>**</span> <span class=n>ceil</span><span class=p>(</span><span class=n>log</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=o>/</span> <span class=n>log</span><span class=p>(</span><span class=n>base</span><span class=p>))</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.pairwise class="doc doc-heading"> <code class="highlight language-python"><span class=n>pairwise</span><span class=p>(</span><span class=n>iterable</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Return a zip of all neighboring pairs in an iterable.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>iterable</code> </td> <td> <code><span title=iterable>iterable</span></code> </td> <td> <div class=doc-md-description> <p>Input iterable.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>pairs</code></td> <td> <code><span title=zip>zip</span></code> </td> <td> <div class=doc-md-description> <p>Iterator of pairs (a, b).</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=nb>list</span><span class=p>(</span><span class=n>pairwise</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>7</span><span class=p>]))</span>
<span class=go>[(2, 3), (3, 6), (6, 8), (8, 7)]</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>pairwise</span><span class=p>(</span><span class=n>iterable</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Return a zip of all neighboring pairs in an iterable.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    iterable : iterable</span>
<span class=sd>        Input iterable.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    pairs : zip</span>
<span class=sd>        Iterator of pairs (a, b).</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; list(pairwise([2, 3, 6, 8, 7]))</span>
<span class=sd>    [(2, 3), (3, 6), (6, 8), (8, 7)]</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>tee</span><span class=p>(</span><span class=n>iterable</span><span class=p>)</span>
    <span class=nb>next</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
    <span class=k>return</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.ragged_array class="doc doc-heading"> <code class="highlight language-python"><span class=n>ragged_array</span><span class=p>(</span><span class=n>arr</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Convert a list of arrays into a ragged array (object dtype).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>arr</code> </td> <td> <code>list of np.ndarray</code> </td> <td> <div class=doc-md-description> <p>List of arrays to combine into a ragged array.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Ragged array of dtype object.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>ragged_array</span><span class=p>([</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>)])</span>
<span class=go>array([array([0, 1, 2]), array([0, 1, 2, 3, 4])], dtype=object)</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>ragged_array</span><span class=p>(</span><span class=n>arr</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Convert a list of arrays into a ragged array (object dtype).</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    arr : list of np.ndarray</span>
<span class=sd>        List of arrays to combine into a ragged array.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : np.ndarray</span>
<span class=sd>        Ragged array of dtype object.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; ragged_array([np.arange(3), np.arange(5)])</span>
<span class=sd>    array([array([0, 1, 2]), array([0, 1, 2, 3, 4])], dtype=object)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>n_elem</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>arr</span><span class=p>)</span>
    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>n_elem</span> <span class=o>*</span> <span class=p>[</span><span class=kc>None</span><span class=p>])</span>
    <span class=k>for</span> <span class=n>ii</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>out</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
        <span class=n>out</span><span class=p>[</span><span class=n>ii</span><span class=p>]</span> <span class=o>=</span> <span class=n>arr</span><span class=p>[</span><span class=n>ii</span><span class=p>]</span>
    <span class=k>return</span> <span class=n>out</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.shrinkMatColsTo class="doc doc-heading"> <code class="highlight language-python"><span class=n>shrinkMatColsTo</span><span class=p>(</span><span class=n>mat</span><span class=p>,</span> <span class=n>numCols</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Shrink a matrix by reducing the number of columns using interpolation.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>mat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Input matrix of shape (N, M1).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>numCols</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Target number of columns M2, where M2 &lt;= M1.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Resized matrix of shape (N, numCols).</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>mat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>]])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>shrinkMatColsTo</span><span class=p>(</span><span class=n>mat</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
<span class=go>array([[1.5, 3.5],</span>
<span class=go>       [5.5, 7.5]])</span>
</code></pre></div> <details class=note open> <summary>Notes</summary> <p>Uses scipy.ndimage.zoom with order=1 (linear interpolation).</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1585</span>
<span class=normal>1586</span>
<span class=normal>1587</span>
<span class=normal>1588</span>
<span class=normal>1589</span>
<span class=normal>1590</span>
<span class=normal>1591</span>
<span class=normal>1592</span>
<span class=normal>1593</span>
<span class=normal>1594</span>
<span class=normal>1595</span>
<span class=normal>1596</span>
<span class=normal>1597</span>
<span class=normal>1598</span>
<span class=normal>1599</span>
<span class=normal>1600</span>
<span class=normal>1601</span>
<span class=normal>1602</span>
<span class=normal>1603</span>
<span class=normal>1604</span>
<span class=normal>1605</span>
<span class=normal>1606</span>
<span class=normal>1607</span>
<span class=normal>1608</span>
<span class=normal>1609</span>
<span class=normal>1610</span>
<span class=normal>1611</span>
<span class=normal>1612</span>
<span class=normal>1613</span>
<span class=normal>1614</span>
<span class=normal>1615</span>
<span class=normal>1616</span>
<span class=normal>1617</span>
<span class=normal>1618</span>
<span class=normal>1619</span>
<span class=normal>1620</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>shrinkMatColsTo</span><span class=p>(</span><span class=n>mat</span><span class=p>,</span> <span class=n>numCols</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Shrink a matrix by reducing the number of columns using interpolation.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    mat : np.ndarray</span>
<span class=sd>        Input matrix of shape (N, M1).</span>
<span class=sd>    numCols : int</span>
<span class=sd>        Target number of columns M2, where M2 &lt;= M1.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Resized matrix of shape (N, numCols).</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; mat = np.array([[1, 2, 3, 4], [5, 6, 7, 8]])</span>
<span class=sd>    &gt;&gt;&gt; shrinkMatColsTo(mat, 2)</span>
<span class=sd>    array([[1.5, 3.5],</span>
<span class=sd>           [5.5, 7.5]])</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    Uses scipy.ndimage.zoom with order=1 (linear interpolation).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>scipy.ndimage</span><span class=w> </span><span class=kn>import</span> <span class=n>zoom</span>

    <span class=n>numCells</span> <span class=o>=</span> <span class=n>mat</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
    <span class=n>numColsMat</span> <span class=o>=</span> <span class=n>mat</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
    <span class=n>a</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>numCells</span><span class=p>,</span> <span class=n>numCols</span><span class=p>))</span>
    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>numCells</span><span class=p>):</span>
        <span class=n>niurou</span> <span class=o>=</span> <span class=n>zoom</span><span class=p>(</span><span class=nb>input</span><span class=o>=</span><span class=n>mat</span><span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=p>:],</span> <span class=n>zoom</span><span class=o>=</span><span class=p>(</span><span class=n>numCols</span> <span class=o>/</span> <span class=n>numColsMat</span><span class=p>),</span> <span class=n>order</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>a</span><span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>niurou</span>
    <span class=k>return</span> <span class=n>a</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.signal_envelope1D class="doc doc-heading"> <code class="highlight language-python"><span class=n>signal_envelope1D</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Find the signal envelope using the Hilbert transform (deprecated).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code>numpy array, list, or RegularlySampledAnalogSignalArray</code> </td> <td> <div class=doc-md-description> <p>Input data.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Standard deviation of Gaussian smoothing kernel in seconds.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>fs</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Sampling rate of the signal.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code>same type as input</code> </td> <td> <div class=doc-md-description> <p>Signal envelope.</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>This function is deprecated. Use <code>signal_envelope_1d</code> instead.</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1807</span>
<span class=normal>1808</span>
<span class=normal>1809</span>
<span class=normal>1810</span>
<span class=normal>1811</span>
<span class=normal>1812</span>
<span class=normal>1813</span>
<span class=normal>1814</span>
<span class=normal>1815</span>
<span class=normal>1816</span>
<span class=normal>1817</span>
<span class=normal>1818</span>
<span class=normal>1819</span>
<span class=normal>1820</span>
<span class=normal>1821</span>
<span class=normal>1822</span>
<span class=normal>1823</span>
<span class=normal>1824</span>
<span class=normal>1825</span>
<span class=normal>1826</span>
<span class=normal>1827</span>
<span class=normal>1828</span>
<span class=normal>1829</span>
<span class=normal>1830</span>
<span class=normal>1831</span>
<span class=normal>1832</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>signal_envelope1D</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Find the signal envelope using the Hilbert transform (deprecated).</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    data : numpy array, list, or RegularlySampledAnalogSignalArray</span>
<span class=sd>        Input data.</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Standard deviation of Gaussian smoothing kernel in seconds.</span>
<span class=sd>    fs : float, optional</span>
<span class=sd>        Sampling rate of the signal.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : same type as input</span>
<span class=sd>        Signal envelope.</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    This function is deprecated. Use `signal_envelope_1d` instead.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>logging</span><span class=o>.</span><span class=n>warnings</span><span class=p>(</span>
        <span class=s2>&quot;&#39;signal_envelope1D&#39; is deprecated; use &#39;signal_envelope_1d&#39; instead!&quot;</span>
    <span class=p>)</span>
    <span class=k>return</span> <span class=n>signal_envelope_1d</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=n>fs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.signal_envelope_1d class="doc doc-heading"> <code class="highlight language-python"><span class=n>signal_envelope_1d</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Finds the signal envelope by taking the absolute value of the Hilbert transform</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>data</code> </td> <td> <code>numpy array, list, or RegularlySampledAnalogSignalArray</code> </td> <td> <div class=doc-md-description> <p>Input data If data is a numpy array, it is expected to have shape (n_signals, n_samples) If data is a list, it is expected to have length n_signals, where each sublist has length n_samples, i.e. data is not jagged</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>sigma</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Standard deviation of the Gaussian kernel used to smooth the envelope after applying the Hilbert transform. Units of seconds. Default is 4 ms</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>fs</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Sampling rate of the signal</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code>same type as the input object</code> </td> <td> <div class=doc-md-description> <p>An object containing the signal envelope</p> </div> </td> </tr> <tr class=doc-section-item> <td><code>TODO</code></td> <td> <code>this is not yet epoch-aware!</code> </td> <td> <div class=doc-md-description> </div> </td> </tr> <tr class=doc-section-item> <td><code>UPDATE</code></td> <td> <code>this is actually epoch-aware by now!</code> </td> <td> <div class=doc-md-description> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1835</span>
<span class=normal>1836</span>
<span class=normal>1837</span>
<span class=normal>1838</span>
<span class=normal>1839</span>
<span class=normal>1840</span>
<span class=normal>1841</span>
<span class=normal>1842</span>
<span class=normal>1843</span>
<span class=normal>1844</span>
<span class=normal>1845</span>
<span class=normal>1846</span>
<span class=normal>1847</span>
<span class=normal>1848</span>
<span class=normal>1849</span>
<span class=normal>1850</span>
<span class=normal>1851</span>
<span class=normal>1852</span>
<span class=normal>1853</span>
<span class=normal>1854</span>
<span class=normal>1855</span>
<span class=normal>1856</span>
<span class=normal>1857</span>
<span class=normal>1858</span>
<span class=normal>1859</span>
<span class=normal>1860</span>
<span class=normal>1861</span>
<span class=normal>1862</span>
<span class=normal>1863</span>
<span class=normal>1864</span>
<span class=normal>1865</span>
<span class=normal>1866</span>
<span class=normal>1867</span>
<span class=normal>1868</span>
<span class=normal>1869</span>
<span class=normal>1870</span>
<span class=normal>1871</span>
<span class=normal>1872</span>
<span class=normal>1873</span>
<span class=normal>1874</span>
<span class=normal>1875</span>
<span class=normal>1876</span>
<span class=normal>1877</span>
<span class=normal>1878</span>
<span class=normal>1879</span>
<span class=normal>1880</span>
<span class=normal>1881</span>
<span class=normal>1882</span>
<span class=normal>1883</span>
<span class=normal>1884</span>
<span class=normal>1885</span>
<span class=normal>1886</span>
<span class=normal>1887</span>
<span class=normal>1888</span>
<span class=normal>1889</span>
<span class=normal>1890</span>
<span class=normal>1891</span>
<span class=normal>1892</span>
<span class=normal>1893</span>
<span class=normal>1894</span>
<span class=normal>1895</span>
<span class=normal>1896</span>
<span class=normal>1897</span>
<span class=normal>1898</span>
<span class=normal>1899</span>
<span class=normal>1900</span>
<span class=normal>1901</span>
<span class=normal>1902</span>
<span class=normal>1903</span>
<span class=normal>1904</span>
<span class=normal>1905</span>
<span class=normal>1906</span>
<span class=normal>1907</span>
<span class=normal>1908</span>
<span class=normal>1909</span>
<span class=normal>1910</span>
<span class=normal>1911</span>
<span class=normal>1912</span>
<span class=normal>1913</span>
<span class=normal>1914</span>
<span class=normal>1915</span>
<span class=normal>1916</span>
<span class=normal>1917</span>
<span class=normal>1918</span>
<span class=normal>1919</span>
<span class=normal>1920</span>
<span class=normal>1921</span>
<span class=normal>1922</span>
<span class=normal>1923</span>
<span class=normal>1924</span>
<span class=normal>1925</span>
<span class=normal>1926</span>
<span class=normal>1927</span>
<span class=normal>1928</span>
<span class=normal>1929</span>
<span class=normal>1930</span>
<span class=normal>1931</span>
<span class=normal>1932</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>signal_envelope_1d</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Finds the signal envelope by taking the absolute value</span>
<span class=sd>    of the Hilbert transform</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    data : numpy array, list, or RegularlySampledAnalogSignalArray</span>
<span class=sd>        Input data</span>
<span class=sd>        If data is a numpy array, it is expected to have shape</span>
<span class=sd>        (n_signals, n_samples)</span>
<span class=sd>        If data is a list, it is expected to have length n_signals,</span>
<span class=sd>        where each sublist has length n_samples, i.e. data is not</span>
<span class=sd>        jagged</span>
<span class=sd>    sigma : float, optional</span>
<span class=sd>        Standard deviation of the Gaussian kernel used to</span>
<span class=sd>        smooth the envelope after applying the Hilbert transform.</span>
<span class=sd>        Units of seconds. Default is 4 ms</span>
<span class=sd>    fs : float, optional</span>
<span class=sd>        Sampling rate of the signal</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : same type as the input object</span>
<span class=sd>        An object containing the signal envelope</span>

<span class=sd>    TODO: this is not yet epoch-aware!</span>
<span class=sd>    UPDATE: this is actually epoch-aware by now!</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>sigma</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.004</span>  <span class=c1># 4 ms standard deviation</span>
    <span class=k>if</span> <span class=n>fs</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>list</span><span class=p>)):</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;sampling frequency must be specified!&quot;</span><span class=p>)</span>
        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>):</span>
            <span class=n>fs</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>fs</span>

    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>list</span><span class=p>)):</span>
        <span class=n>data_array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
        <span class=n>n_dims</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>ndim</span>
        <span class=k>assert</span> <span class=n>n_dims</span> <span class=o>&lt;=</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&quot;Only 1D signals supported!&quot;</span>
        <span class=k>if</span> <span class=n>n_dims</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>input_data</span> <span class=o>=</span> <span class=n>data_array</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=n>data_array</span><span class=o>.</span><span class=n>size</span><span class=p>))</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>input_data</span> <span class=o>=</span> <span class=n>data_array</span>
        <span class=n>n_signals</span><span class=p>,</span> <span class=n>n_samples</span> <span class=o>=</span> <span class=n>input_data</span><span class=o>.</span><span class=n>shape</span>
        <span class=c1># Compute number of samples to compute fast FFTs</span>
        <span class=n>padlen</span> <span class=o>=</span> <span class=n>next_fast_len</span><span class=p>(</span><span class=n>n_samples</span><span class=p>)</span> <span class=o>-</span> <span class=n>n_samples</span>
        <span class=c1># Pad data</span>
        <span class=n>paddeddata</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>hstack</span><span class=p>((</span><span class=n>input_data</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_signals</span><span class=p>,</span> <span class=n>padlen</span><span class=p>))))</span>
        <span class=c1># Use hilbert transform to get an envelope</span>
        <span class=n>envelope</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>absolute</span><span class=p>(</span><span class=n>hilbert</span><span class=p>(</span><span class=n>paddeddata</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span><span class=p>))</span>
        <span class=c1># free up memory</span>
        <span class=k>del</span> <span class=n>paddeddata</span>
        <span class=c1># Truncate results back to original length</span>
        <span class=n>envelope</span> <span class=o>=</span> <span class=n>envelope</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=p>:</span><span class=n>n_samples</span><span class=p>]</span>
        <span class=k>if</span> <span class=n>sigma</span><span class=p>:</span>
            <span class=c1># Smooth envelope with a gaussian (sigma = 4 ms default)</span>
            <span class=n>EnvelopeSmoothingSD</span> <span class=o>=</span> <span class=n>sigma</span> <span class=o>*</span> <span class=n>fs</span>
            <span class=n>smoothed_envelope</span> <span class=o>=</span> <span class=n>gaussian_filter1d</span><span class=p>(</span>
                <span class=n>envelope</span><span class=p>,</span> <span class=n>EnvelopeSmoothingSD</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;constant&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span>
            <span class=p>)</span>
            <span class=n>envelope</span> <span class=o>=</span> <span class=n>smoothed_envelope</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
            <span class=n>envelope</span> <span class=o>=</span> <span class=n>envelope</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
        <span class=k>return</span> <span class=n>envelope</span>
    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>core</span><span class=o>.</span><span class=n>RegularlySampledAnalogSignalArray</span><span class=p>):</span>
        <span class=c1># Only ASA data of shape (n_signals, n_timepoints) -&gt; 2D currently supported</span>
        <span class=k>assert</span> <span class=n>data</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>2</span>
        <span class=n>cum_lengths</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>lengths</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

        <span class=n>newasa</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
        <span class=c1># for segment in data:</span>
        <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>n_epochs</span><span class=p>):</span>
            <span class=c1># print(&#39;hilberting epoch {}/{}&#39;.format(idx+1, data.n_epochs))</span>
            <span class=n>segment_data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span>
            <span class=n>n_signals</span><span class=p>,</span> <span class=n>n_samples</span> <span class=o>=</span> <span class=n>segment_data</span><span class=o>.</span><span class=n>shape</span>
            <span class=c1># Compute number of samples to compute fast FFTs:</span>
            <span class=n>padlen</span> <span class=o>=</span> <span class=n>next_fast_len</span><span class=p>(</span><span class=n>n_samples</span><span class=p>)</span> <span class=o>-</span> <span class=n>n_samples</span>
            <span class=c1># Pad data</span>
            <span class=n>paddeddata</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>hstack</span><span class=p>((</span><span class=n>segment_data</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_signals</span><span class=p>,</span> <span class=n>padlen</span><span class=p>))))</span>
            <span class=c1># Use hilbert transform to get an envelope</span>
            <span class=n>envelope</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>absolute</span><span class=p>(</span><span class=n>hilbert</span><span class=p>(</span><span class=n>paddeddata</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span><span class=p>))</span>
            <span class=c1># free up memory</span>
            <span class=k>del</span> <span class=n>paddeddata</span>
            <span class=c1># Truncate results back to original length</span>
            <span class=n>envelope</span> <span class=o>=</span> <span class=n>envelope</span><span class=p>[</span><span class=o>...</span><span class=p>,</span> <span class=p>:</span><span class=n>n_samples</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>sigma</span><span class=p>:</span>
                <span class=c1># Smooth envelope with a gaussian (sigma = 4 ms default)</span>
                <span class=n>EnvelopeSmoothingSD</span> <span class=o>=</span> <span class=n>sigma</span> <span class=o>*</span> <span class=n>fs</span>
                <span class=n>smoothed_envelope</span> <span class=o>=</span> <span class=n>gaussian_filter1d</span><span class=p>(</span>
                    <span class=n>envelope</span><span class=p>,</span> <span class=n>EnvelopeSmoothingSD</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;constant&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span>
                <span class=p>)</span>
                <span class=n>envelope</span> <span class=o>=</span> <span class=n>smoothed_envelope</span>
            <span class=n>newasa</span><span class=o>.</span><span class=n>_data</span><span class=p>[:,</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>cum_lengths</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>atleast_2d</span><span class=p>(</span>
                <span class=n>envelope</span>
            <span class=p>)</span>
        <span class=k>return</span> <span class=n>newasa</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.spatial_information class="doc doc-heading"> <code class="highlight language-python"><span class=n>spatial_information</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute the spatial information and firing sparsity...</p> <p>The specificity index examines the amount of information (in bits) that a single spike conveys about the animal's location (i.e., how well cell firing predicts the animal's location).The spatial information content of cell discharge was calculated using the formula: information content = \Sum P_i(R_i/R)log_2(R_i/R) where i is the bin number, P_i, is the probability for occupancy of bin i, R_i, is the mean firing rate for bin i, and R is the overall mean firing rate.</p> <p>In order to account for the effects of low firing rates (with fewer spikes there is a tendency toward higher information content) or random bursts of firing, the spike firing time-series was randomly offset in time from the rat location time-series, and the information content was calculated. A distribution of the information content based on 100 such random shifts was obtained and was used to compute a standardized score (Zscore) of information content for that cell. While the distribution is not composed of independent samples, it was nominally normally distributed, and a Z value of 2.29 was chosen as a cut-off for significance (the equivalent of a one-tailed t-test with P = 0.01 under a normal distribution).</p> <details class=reference(s) open> <summary>Reference(s)</summary> <p>Markus, E. J., Barnes, C. A., McNaughton, B. L., Gladden, V. L., and Skaggs, W. E. (1994). "Spatial information content and reliability of hippocampal CA1 neurons: effects of visual input", Hippocampus, 4(4), 410-421.</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>ratemap</code> </td> <td> <code>array of shape (n_units, n_bins)</code> </td> <td> <div class=doc-md-description> <p>Rate map in Hz.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>Pi</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A probability distribution over the bins of the rate map. If not provided, it is assumed to be uniform.</p> </div> </td> <td> <code>1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>si</code></td> <td> <code>array of shape (n_units,)</code> </td> <td> <div class=doc-md-description> <p>spatial information (in bits per spike)</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>spatial_information</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Compute the spatial information and firing sparsity...</span>

<span class=sd>    The specificity index examines the amount of information</span>
<span class=sd>    (in bits) that a single spike conveys about the animal&#39;s</span>
<span class=sd>    location (i.e., how well cell firing predicts the animal&#39;s</span>
<span class=sd>    location).The spatial information content of cell discharge was</span>
<span class=sd>    calculated using the formula:</span>
<span class=sd>        information content = \\Sum P_i(R_i/R)log_2(R_i/R)</span>
<span class=sd>    where i is the bin number, P_i, is the probability for occupancy</span>
<span class=sd>    of bin i, R_i, is the mean firing rate for bin i, and R is the</span>
<span class=sd>    overall mean firing rate.</span>

<span class=sd>    In order to account for the effects of low firing rates (with</span>
<span class=sd>    fewer spikes there is a tendency toward higher information</span>
<span class=sd>    content) or random bursts of firing, the spike firing</span>
<span class=sd>    time-series was randomly offset in time from the rat location</span>
<span class=sd>    time-series, and the information content was calculated. A</span>
<span class=sd>    distribution of the information content based on 100 such random</span>
<span class=sd>    shifts was obtained and was used to compute a standardized score</span>
<span class=sd>    (Zscore) of information content for that cell. While the</span>
<span class=sd>    distribution is not composed of independent samples, it was</span>
<span class=sd>    nominally normally distributed, and a Z value of 2.29 was chosen</span>
<span class=sd>    as a cut-off for significance (the equivalent of a one-tailed</span>
<span class=sd>    t-test with P = 0.01 under a normal distribution).</span>

<span class=sd>    Reference(s)</span>
<span class=sd>    ------------</span>
<span class=sd>    Markus, E. J., Barnes, C. A., McNaughton, B. L., Gladden, V. L.,</span>
<span class=sd>        and Skaggs, W. E. (1994). &quot;Spatial information content and</span>
<span class=sd>        reliability of hippocampal CA1 neurons: effects of visual</span>
<span class=sd>        input&quot;, Hippocampus, 4(4), 410-421.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    ratemap : array of shape (n_units, n_bins)</span>
<span class=sd>        Rate map in Hz.</span>

<span class=sd>    Pi : numpy.ndarray</span>
<span class=sd>        A probability distribution over the bins of the rate map. If not</span>
<span class=sd>        provided, it is assumed to be uniform.</span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    si : array of shape (n_units,)</span>
<span class=sd>        spatial information (in bits per spike)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># convert Pi to probability distribution</span>
    <span class=n>Pi</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>Pi</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span>
    <span class=n>Pi</span> <span class=o>=</span> <span class=n>Pi</span> <span class=o>/</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span><span class=p>)</span>

    <span class=n>ratemap</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>ratemap</span><span class=p>)</span>
    <span class=c1># ensure that the ratemap always has nonzero firing rates,</span>
    <span class=c1># otherwise the spatial information might return NaNs:</span>
    <span class=n>ratemap</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>ratemap</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>ratemap</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span>

    <span class=c1># Handle N-dimensional ratemaps (n_units, *spatial_dims)</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
            <span class=s2>&quot;rate map must have at least 2 dimensions (n_units, *spatial_dims)!&quot;</span>
        <span class=p>)</span>

    <span class=c1># Sum over all spatial dimensions to get mean firing rate for each unit</span>
    <span class=n>spatial_axes</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)))</span>
    <span class=n>R</span> <span class=o>=</span> <span class=p>(</span><span class=n>ratemap</span> <span class=o>*</span> <span class=n>Pi</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=n>spatial_axes</span><span class=p>)</span>  <span class=c1># mean firing rate for each unit</span>

    <span class=c1># Compute spatial information for each unit</span>
    <span class=c1># We need to compute sum over spatial bins of: Pi * (Ri/R) * log2(Ri/R)</span>
    <span class=c1># where Ri is the firing rate in each spatial bin</span>

    <span class=n>si</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>  <span class=c1># one value per unit</span>

    <span class=k>for</span> <span class=n>unit_idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
        <span class=n>unit_ratemap</span> <span class=o>=</span> <span class=n>ratemap</span><span class=p>[</span><span class=n>unit_idx</span><span class=p>]</span>  <span class=c1># spatial dimensions only</span>
        <span class=n>unit_mean_rate</span> <span class=o>=</span> <span class=n>R</span><span class=p>[</span><span class=n>unit_idx</span><span class=p>]</span>

        <span class=c1># Compute (Ri / R) * log2(Ri / R) for each spatial bin</span>
        <span class=n>rate_ratio</span> <span class=o>=</span> <span class=n>unit_ratemap</span> <span class=o>/</span> <span class=n>unit_mean_rate</span>
        <span class=n>log_term</span> <span class=o>=</span> <span class=n>rate_ratio</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>log2</span><span class=p>(</span><span class=n>rate_ratio</span><span class=p>)</span>

        <span class=c1># Weight by occupancy probability and sum over all spatial dimensions</span>
        <span class=n>si</span><span class=p>[</span><span class=n>unit_idx</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>Pi</span> <span class=o>*</span> <span class=n>log_term</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>si</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.spatial_selectivity class="doc doc-heading"> <code class="highlight language-python"><span class=n>spatial_selectivity</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>The selectivity measure max(rate)/mean(rate) of the cell. The more tightly concentrated the cell's activity, the higher the selectivity. A cell with no spatial tuning at all will have a selectivity of 1.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>rate_map</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A firing rate map, any number of dimensions.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>Pi</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A probability distribution of the occupancy of each bin in the rate map. If not provided, the occupancy will be assumed to be uniform.</p> </div> </td> <td> <code>1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>selectivity</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>spatial_selectivity</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    The selectivity measure max(rate)/mean(rate)  of the cell. The more</span>
<span class=sd>    tightly concentrated the cell&#39;s activity, the higher the selectivity.</span>
<span class=sd>    A cell with no spatial tuning at all will have a selectivity of 1.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    rate_map : numpy.ndarray</span>
<span class=sd>        A firing rate map, any number of dimensions.</span>
<span class=sd>    Pi : numpy.ndarray</span>
<span class=sd>        A probability distribution of the occupancy of each bin in the</span>
<span class=sd>        rate map. If not provided, the occupancy will be assumed to be uniform.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : float</span>
<span class=sd>        selectivity</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># convert Pi to probability distribution</span>
    <span class=n>Pi</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>Pi</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span>
    <span class=n>Pi</span> <span class=o>=</span> <span class=n>Pi</span> <span class=o>/</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span><span class=p>)</span>

    <span class=c1># Handle N-dimensional ratemaps (n_units, *spatial_dims)</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
            <span class=s2>&quot;rate map must have at least 2 dimensions (n_units, *spatial_dims)!&quot;</span>
        <span class=p>)</span>

    <span class=c1># Sum over all spatial dimensions to get mean firing rate for each unit</span>
    <span class=n>spatial_axes</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)))</span>
    <span class=n>R</span> <span class=o>=</span> <span class=p>(</span><span class=n>ratemap</span> <span class=o>*</span> <span class=n>Pi</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=n>spatial_axes</span><span class=p>)</span>

    <span class=c1># Get maximum rate over all spatial dimensions for each unit</span>
    <span class=n>max_rate</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=n>spatial_axes</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>max_rate</span> <span class=o>/</span> <span class=n>R</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.spatial_sparsity class="doc doc-heading"> <code class="highlight language-python"><span class=n>spatial_sparsity</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute the firing sparsity... Compute sparsity of a rate map, The sparsity measure is an adaptation to space. The adaptation measures the fraction of the environment in which a cell is active. A sparsity of, 0.1 means that the place field of the cell occupies 1/10 of the area the subject traverses</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>rate_map</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A firing rate map, any number of dimensions.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>Pi</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A probability distribution over the bins of the rate map. If not provided, it is assumed to be uniform.</p> </div> </td> <td> <code>1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>out</code></td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>sparsity</p> </div> </td> </tr> </tbody> </table> <details class=references open> <summary>References</summary> <p>.. [2] Skaggs, W. E., McNaughton, B. L., Wilson, M., &amp; Barnes, C. (1996). Theta phase precession in hippocampal neuronal populations and the compression of temporal sequences. Hippocampus, 6, 149-172.</p> </details> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>ratemap</code> </td> <td> <code>array of shape (n_units, n_bins)</code> </td> <td> <div class=doc-md-description> <p>Rate map in Hz.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>Pi</code> </td> <td> <code>array of shape (n_bins,)</code> </td> <td> <div class=doc-md-description> <p>Occupancy of the animal.</p> </div> </td> <td> <code>1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>sparsity</code></td> <td> <code>array of shape (n_units,)</code> </td> <td> <div class=doc-md-description> <p>sparsity (in percent) for each unit</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>spatial_sparsity</span><span class=p>(</span><span class=n>ratemap</span><span class=p>,</span> <span class=n>Pi</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Compute the firing sparsity...</span>
<span class=sd>    Compute sparsity of a rate map, The sparsity  measure is an adaptation</span>
<span class=sd>    to space. The adaptation measures the fraction of the environment  in which</span>
<span class=sd>    a cell is  active. A sparsity of, 0.1 means that the place field of the</span>
<span class=sd>    cell occupies 1/10 of the area the subject traverses</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    rate_map : numpy.ndarray</span>
<span class=sd>        A firing rate map, any number of dimensions.</span>
<span class=sd>    Pi : numpy.ndarray</span>
<span class=sd>        A probability distribution over the bins of the rate map. If not</span>
<span class=sd>        provided, it is assumed to be uniform.</span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    out : float</span>
<span class=sd>        sparsity</span>

<span class=sd>    References</span>
<span class=sd>    ----------</span>
<span class=sd>    .. [2] Skaggs, W. E., McNaughton, B. L., Wilson, M., &amp; Barnes, C. (1996).</span>
<span class=sd>    Theta phase precession in hippocampal neuronal populations and the</span>
<span class=sd>    compression of temporal sequences. Hippocampus, 6, 149-172.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>

<span class=sd>    ratemap : array of shape (n_units, n_bins)</span>
<span class=sd>        Rate map in Hz.</span>
<span class=sd>    Pi : array of shape (n_bins,)</span>
<span class=sd>        Occupancy of the animal.</span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    sparsity: array of shape (n_units,)</span>
<span class=sd>        sparsity (in percent) for each unit</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>Pi</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>Pi</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span>
    <span class=n>Pi</span> <span class=o>=</span> <span class=n>Pi</span> <span class=o>/</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>Pi</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span><span class=p>)</span>

    <span class=n>ratemap</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=n>ratemap</span><span class=p>)</span>
    <span class=c1># ensure that the ratemap always has nonzero firing rates,</span>
    <span class=c1># otherwise the spatial information might return NaNs:</span>
    <span class=n>ratemap</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>ratemap</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>ratemap</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>finfo</span><span class=p>(</span><span class=nb>float</span><span class=p>)</span><span class=o>.</span><span class=n>eps</span>

    <span class=c1># Handle N-dimensional ratemaps (n_units, *spatial_dims)</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
            <span class=s2>&quot;rate map must have at least 2 dimensions (n_units, *spatial_dims)!&quot;</span>
        <span class=p>)</span>

    <span class=c1># Sum over all spatial dimensions to get mean firing rate for each unit</span>
    <span class=n>spatial_axes</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>ratemap</span><span class=o>.</span><span class=n>shape</span><span class=p>)))</span>
    <span class=n>R</span> <span class=o>=</span> <span class=p>(</span><span class=n>ratemap</span> <span class=o>*</span> <span class=n>Pi</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=n>spatial_axes</span><span class=p>)</span>

    <span class=c1># Compute average squared rate over all spatial dimensions</span>
    <span class=n>avg_sqr_rate</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>ratemap</span><span class=o>**</span><span class=mi>2</span> <span class=o>*</span> <span class=n>Pi</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=n>spatial_axes</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>R</span><span class=o>**</span><span class=mi>2</span> <span class=o>/</span> <span class=n>avg_sqr_rate</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.spiketrain_union class="doc doc-heading"> <code class="highlight language-python"><span class=n>spiketrain_union</span><span class=p>(</span><span class=n>st1</span><span class=p>,</span> <span class=n>st2</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Join two spiketrains together.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>st1</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.SpikeTrainArray>SpikeTrainArray</a></code> </td> <td> <div class=doc-md-description> <p>First spiketrain.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>st2</code> </td> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.SpikeTrainArray>SpikeTrainArray</a></code> </td> <td> <div class=doc-md-description> <p>Second spiketrain.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" href=../../core/eventarray/#nelpy.core._eventarray.SpikeTrainArray>SpikeTrainArray</a></code> </td> <td> <div class=doc-md-description> <p>Combined spiketrain with joined support.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>combined_st</span> <span class=o>=</span> <span class=n>spiketrain_union</span><span class=p>(</span><span class=n>st1</span><span class=p>,</span> <span class=n>st2</span><span class=p>)</span>
</code></pre></div> <details class=note open> <summary>Notes</summary> <p>WARNING! This function should be improved a lot! Currently assumes both spiketrains have the same number of units.</p> </details> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>2549</span>
<span class=normal>2550</span>
<span class=normal>2551</span>
<span class=normal>2552</span>
<span class=normal>2553</span>
<span class=normal>2554</span>
<span class=normal>2555</span>
<span class=normal>2556</span>
<span class=normal>2557</span>
<span class=normal>2558</span>
<span class=normal>2559</span>
<span class=normal>2560</span>
<span class=normal>2561</span>
<span class=normal>2562</span>
<span class=normal>2563</span>
<span class=normal>2564</span>
<span class=normal>2565</span>
<span class=normal>2566</span>
<span class=normal>2567</span>
<span class=normal>2568</span>
<span class=normal>2569</span>
<span class=normal>2570</span>
<span class=normal>2571</span>
<span class=normal>2572</span>
<span class=normal>2573</span>
<span class=normal>2574</span>
<span class=normal>2575</span>
<span class=normal>2576</span>
<span class=normal>2577</span>
<span class=normal>2578</span>
<span class=normal>2579</span>
<span class=normal>2580</span>
<span class=normal>2581</span>
<span class=normal>2582</span>
<span class=normal>2583</span>
<span class=normal>2584</span>
<span class=normal>2585</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>spiketrain_union</span><span class=p>(</span><span class=n>st1</span><span class=p>,</span> <span class=n>st2</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Join two spiketrains together.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    st1 : SpikeTrainArray</span>
<span class=sd>        First spiketrain.</span>
<span class=sd>    st2 : SpikeTrainArray</span>
<span class=sd>        Second spiketrain.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    SpikeTrainArray</span>
<span class=sd>        Combined spiketrain with joined support.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; combined_st = spiketrain_union(st1, st2)</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    WARNING! This function should be improved a lot!</span>
<span class=sd>    Currently assumes both spiketrains have the same number of units.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>assert</span> <span class=n>st1</span><span class=o>.</span><span class=n>n_units</span> <span class=o>==</span> <span class=n>st2</span><span class=o>.</span><span class=n>n_units</span>
    <span class=n>support</span> <span class=o>=</span> <span class=n>st1</span><span class=o>.</span><span class=n>support</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>st2</span><span class=o>.</span><span class=n>support</span><span class=p>)</span>

    <span class=n>newdata</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>unit</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>st1</span><span class=o>.</span><span class=n>n_units</span><span class=p>):</span>
        <span class=n>newdata</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>st1</span><span class=o>.</span><span class=n>time</span><span class=p>[</span><span class=n>unit</span><span class=p>],</span> <span class=n>st2</span><span class=o>.</span><span class=n>time</span><span class=p>[</span><span class=n>unit</span><span class=p>]))</span>

    <span class=n>fs</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>st1</span><span class=o>.</span><span class=n>fs</span> <span class=o>==</span> <span class=n>st2</span><span class=o>.</span><span class=n>fs</span><span class=p>:</span>
        <span class=n>fs</span> <span class=o>=</span> <span class=n>st1</span><span class=o>.</span><span class=n>fs</span>

    <span class=k>return</span> <span class=n>core</span><span class=o>.</span><span class=n>SpikeTrainArray</span><span class=p>(</span><span class=n>newdata</span><span class=p>,</span> <span class=n>support</span><span class=o>=</span><span class=n>support</span><span class=p>,</span> <span class=n>fs</span><span class=o>=</span><span class=n>fs</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.swap_cols class="doc doc-heading"> <code class="highlight language-python"><span class=n>swap_cols</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>frm</span><span class=p>,</span> <span class=n>to</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Swap columns of a 2D numpy array.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>arr</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>2D array to modify.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>frm</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Index of first column to swap.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>to</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Index of second column to swap.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>None</code> </td> <td> <div class=doc-md-description> <p>Modifies array in-place.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>arr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>swap_cols</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>arr</span>
<span class=go>array([[3, 2, 1],</span>
<span class=go>       [6, 5, 4]])</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>swap_cols</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>frm</span><span class=p>,</span> <span class=n>to</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Swap columns of a 2D numpy array.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    arr : np.ndarray</span>
<span class=sd>        2D array to modify.</span>
<span class=sd>    frm : int</span>
<span class=sd>        Index of first column to swap.</span>
<span class=sd>    to : int</span>
<span class=sd>        Index of second column to swap.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    None</span>
<span class=sd>        Modifies array in-place.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; arr = np.array([[1, 2, 3], [4, 5, 6]])</span>
<span class=sd>    &gt;&gt;&gt; swap_cols(arr, 0, 2)</span>
<span class=sd>    &gt;&gt;&gt; arr</span>
<span class=sd>    array([[3, 2, 1],</span>
<span class=sd>           [6, 5, 4]])</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>arr</span><span class=o>.</span><span class=n>ndim</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>arr</span><span class=p>[:,</span> <span class=p>[</span><span class=n>frm</span><span class=p>,</span> <span class=n>to</span><span class=p>]]</span> <span class=o>=</span> <span class=n>arr</span><span class=p>[:,</span> <span class=p>[</span><span class=n>to</span><span class=p>,</span> <span class=n>frm</span><span class=p>]]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>arr</span><span class=p>[</span><span class=n>frm</span><span class=p>],</span> <span class=n>arr</span><span class=p>[</span><span class=n>to</span><span class=p>]</span> <span class=o>=</span> <span class=n>arr</span><span class=p>[</span><span class=n>to</span><span class=p>],</span> <span class=n>arr</span><span class=p>[</span><span class=n>frm</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=nelpy.utils.swap_rows class="doc doc-heading"> <code class="highlight language-python"><span class=n>swap_rows</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>frm</span><span class=p>,</span> <span class=n>to</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Swap rows of a 2D numpy array.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>arr</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>2D array to modify.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>frm</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Index of first row to swap.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>to</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Index of second row to swap.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>None</code> </td> <td> <div class=doc-md-description> <p>Modifies array in-place.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>arr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>],</span> <span class=p>[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>]])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>swap_rows</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>arr</span>
<span class=go>array([[7, 8, 9],</span>
<span class=go>       [4, 5, 6],</span>
<span class=go>       [1, 2, 3]])</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>nelpy/utils.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>swap_rows</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=n>frm</span><span class=p>,</span> <span class=n>to</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Swap rows of a 2D numpy array.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    arr : np.ndarray</span>
<span class=sd>        2D array to modify.</span>
<span class=sd>    frm : int</span>
<span class=sd>        Index of first row to swap.</span>
<span class=sd>    to : int</span>
<span class=sd>        Index of second row to swap.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    None</span>
<span class=sd>        Modifies array in-place.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; arr = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])</span>
<span class=sd>    &gt;&gt;&gt; swap_rows(arr, 0, 2)</span>
<span class=sd>    &gt;&gt;&gt; arr</span>
<span class=sd>    array([[7, 8, 9],</span>
<span class=sd>           [4, 5, 6],</span>
<span class=sd>           [1, 2, 3]])</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>arr</span><span class=o>.</span><span class=n>ndim</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>arr</span><span class=p>[[</span><span class=n>frm</span><span class=p>,</span> <span class=n>to</span><span class=p>],</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>arr</span><span class=p>[[</span><span class=n>to</span><span class=p>,</span> <span class=n>frm</span><span class=p>],</span> <span class=p>:]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>arr</span><span class=p>[</span><span class=n>frm</span><span class=p>],</span> <span class=n>arr</span><span class=p>[</span><span class=n>to</span><span class=p>]</span> <span class=o>=</span> <span class=n>arr</span><span class=p>[</span><span class=n>to</span><span class=p>],</span> <span class=n>arr</span><span class=p>[</span><span class=n>frm</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "content.tabs.link", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.preview", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.50899def.min.js></script> </body> </html>